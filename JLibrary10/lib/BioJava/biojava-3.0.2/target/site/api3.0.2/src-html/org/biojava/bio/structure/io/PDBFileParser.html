<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>/*<a name="line.1"></a>
<span class="sourceLineNo">002</span> *<a name="line.2"></a>
<span class="sourceLineNo">003</span> * This code may be freely distributed and modified under the<a name="line.3"></a>
<span class="sourceLineNo">004</span> * terms of the GNU Lesser General Public Licence.  This should<a name="line.4"></a>
<span class="sourceLineNo">005</span> * be distributed with the code.  If you do not have a copy,<a name="line.5"></a>
<span class="sourceLineNo">006</span> * see:<a name="line.6"></a>
<span class="sourceLineNo">007</span> *<a name="line.7"></a>
<span class="sourceLineNo">008</span> *      http://www.gnu.org/copyleft/lesser.html<a name="line.8"></a>
<span class="sourceLineNo">009</span> *<a name="line.9"></a>
<span class="sourceLineNo">010</span> * Copyright for this code is held jointly by the individual<a name="line.10"></a>
<span class="sourceLineNo">011</span> * authors.  These should be listed in @author doc comments.<a name="line.11"></a>
<span class="sourceLineNo">012</span> *<a name="line.12"></a>
<span class="sourceLineNo">013</span> * For more information on the BioJava project and its aims,<a name="line.13"></a>
<span class="sourceLineNo">014</span> * or to join the biojava-l mailing list, visit the home page<a name="line.14"></a>
<span class="sourceLineNo">015</span> * at:<a name="line.15"></a>
<span class="sourceLineNo">016</span> *<a name="line.16"></a>
<span class="sourceLineNo">017</span> *      http://www.biojava.org/<a name="line.17"></a>
<span class="sourceLineNo">018</span> *<a name="line.18"></a>
<span class="sourceLineNo">019</span> * Created on 16.03.2004<a name="line.19"></a>
<span class="sourceLineNo">020</span> *<a name="line.20"></a>
<span class="sourceLineNo">021</span> */<a name="line.21"></a>
<span class="sourceLineNo">022</span>package org.biojava.bio.structure.io;<a name="line.22"></a>
<span class="sourceLineNo">023</span><a name="line.23"></a>
<span class="sourceLineNo">024</span>import java.io.BufferedReader;<a name="line.24"></a>
<span class="sourceLineNo">025</span>import java.io.IOException;<a name="line.25"></a>
<span class="sourceLineNo">026</span>import java.io.InputStream;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import java.io.InputStreamReader;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import java.text.DateFormat;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import java.text.ParseException;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import java.text.SimpleDateFormat;<a name="line.30"></a>
<span class="sourceLineNo">031</span>import java.util.ArrayList;<a name="line.31"></a>
<span class="sourceLineNo">032</span>import java.util.Arrays;<a name="line.32"></a>
<span class="sourceLineNo">033</span>import java.util.Calendar;<a name="line.33"></a>
<span class="sourceLineNo">034</span>import java.util.Date;<a name="line.34"></a>
<span class="sourceLineNo">035</span>import java.util.HashMap;<a name="line.35"></a>
<span class="sourceLineNo">036</span>import java.util.Iterator;<a name="line.36"></a>
<span class="sourceLineNo">037</span>import java.util.LinkedHashMap;<a name="line.37"></a>
<span class="sourceLineNo">038</span>import java.util.List;<a name="line.38"></a>
<span class="sourceLineNo">039</span>import java.util.Map;<a name="line.39"></a>
<span class="sourceLineNo">040</span>import java.util.StringTokenizer;<a name="line.40"></a>
<span class="sourceLineNo">041</span>import java.util.logging.Level;<a name="line.41"></a>
<span class="sourceLineNo">042</span><a name="line.42"></a>
<span class="sourceLineNo">043</span>import java.util.logging.Logger;<a name="line.43"></a>
<span class="sourceLineNo">044</span>import org.biojava.bio.structure.AminoAcid;<a name="line.44"></a>
<span class="sourceLineNo">045</span>import org.biojava.bio.structure.AminoAcidImpl;<a name="line.45"></a>
<span class="sourceLineNo">046</span>import org.biojava.bio.structure.Atom;<a name="line.46"></a>
<span class="sourceLineNo">047</span>import org.biojava.bio.structure.AtomImpl;<a name="line.47"></a>
<span class="sourceLineNo">048</span>import org.biojava.bio.structure.Author;<a name="line.48"></a>
<span class="sourceLineNo">049</span>import org.biojava.bio.structure.Chain;<a name="line.49"></a>
<span class="sourceLineNo">050</span>import org.biojava.bio.structure.ChainImpl;<a name="line.50"></a>
<span class="sourceLineNo">051</span>import org.biojava.bio.structure.DBRef;<a name="line.51"></a>
<span class="sourceLineNo">052</span>import org.biojava.bio.structure.Element;<a name="line.52"></a>
<span class="sourceLineNo">053</span>import org.biojava.bio.structure.Group;<a name="line.53"></a>
<span class="sourceLineNo">054</span>import org.biojava.bio.structure.GroupIterator;<a name="line.54"></a>
<span class="sourceLineNo">055</span>import org.biojava.bio.structure.HetatomImpl;<a name="line.55"></a>
<span class="sourceLineNo">056</span>import org.biojava.bio.structure.Compound;<a name="line.56"></a>
<span class="sourceLineNo">057</span>import org.biojava.bio.structure.GroupType;<a name="line.57"></a>
<span class="sourceLineNo">058</span>import org.biojava.bio.structure.JournalArticle;<a name="line.58"></a>
<span class="sourceLineNo">059</span>import org.biojava.bio.structure.NucleotideImpl;<a name="line.59"></a>
<span class="sourceLineNo">060</span>import org.biojava.bio.structure.PDBHeader;<a name="line.60"></a>
<span class="sourceLineNo">061</span>import org.biojava.bio.structure.ResidueNumber;<a name="line.61"></a>
<span class="sourceLineNo">062</span>import org.biojava.bio.structure.SSBond;<a name="line.62"></a>
<span class="sourceLineNo">063</span>import org.biojava.bio.structure.Site;<a name="line.63"></a>
<span class="sourceLineNo">064</span>import org.biojava.bio.structure.Structure;<a name="line.64"></a>
<span class="sourceLineNo">065</span>import org.biojava.bio.structure.StructureException;<a name="line.65"></a>
<span class="sourceLineNo">066</span>import org.biojava.bio.structure.StructureImpl;<a name="line.66"></a>
<span class="sourceLineNo">067</span>import org.biojava.bio.structure.StructureTools;<a name="line.67"></a>
<span class="sourceLineNo">068</span>import org.biojava.bio.structure.io.mmcif.ChemCompGroupFactory;<a name="line.68"></a>
<span class="sourceLineNo">069</span>import org.biojava.bio.structure.io.mmcif.ReducedChemCompProvider;<a name="line.69"></a>
<span class="sourceLineNo">070</span><a name="line.70"></a>
<span class="sourceLineNo">071</span><a name="line.71"></a>
<span class="sourceLineNo">072</span>/**<a name="line.72"></a>
<span class="sourceLineNo">073</span> * This class implements the actual PDB file parsing. Do not access it directly, but<a name="line.73"></a>
<span class="sourceLineNo">074</span> * via the PDBFileReader class.<a name="line.74"></a>
<span class="sourceLineNo">075</span> *<a name="line.75"></a>
<span class="sourceLineNo">076</span> * &lt;h2&gt;Parsing&lt;/h2&gt;<a name="line.76"></a>
<span class="sourceLineNo">077</span> *<a name="line.77"></a>
<span class="sourceLineNo">078</span> * During the PDBfile parsing several Flags can be set. See the {@link #setFileParsingParameters(FileParsingParameters)} methods.<a name="line.78"></a>
<span class="sourceLineNo">079</span> * <a name="line.79"></a>
<span class="sourceLineNo">080</span> *<a name="line.80"></a>
<span class="sourceLineNo">081</span> * &lt;p&gt;<a name="line.81"></a>
<span class="sourceLineNo">082</span> * To provide excessive memory usage for large PDB files, there is the ATOM_CA_THRESHOLD.<a name="line.82"></a>
<span class="sourceLineNo">083</span> * If more Atoms than this threshold are being parsed in a PDB file, the parser will automatically<a name="line.83"></a>
<span class="sourceLineNo">084</span> * switch to a C-alpha only representation.<a name="line.84"></a>
<span class="sourceLineNo">085</span> * &lt;/p&gt;<a name="line.85"></a>
<span class="sourceLineNo">086</span> *<a name="line.86"></a>
<span class="sourceLineNo">087</span> * &lt;p&gt;<a name="line.87"></a>
<span class="sourceLineNo">088</span> * The result of the parsing of the PDB file is a new {@link Structure} object.<a name="line.88"></a>
<span class="sourceLineNo">089</span> * &lt;/p&gt;<a name="line.89"></a>
<span class="sourceLineNo">090</span> *<a name="line.90"></a>
<span class="sourceLineNo">091</span> *<a name="line.91"></a>
<span class="sourceLineNo">092</span> * For more documentation on how to work with the Structure API please<a name="line.92"></a>
<span class="sourceLineNo">093</span> * see &lt;a href="http://biojava.org/wiki/BioJava:CookBook#Protein_Structure" target="_top"&gt;<a name="line.93"></a>
<span class="sourceLineNo">094</span> * http://biojava.org/wiki/BioJava:CookBook#Protein_Structure&lt;/a&gt;<a name="line.94"></a>
<span class="sourceLineNo">095</span> *<a name="line.95"></a>
<span class="sourceLineNo">096</span> *<a name="line.96"></a>
<span class="sourceLineNo">097</span> *<a name="line.97"></a>
<span class="sourceLineNo">098</span> *<a name="line.98"></a>
<span class="sourceLineNo">099</span> * &lt;h2&gt;Example&lt;/h2&gt;<a name="line.99"></a>
<span class="sourceLineNo">100</span> * &lt;p&gt;<a name="line.100"></a>
<span class="sourceLineNo">101</span> * Q: How can I get a Structure object from a PDB file?<a name="line.101"></a>
<span class="sourceLineNo">102</span> * &lt;/p&gt;<a name="line.102"></a>
<span class="sourceLineNo">103</span> * &lt;p&gt;<a name="line.103"></a>
<span class="sourceLineNo">104</span> * A:<a name="line.104"></a>
<span class="sourceLineNo">105</span> * &lt;pre&gt;<a name="line.105"></a>
<span class="sourceLineNo">106</span> public {@link Structure} loadStructure(String pathToPDBFile){<a name="line.106"></a>
<span class="sourceLineNo">107</span>            // The PDBFileParser is wrapped by the PDBFileReader<a name="line.107"></a>
<span class="sourceLineNo">108</span>                {@link PDBFileReader} pdbreader = new {@link PDBFileReader}();<a name="line.108"></a>
<span class="sourceLineNo">109</span><a name="line.109"></a>
<span class="sourceLineNo">110</span>                {@link Structure} structure = null;<a name="line.110"></a>
<span class="sourceLineNo">111</span>                try{<a name="line.111"></a>
<span class="sourceLineNo">112</span>                        structure = pdbreader.getStructure(pathToPDBFile);<a name="line.112"></a>
<span class="sourceLineNo">113</span>                        System.out.println(structure);<a name="line.113"></a>
<span class="sourceLineNo">114</span>                } catch (IOException e) {<a name="line.114"></a>
<span class="sourceLineNo">115</span>                        e.printStackTrace();<a name="line.115"></a>
<span class="sourceLineNo">116</span>                }<a name="line.116"></a>
<span class="sourceLineNo">117</span>                return structure;<a name="line.117"></a>
<span class="sourceLineNo">118</span>        }<a name="line.118"></a>
<span class="sourceLineNo">119</span> &lt;/pre&gt;<a name="line.119"></a>
<span class="sourceLineNo">120</span> *<a name="line.120"></a>
<span class="sourceLineNo">121</span> *<a name="line.121"></a>
<span class="sourceLineNo">122</span> * @author Andreas Prlic<a name="line.122"></a>
<span class="sourceLineNo">123</span> * @author Jules Jacobsen<a name="line.123"></a>
<span class="sourceLineNo">124</span> * @since 1.4<a name="line.124"></a>
<span class="sourceLineNo">125</span> */<a name="line.125"></a>
<span class="sourceLineNo">126</span>public class PDBFileParser  {<a name="line.126"></a>
<span class="sourceLineNo">127</span><a name="line.127"></a>
<span class="sourceLineNo">128</span>        private final boolean DEBUG = false;<a name="line.128"></a>
<span class="sourceLineNo">129</span><a name="line.129"></a>
<span class="sourceLineNo">130</span><a name="line.130"></a>
<span class="sourceLineNo">131</span>        // parsing options:<a name="line.131"></a>
<span class="sourceLineNo">132</span><a name="line.132"></a>
<span class="sourceLineNo">133</span><a name="line.133"></a>
<span class="sourceLineNo">134</span>        private Logger logger = Logger.getLogger(PDBFileParser.class.getName());<a name="line.134"></a>
<span class="sourceLineNo">135</span><a name="line.135"></a>
<span class="sourceLineNo">136</span>        // required for parsing:<a name="line.136"></a>
<span class="sourceLineNo">137</span>        private String pdbId; //the actual id of the entry<a name="line.137"></a>
<span class="sourceLineNo">138</span>        private Structure     structure;<a name="line.138"></a>
<span class="sourceLineNo">139</span>        private List&lt;Chain&gt;   current_model; // contains the ATOM records for each model<a name="line.139"></a>
<span class="sourceLineNo">140</span>        private Chain         current_chain;<a name="line.140"></a>
<span class="sourceLineNo">141</span>        private Group         current_group;<a name="line.141"></a>
<span class="sourceLineNo">142</span><a name="line.142"></a>
<span class="sourceLineNo">143</span>        private List&lt;Chain&gt;   seqResChains; // contains all the chains for the SEQRES records<a name="line.143"></a>
<span class="sourceLineNo">144</span>        //we're going to work on the assumption that the files are current -<a name="line.144"></a>
<span class="sourceLineNo">145</span>        //if the pdb_HEADER_Handler detects a legacy format, this will be changed to true.<a name="line.145"></a>
<span class="sourceLineNo">146</span>        //if true then lines will be truncated at 72 characters in certain cases<a name="line.146"></a>
<span class="sourceLineNo">147</span>        //(pdb_COMPOUND_handler for example)<a name="line.147"></a>
<span class="sourceLineNo">148</span>        private boolean isLegacyFormat = false;<a name="line.148"></a>
<span class="sourceLineNo">149</span><a name="line.149"></a>
<span class="sourceLineNo">150</span>        // for printing<a name="line.150"></a>
<span class="sourceLineNo">151</span>        private static final String NEWLINE;<a name="line.151"></a>
<span class="sourceLineNo">152</span><a name="line.152"></a>
<span class="sourceLineNo">153</span>        private Map &lt;String,Object&gt;  header ;<a name="line.153"></a>
<span class="sourceLineNo">154</span>        private PDBHeader pdbHeader;<a name="line.154"></a>
<span class="sourceLineNo">155</span>        private JournalArticle journalArticle;<a name="line.155"></a>
<span class="sourceLineNo">156</span>        private List&lt;Map&lt;String, Integer&gt;&gt; connects ;<a name="line.156"></a>
<span class="sourceLineNo">157</span>        private List&lt;Map&lt;String,String&gt;&gt; helixList;<a name="line.157"></a>
<span class="sourceLineNo">158</span>        private List&lt;Map&lt;String,String&gt;&gt; strandList;<a name="line.158"></a>
<span class="sourceLineNo">159</span>        private List&lt;Map&lt;String,String&gt;&gt; turnList;<a name="line.159"></a>
<span class="sourceLineNo">160</span><a name="line.160"></a>
<span class="sourceLineNo">161</span>        private int lengthCheck ;<a name="line.161"></a>
<span class="sourceLineNo">162</span><a name="line.162"></a>
<span class="sourceLineNo">163</span>        private boolean isLastCompndLine = false;<a name="line.163"></a>
<span class="sourceLineNo">164</span>        private boolean isLastSourceLine = false;<a name="line.164"></a>
<span class="sourceLineNo">165</span>        private Compound current_compound;<a name="line.165"></a>
<span class="sourceLineNo">166</span>        private List&lt;Compound&gt; compounds = new ArrayList&lt;Compound&gt;();<a name="line.166"></a>
<span class="sourceLineNo">167</span>        private List&lt;String&gt; compndLines = new ArrayList&lt;String&gt;();<a name="line.167"></a>
<span class="sourceLineNo">168</span>        private List&lt;String&gt; sourceLines = new ArrayList&lt;String&gt;();<a name="line.168"></a>
<span class="sourceLineNo">169</span>        private List&lt;String&gt; journalLines = new ArrayList&lt;String&gt;();<a name="line.169"></a>
<span class="sourceLineNo">170</span>        private List&lt;DBRef&gt; dbrefs;<a name="line.170"></a>
<span class="sourceLineNo">171</span>        private Map&lt;String, Site&gt; siteMap = new LinkedHashMap&lt;String, Site&gt;();<a name="line.171"></a>
<span class="sourceLineNo">172</span>        private Map&lt;String, List&lt;ResidueNumber&gt;&gt; siteToResidueMap = new LinkedHashMap&lt;String, List&lt;ResidueNumber&gt;&gt;();<a name="line.172"></a>
<span class="sourceLineNo">173</span><a name="line.173"></a>
<span class="sourceLineNo">174</span><a name="line.174"></a>
<span class="sourceLineNo">175</span>        // for parsing COMPOUND and SOURCE Header lines<a name="line.175"></a>
<span class="sourceLineNo">176</span>        private int molTypeCounter = 1;<a name="line.176"></a>
<span class="sourceLineNo">177</span>        //private int continuationNo;<a name="line.177"></a>
<span class="sourceLineNo">178</span>        private String continuationField;<a name="line.178"></a>
<span class="sourceLineNo">179</span>        private String continuationString = "";<a name="line.179"></a>
<span class="sourceLineNo">180</span>        private DateFormat dateFormat;<a name="line.180"></a>
<span class="sourceLineNo">181</span><a name="line.181"></a>
<span class="sourceLineNo">182</span>        private static  final List&lt;String&gt; compndFieldValues = new ArrayList&lt;String&gt;(<a name="line.182"></a>
<span class="sourceLineNo">183</span>                        Arrays.asList(<a name="line.183"></a>
<span class="sourceLineNo">184</span>                                        "MOL_ID:", "MOLECULE:", "CHAIN:", "SYNONYM:",<a name="line.184"></a>
<span class="sourceLineNo">185</span>                                        "EC:", "FRAGMENT:", "ENGINEERED:", "MUTATION:",<a name="line.185"></a>
<span class="sourceLineNo">186</span>                                        "BIOLOGICAL_UNIT:", "OTHER_DETAILS:"<a name="line.186"></a>
<span class="sourceLineNo">187</span>                        ));<a name="line.187"></a>
<span class="sourceLineNo">188</span><a name="line.188"></a>
<span class="sourceLineNo">189</span><a name="line.189"></a>
<span class="sourceLineNo">190</span>        private static final List&lt;String&gt; ignoreCompndFieldValues = new ArrayList&lt;String&gt;(<a name="line.190"></a>
<span class="sourceLineNo">191</span>                        Arrays.asList(<a name="line.191"></a>
<span class="sourceLineNo">192</span>                                        "HETEROGEN:","ENGINEEREED:","FRAGMENT,",<a name="line.192"></a>
<span class="sourceLineNo">193</span>                                        "MUTANT:","SYNTHETIC:"<a name="line.193"></a>
<span class="sourceLineNo">194</span>                        ));<a name="line.194"></a>
<span class="sourceLineNo">195</span>        // ENGINEEREED in pdb219d<a name="line.195"></a>
<span class="sourceLineNo">196</span><a name="line.196"></a>
<span class="sourceLineNo">197</span>        private static final List&lt;String&gt; sourceFieldValues = new ArrayList&lt;String&gt;(<a name="line.197"></a>
<span class="sourceLineNo">198</span>                        Arrays.asList("ENGINEERED:", "MOL_ID:", "SYNTHETIC:", "FRAGMENT:",<a name="line.198"></a>
<span class="sourceLineNo">199</span>                                        "ORGANISM_SCIENTIFIC:", "ORGANISM_COMMON:",<a name="line.199"></a>
<span class="sourceLineNo">200</span>                                        "ORGANISM_TAXID:","STRAIN:",<a name="line.200"></a>
<span class="sourceLineNo">201</span>                                        "VARIANT:", "CELL_LINE:", "ATCC:", "ORGAN:", "TISSUE:",<a name="line.201"></a>
<span class="sourceLineNo">202</span>                                        "CELL:", "ORGANELLE:", "SECRETION:", "GENE:",<a name="line.202"></a>
<span class="sourceLineNo">203</span>                                        "CELLULAR_LOCATION:", "EXPRESSION_SYSTEM:",<a name="line.203"></a>
<span class="sourceLineNo">204</span>                                        "EXPRESSION_SYSTEM_TAXID:",<a name="line.204"></a>
<span class="sourceLineNo">205</span>                                        "EXPRESSION_SYSTEM_STRAIN:", "EXPRESSION_SYSTEM_VARIANT:",<a name="line.205"></a>
<span class="sourceLineNo">206</span>                                        "EXPRESSION_SYSTEM_CELL_LINE:",<a name="line.206"></a>
<span class="sourceLineNo">207</span>                                        "EXPRESSION_SYSTEM_ATCC_NUMBER:",<a name="line.207"></a>
<span class="sourceLineNo">208</span>                                        "EXPRESSION_SYSTEM_ORGAN:", "EXPRESSION_SYSTEM_TISSUE:",<a name="line.208"></a>
<span class="sourceLineNo">209</span>                                        "EXPRESSION_SYSTEM_CELL:", "EXPRESSION_SYSTEM_ORGANELLE:",<a name="line.209"></a>
<span class="sourceLineNo">210</span>                                        "EXPRESSION_SYSTEM_CELLULAR_LOCATION:",<a name="line.210"></a>
<span class="sourceLineNo">211</span>                                        "EXPRESSION_SYSTEM_VECTOR_TYPE:",<a name="line.211"></a>
<span class="sourceLineNo">212</span>                                        "EXPRESSION_SYSTEM_VECTOR:", "EXPRESSION_SYSTEM_PLASMID:",<a name="line.212"></a>
<span class="sourceLineNo">213</span>                                        "EXPRESSION_SYSTEM_GENE:", "OTHER_DETAILS:"));<a name="line.213"></a>
<span class="sourceLineNo">214</span><a name="line.214"></a>
<span class="sourceLineNo">215</span><a name="line.215"></a>
<span class="sourceLineNo">216</span><a name="line.216"></a>
<span class="sourceLineNo">217</span><a name="line.217"></a>
<span class="sourceLineNo">218</span>        private String previousContinuationField = "";<a name="line.218"></a>
<span class="sourceLineNo">219</span><a name="line.219"></a>
<span class="sourceLineNo">220</span>        /** Secondary strucuture assigned by the PDB author/<a name="line.220"></a>
<span class="sourceLineNo">221</span>         *<a name="line.221"></a>
<span class="sourceLineNo">222</span>         */<a name="line.222"></a>
<span class="sourceLineNo">223</span>        public static final String PDB_AUTHOR_ASSIGNMENT = "PDB_AUTHOR_ASSIGNMENT";<a name="line.223"></a>
<span class="sourceLineNo">224</span><a name="line.224"></a>
<span class="sourceLineNo">225</span>        /** Helix secondary structure assignment.<a name="line.225"></a>
<span class="sourceLineNo">226</span>         *<a name="line.226"></a>
<span class="sourceLineNo">227</span>         */<a name="line.227"></a>
<span class="sourceLineNo">228</span>        public static final String HELIX  = "HELIX";<a name="line.228"></a>
<span class="sourceLineNo">229</span><a name="line.229"></a>
<span class="sourceLineNo">230</span>        /** Strand secondary structure assignment.<a name="line.230"></a>
<span class="sourceLineNo">231</span>         *<a name="line.231"></a>
<span class="sourceLineNo">232</span>         */<a name="line.232"></a>
<span class="sourceLineNo">233</span>        public static final String STRAND = "STRAND";<a name="line.233"></a>
<span class="sourceLineNo">234</span><a name="line.234"></a>
<span class="sourceLineNo">235</span>        /** Turn secondary structure assignment.<a name="line.235"></a>
<span class="sourceLineNo">236</span>         *<a name="line.236"></a>
<span class="sourceLineNo">237</span>         */<a name="line.237"></a>
<span class="sourceLineNo">238</span>        public static final String TURN   = "TURN";<a name="line.238"></a>
<span class="sourceLineNo">239</span><a name="line.239"></a>
<span class="sourceLineNo">240</span>        int atomCount;<a name="line.240"></a>
<span class="sourceLineNo">241</span><a name="line.241"></a>
<span class="sourceLineNo">242</span>        /** the maximum number of atoms that will be parsed before the parser switches to a CA-only<a name="line.242"></a>
<span class="sourceLineNo">243</span>         * representation of the PDB file. If this limit is exceeded also the SEQRES groups will be<a name="line.243"></a>
<span class="sourceLineNo">244</span>         * ignored.<a name="line.244"></a>
<span class="sourceLineNo">245</span>         */<a name="line.245"></a>
<span class="sourceLineNo">246</span>        public static final int ATOM_CA_THRESHOLD = 500000;<a name="line.246"></a>
<span class="sourceLineNo">247</span><a name="line.247"></a>
<span class="sourceLineNo">248</span>        /**  the maximum number of atoms we will add to a structure<a name="line.248"></a>
<span class="sourceLineNo">249</span>     this protects from memory overflows in the few really big protein structures.<a name="line.249"></a>
<span class="sourceLineNo">250</span>         */<a name="line.250"></a>
<span class="sourceLineNo">251</span>        public static final int MAX_ATOMS = 700000; // tested with java -Xmx300M<a name="line.251"></a>
<span class="sourceLineNo">252</span><a name="line.252"></a>
<span class="sourceLineNo">253</span>        private boolean atomOverflow;<a name="line.253"></a>
<span class="sourceLineNo">254</span><a name="line.254"></a>
<span class="sourceLineNo">255</span>        /** flag to tell parser to only read Calpha coordinates **/<a name="line.255"></a>
<span class="sourceLineNo">256</span>        boolean parseCAonly;<a name="line.256"></a>
<span class="sourceLineNo">257</span><a name="line.257"></a>
<span class="sourceLineNo">258</span>        static {<a name="line.258"></a>
<span class="sourceLineNo">259</span><a name="line.259"></a>
<span class="sourceLineNo">260</span>                NEWLINE = System.getProperty("line.separator");<a name="line.260"></a>
<span class="sourceLineNo">261</span><a name="line.261"></a>
<span class="sourceLineNo">262</span>        }<a name="line.262"></a>
<span class="sourceLineNo">263</span><a name="line.263"></a>
<span class="sourceLineNo">264</span>        FileParsingParameters params;<a name="line.264"></a>
<span class="sourceLineNo">265</span><a name="line.265"></a>
<span class="sourceLineNo">266</span>        public PDBFileParser() {<a name="line.266"></a>
<span class="sourceLineNo">267</span>                params = new FileParsingParameters();<a name="line.267"></a>
<span class="sourceLineNo">268</span><a name="line.268"></a>
<span class="sourceLineNo">269</span>                structure     = null           ;<a name="line.269"></a>
<span class="sourceLineNo">270</span>                current_model = new ArrayList&lt;Chain&gt;();<a name="line.270"></a>
<span class="sourceLineNo">271</span>                current_chain = null           ;<a name="line.271"></a>
<span class="sourceLineNo">272</span>                current_group = null           ;<a name="line.272"></a>
<span class="sourceLineNo">273</span>                header        = init_header() ;<a name="line.273"></a>
<span class="sourceLineNo">274</span>                pdbHeader         = new PDBHeader();<a name="line.274"></a>
<span class="sourceLineNo">275</span>                connects      = new ArrayList&lt;Map&lt;String,Integer&gt;&gt;() ;<a name="line.275"></a>
<span class="sourceLineNo">276</span><a name="line.276"></a>
<span class="sourceLineNo">277</span><a name="line.277"></a>
<span class="sourceLineNo">278</span>                helixList     = new ArrayList&lt;Map&lt;String,String&gt;&gt;();<a name="line.278"></a>
<span class="sourceLineNo">279</span>                strandList    = new ArrayList&lt;Map&lt;String,String&gt;&gt;();<a name="line.279"></a>
<span class="sourceLineNo">280</span>                turnList      = new ArrayList&lt;Map&lt;String,String&gt;&gt;();<a name="line.280"></a>
<span class="sourceLineNo">281</span>                current_compound = new Compound();<a name="line.281"></a>
<span class="sourceLineNo">282</span>                dbrefs        = new ArrayList&lt;DBRef&gt;();<a name="line.282"></a>
<span class="sourceLineNo">283</span>                siteMap = null;<a name="line.283"></a>
<span class="sourceLineNo">284</span>                dateFormat = new SimpleDateFormat("dd-MMM-yy", java.util.Locale.ENGLISH);<a name="line.284"></a>
<span class="sourceLineNo">285</span>                atomCount = 0;<a name="line.285"></a>
<span class="sourceLineNo">286</span>                atomOverflow = false;<a name="line.286"></a>
<span class="sourceLineNo">287</span>                parseCAonly = false;<a name="line.287"></a>
<span class="sourceLineNo">288</span><a name="line.288"></a>
<span class="sourceLineNo">289</span><a name="line.289"></a>
<span class="sourceLineNo">290</span><a name="line.290"></a>
<span class="sourceLineNo">291</span>        }<a name="line.291"></a>
<span class="sourceLineNo">292</span><a name="line.292"></a>
<span class="sourceLineNo">293</span><a name="line.293"></a>
<span class="sourceLineNo">294</span><a name="line.294"></a>
<span class="sourceLineNo">295</span>        /** initialize the header. */<a name="line.295"></a>
<span class="sourceLineNo">296</span>        private Map&lt;String,Object&gt; init_header(){<a name="line.296"></a>
<span class="sourceLineNo">297</span><a name="line.297"></a>
<span class="sourceLineNo">298</span><a name="line.298"></a>
<span class="sourceLineNo">299</span>                HashMap&lt;String,Object&gt; header = new HashMap&lt;String,Object&gt; ();<a name="line.299"></a>
<span class="sourceLineNo">300</span>                header.put ("idCode","");<a name="line.300"></a>
<span class="sourceLineNo">301</span>                header.put ("classification","")         ;<a name="line.301"></a>
<span class="sourceLineNo">302</span>                header.put ("depDate","0000-00-00");<a name="line.302"></a>
<span class="sourceLineNo">303</span>                header.put ("title","");<a name="line.303"></a>
<span class="sourceLineNo">304</span>                header.put ("technique","");<a name="line.304"></a>
<span class="sourceLineNo">305</span>                header.put ("resolution",null);<a name="line.305"></a>
<span class="sourceLineNo">306</span>                header.put ("modDate","0000-00-00");<a name="line.306"></a>
<span class="sourceLineNo">307</span>                //header.put ("journalRef","");<a name="line.307"></a>
<span class="sourceLineNo">308</span>                //header.put ("author","");<a name="line.308"></a>
<span class="sourceLineNo">309</span>                //header.put ("compound","");<a name="line.309"></a>
<span class="sourceLineNo">310</span>                return header ;<a name="line.310"></a>
<span class="sourceLineNo">311</span>        }<a name="line.311"></a>
<span class="sourceLineNo">312</span><a name="line.312"></a>
<span class="sourceLineNo">313</span><a name="line.313"></a>
<span class="sourceLineNo">314</span>        /**<a name="line.314"></a>
<span class="sourceLineNo">315</span>         * Returns a time stamp.<a name="line.315"></a>
<span class="sourceLineNo">316</span>         * @return a String representing the time stamp value<a name="line.316"></a>
<span class="sourceLineNo">317</span>         */<a name="line.317"></a>
<span class="sourceLineNo">318</span>        protected String getTimeStamp(){<a name="line.318"></a>
<span class="sourceLineNo">319</span><a name="line.319"></a>
<span class="sourceLineNo">320</span>                Calendar cal = Calendar.getInstance() ;<a name="line.320"></a>
<span class="sourceLineNo">321</span>                // Get the components of the time<a name="line.321"></a>
<span class="sourceLineNo">322</span>                int hour24 = cal.get(Calendar.HOUR_OF_DAY);     // 0..23<a name="line.322"></a>
<span class="sourceLineNo">323</span>                int min = cal.get(Calendar.MINUTE);             // 0..59<a name="line.323"></a>
<span class="sourceLineNo">324</span>                int sec = cal.get(Calendar.SECOND);             // 0..59<a name="line.324"></a>
<span class="sourceLineNo">325</span>                String s = "time: "+hour24+" "+min+" "+sec;<a name="line.325"></a>
<span class="sourceLineNo">326</span>                return s ;<a name="line.326"></a>
<span class="sourceLineNo">327</span>        }<a name="line.327"></a>
<span class="sourceLineNo">328</span><a name="line.328"></a>
<span class="sourceLineNo">329</span>        /** initiate new resNum, either Hetatom, Nucleotide, or AminoAcid */<a name="line.329"></a>
<span class="sourceLineNo">330</span>        private Group getNewGroup(String recordName,Character aminoCode1, String aminoCode3) {<a name="line.330"></a>
<span class="sourceLineNo">331</span><a name="line.331"></a>
<span class="sourceLineNo">332</span>                if ( params.isLoadChemCompInfo() ){<a name="line.332"></a>
<span class="sourceLineNo">333</span>                        Group g =  ChemCompGroupFactory.getGroupFromChemCompDictionary(aminoCode3);<a name="line.333"></a>
<span class="sourceLineNo">334</span>                        if ( g != null)<a name="line.334"></a>
<span class="sourceLineNo">335</span>                                return g;<a name="line.335"></a>
<span class="sourceLineNo">336</span>                }<a name="line.336"></a>
<span class="sourceLineNo">337</span><a name="line.337"></a>
<span class="sourceLineNo">338</span><a name="line.338"></a>
<span class="sourceLineNo">339</span>                Group group;<a name="line.339"></a>
<span class="sourceLineNo">340</span>                if ( recordName.equals("ATOM") ) {<a name="line.340"></a>
<span class="sourceLineNo">341</span>                        if (aminoCode1 == null)  {<a name="line.341"></a>
<span class="sourceLineNo">342</span>                                // it is a nucleotide<a name="line.342"></a>
<span class="sourceLineNo">343</span>                                NucleotideImpl nu = new NucleotideImpl();<a name="line.343"></a>
<span class="sourceLineNo">344</span>                                group = nu;<a name="line.344"></a>
<span class="sourceLineNo">345</span><a name="line.345"></a>
<span class="sourceLineNo">346</span>                        } else if (aminoCode1 == StructureTools.UNKNOWN_GROUP_LABEL){<a name="line.346"></a>
<span class="sourceLineNo">347</span>                                group = new HetatomImpl();<a name="line.347"></a>
<span class="sourceLineNo">348</span><a name="line.348"></a>
<span class="sourceLineNo">349</span>                        } else {<a name="line.349"></a>
<span class="sourceLineNo">350</span>                                AminoAcidImpl aa = new AminoAcidImpl() ;<a name="line.350"></a>
<span class="sourceLineNo">351</span>                                aa.setAminoType(aminoCode1);<a name="line.351"></a>
<span class="sourceLineNo">352</span>                                group = aa ;<a name="line.352"></a>
<span class="sourceLineNo">353</span>                        }<a name="line.353"></a>
<span class="sourceLineNo">354</span>                }<a name="line.354"></a>
<span class="sourceLineNo">355</span>                else {<a name="line.355"></a>
<span class="sourceLineNo">356</span>                        if (aminoCode1 != null ) {<a name="line.356"></a>
<span class="sourceLineNo">357</span>                                AminoAcidImpl aa = new AminoAcidImpl() ;<a name="line.357"></a>
<span class="sourceLineNo">358</span>                                aa.setAminoType(aminoCode1);<a name="line.358"></a>
<span class="sourceLineNo">359</span>                                group = aa ;<a name="line.359"></a>
<span class="sourceLineNo">360</span>                        } else {<a name="line.360"></a>
<span class="sourceLineNo">361</span>                                group = new HetatomImpl();<a name="line.361"></a>
<span class="sourceLineNo">362</span>                        }<a name="line.362"></a>
<span class="sourceLineNo">363</span>                }<a name="line.363"></a>
<span class="sourceLineNo">364</span>                //              System.out.println("new resNum type: "+ resNum.getType() );<a name="line.364"></a>
<span class="sourceLineNo">365</span>                return  group ;<a name="line.365"></a>
<span class="sourceLineNo">366</span>        }<a name="line.366"></a>
<span class="sourceLineNo">367</span><a name="line.367"></a>
<span class="sourceLineNo">368</span><a name="line.368"></a>
<span class="sourceLineNo">369</span><a name="line.369"></a>
<span class="sourceLineNo">370</span>        // Handler methods to deal with PDB file records properly.<a name="line.370"></a>
<span class="sourceLineNo">371</span>        /**<a name="line.371"></a>
<span class="sourceLineNo">372</span>         Handler for<a name="line.372"></a>
<span class="sourceLineNo">373</span>         HEADER Record Format<a name="line.373"></a>
<span class="sourceLineNo">374</span><a name="line.374"></a>
<span class="sourceLineNo">375</span>         COLUMNS        DATA TYPE       FIELD           DEFINITION<a name="line.375"></a>
<span class="sourceLineNo">376</span>         ----------------------------------------------------------------------------------<a name="line.376"></a>
<span class="sourceLineNo">377</span>         1 -  6        Record name     "HEADER"<a name="line.377"></a>
<span class="sourceLineNo">378</span>         11 - 50        String(40)      classification  Classifies the molecule(s)<a name="line.378"></a>
<span class="sourceLineNo">379</span>         51 - 59        Date            depDate         Deposition date.  This is the date<a name="line.379"></a>
<span class="sourceLineNo">380</span>         the coordinates were received by<a name="line.380"></a>
<span class="sourceLineNo">381</span>         the PDB<a name="line.381"></a>
<span class="sourceLineNo">382</span>         63 - 66        IDcode          idCode          This identifier is unique within PDB<a name="line.382"></a>
<span class="sourceLineNo">383</span><a name="line.383"></a>
<span class="sourceLineNo">384</span>         */<a name="line.384"></a>
<span class="sourceLineNo">385</span>        private void pdb_HEADER_Handler(String line) {<a name="line.385"></a>
<span class="sourceLineNo">386</span>                //System.out.println(line);<a name="line.386"></a>
<span class="sourceLineNo">387</span><a name="line.387"></a>
<span class="sourceLineNo">388</span>                String classification  = line.substring (10, 50).trim() ;<a name="line.388"></a>
<span class="sourceLineNo">389</span>                String deposition_date = line.substring (50, 59).trim() ;<a name="line.389"></a>
<span class="sourceLineNo">390</span>                String pdbCode         = line.substring (62, 66).trim() ;<a name="line.390"></a>
<span class="sourceLineNo">391</span><a name="line.391"></a>
<span class="sourceLineNo">392</span>                pdbId = pdbCode;<a name="line.392"></a>
<span class="sourceLineNo">393</span>                if (DEBUG) {<a name="line.393"></a>
<span class="sourceLineNo">394</span>                        System.out.println("Parsing entry " + pdbId);<a name="line.394"></a>
<span class="sourceLineNo">395</span>                }<a name="line.395"></a>
<span class="sourceLineNo">396</span>                //*really* old files (you'll need to hunt to find these as they<a name="line.396"></a>
<span class="sourceLineNo">397</span>                //should have been remediated) have headers like below. Plus the<a name="line.397"></a>
<span class="sourceLineNo">398</span>                //pdbId at positions 72-76 is present in every line<a name="line.398"></a>
<span class="sourceLineNo">399</span><a name="line.399"></a>
<span class="sourceLineNo">400</span>                //HEADER    PROTEINASE INHIBITOR (TRYPSIN)          05-OCT-84   5PTI      5PTI   3<a name="line.400"></a>
<span class="sourceLineNo">401</span>                //HEADER    TRANSFERASE (ACYLTRANSFERASE)           02-SEP-92   1LAC      1LAC   2<a name="line.401"></a>
<span class="sourceLineNo">402</span>                if (line.trim().length() &gt; 66) {<a name="line.402"></a>
<span class="sourceLineNo">403</span>                        if (pdbId.equals(line.substring (72, 76))){<a name="line.403"></a>
<span class="sourceLineNo">404</span>                                isLegacyFormat = true;<a name="line.404"></a>
<span class="sourceLineNo">405</span>                                System.out.println(pdbId + " is a LEGACY entry - this will most likely not parse correctly.");<a name="line.405"></a>
<span class="sourceLineNo">406</span>                        }<a name="line.406"></a>
<span class="sourceLineNo">407</span>                }<a name="line.407"></a>
<span class="sourceLineNo">408</span>                header.put("idCode",pdbCode);<a name="line.408"></a>
<span class="sourceLineNo">409</span>                structure.setPDBCode(pdbCode);<a name="line.409"></a>
<span class="sourceLineNo">410</span>                header.put("classification",classification);<a name="line.410"></a>
<span class="sourceLineNo">411</span>                header.put("depDate",deposition_date);<a name="line.411"></a>
<span class="sourceLineNo">412</span><a name="line.412"></a>
<span class="sourceLineNo">413</span>                pdbHeader.setIdCode(pdbCode);<a name="line.413"></a>
<span class="sourceLineNo">414</span>                pdbHeader.setClassification(classification);<a name="line.414"></a>
<span class="sourceLineNo">415</span><a name="line.415"></a>
<span class="sourceLineNo">416</span><a name="line.416"></a>
<span class="sourceLineNo">417</span>                try {<a name="line.417"></a>
<span class="sourceLineNo">418</span>                        Date dep = dateFormat.parse(deposition_date);<a name="line.418"></a>
<span class="sourceLineNo">419</span>                        pdbHeader.setDepDate(dep);<a name="line.419"></a>
<span class="sourceLineNo">420</span>                        header.put("depDate",deposition_date);<a name="line.420"></a>
<span class="sourceLineNo">421</span><a name="line.421"></a>
<span class="sourceLineNo">422</span>                } catch (ParseException e){<a name="line.422"></a>
<span class="sourceLineNo">423</span>                        e.printStackTrace();<a name="line.423"></a>
<span class="sourceLineNo">424</span>                }<a name="line.424"></a>
<span class="sourceLineNo">425</span><a name="line.425"></a>
<span class="sourceLineNo">426</span>        }<a name="line.426"></a>
<span class="sourceLineNo">427</span><a name="line.427"></a>
<span class="sourceLineNo">428</span><a name="line.428"></a>
<span class="sourceLineNo">429</span>        /** parses the following record:<a name="line.429"></a>
<span class="sourceLineNo">430</span>         &lt;pre&gt;<a name="line.430"></a>
<span class="sourceLineNo">431</span>         COLUMNS      DATA  TYPE      FIELD         DEFINITION<a name="line.431"></a>
<span class="sourceLineNo">432</span>------------------------------------------------------------------------------------<a name="line.432"></a>
<span class="sourceLineNo">433</span> 1 -  6      Record name     "AUTHOR"<a name="line.433"></a>
<span class="sourceLineNo">434</span> 9 - 10      Continuation    continuation  Allows concatenation of multiple records.<a name="line.434"></a>
<span class="sourceLineNo">435</span>11 - 79      List            authorList    List of the author names, separated<a name="line.435"></a>
<span class="sourceLineNo">436</span>                                           by commas.<a name="line.436"></a>
<span class="sourceLineNo">437</span><a name="line.437"></a>
<span class="sourceLineNo">438</span>&lt;/pre&gt;<a name="line.438"></a>
<span class="sourceLineNo">439</span>         * @param line<a name="line.439"></a>
<span class="sourceLineNo">440</span>         */<a name="line.440"></a>
<span class="sourceLineNo">441</span>        private void pdb_AUTHOR_Handler(String line) {<a name="line.441"></a>
<span class="sourceLineNo">442</span><a name="line.442"></a>
<span class="sourceLineNo">443</span>                String authors = line.substring(10).trim();<a name="line.443"></a>
<span class="sourceLineNo">444</span><a name="line.444"></a>
<span class="sourceLineNo">445</span>                String auth = pdbHeader.getAuthors();<a name="line.445"></a>
<span class="sourceLineNo">446</span>                if (auth == null){<a name="line.446"></a>
<span class="sourceLineNo">447</span>                        pdbHeader.setAuthors(authors);<a name="line.447"></a>
<span class="sourceLineNo">448</span>                } else {<a name="line.448"></a>
<span class="sourceLineNo">449</span>                        auth +=  authors;<a name="line.449"></a>
<span class="sourceLineNo">450</span>                        pdbHeader.setAuthors(auth);<a name="line.450"></a>
<span class="sourceLineNo">451</span>                }<a name="line.451"></a>
<span class="sourceLineNo">452</span><a name="line.452"></a>
<span class="sourceLineNo">453</span>        }<a name="line.453"></a>
<span class="sourceLineNo">454</span><a name="line.454"></a>
<span class="sourceLineNo">455</span><a name="line.455"></a>
<span class="sourceLineNo">456</span><a name="line.456"></a>
<span class="sourceLineNo">457</span>        /** parses the following record:<a name="line.457"></a>
<span class="sourceLineNo">458</span><a name="line.458"></a>
<span class="sourceLineNo">459</span>         &lt;pre&gt;<a name="line.459"></a>
<span class="sourceLineNo">460</span>    COLUMNS       DATA TYPE        FIELD        DEFINITION<a name="line.460"></a>
<span class="sourceLineNo">461</span>    --------------------------------------------------------------------<a name="line.461"></a>
<span class="sourceLineNo">462</span>     1 -  6       Record name      "HELIX "<a name="line.462"></a>
<span class="sourceLineNo">463</span>     8 - 10       Integer          serNum       Serial number of the helix.<a name="line.463"></a>
<span class="sourceLineNo">464</span>                                                This starts at 1 and increases<a name="line.464"></a>
<span class="sourceLineNo">465</span>                                                incrementally.<a name="line.465"></a>
<span class="sourceLineNo">466</span>    12 - 14       LString(3)       helixID      Helix identifier. In addition<a name="line.466"></a>
<span class="sourceLineNo">467</span>                                                to a serial number, each helix is<a name="line.467"></a>
<span class="sourceLineNo">468</span>                                                given an alphanumeric character<a name="line.468"></a>
<span class="sourceLineNo">469</span>                                                helix identifier.<a name="line.469"></a>
<span class="sourceLineNo">470</span>    16 - 18       Residue name     initResName  Name of the initial residue.<a name="line.470"></a>
<span class="sourceLineNo">471</span>    20            Character        initChainID  Chain identifier for the chain<a name="line.471"></a>
<span class="sourceLineNo">472</span>                                                containing this helix.<a name="line.472"></a>
<span class="sourceLineNo">473</span>    22 - 25       Integer          initSeqNum   Sequence number of the initial<a name="line.473"></a>
<span class="sourceLineNo">474</span>                                                residue.<a name="line.474"></a>
<span class="sourceLineNo">475</span>    26            AChar            initICode    Insertion code of the initial<a name="line.475"></a>
<span class="sourceLineNo">476</span>                                                residue.<a name="line.476"></a>
<span class="sourceLineNo">477</span>    28 - 30       Residue name     endResName   Name of the terminal residue of<a name="line.477"></a>
<span class="sourceLineNo">478</span>                                                the helix.<a name="line.478"></a>
<span class="sourceLineNo">479</span>    32            Character        endChainID   Chain identifier for the chain<a name="line.479"></a>
<span class="sourceLineNo">480</span>                                                containing this helix.<a name="line.480"></a>
<span class="sourceLineNo">481</span>    34 - 37       Integer          endSeqNum    Sequence number of the terminal<a name="line.481"></a>
<span class="sourceLineNo">482</span>                                                residue.<a name="line.482"></a>
<span class="sourceLineNo">483</span>    38            AChar            endICode     Insertion code of the terminal<a name="line.483"></a>
<span class="sourceLineNo">484</span>                                                residue.<a name="line.484"></a>
<span class="sourceLineNo">485</span>    39 - 40       Integer          helixClass   Helix class (see below).<a name="line.485"></a>
<span class="sourceLineNo">486</span>    41 - 70       String           comment      Comment about this helix.<a name="line.486"></a>
<span class="sourceLineNo">487</span>    72 - 76       Integer          length       Length of this helix.<a name="line.487"></a>
<span class="sourceLineNo">488</span>&lt;/pre&gt;<a name="line.488"></a>
<span class="sourceLineNo">489</span>         */<a name="line.489"></a>
<span class="sourceLineNo">490</span><a name="line.490"></a>
<span class="sourceLineNo">491</span>        private void pdb_HELIX_Handler(String line){<a name="line.491"></a>
<span class="sourceLineNo">492</span>                String initResName = line.substring(15,18).trim();<a name="line.492"></a>
<span class="sourceLineNo">493</span>                String initChainId = line.substring(19,20);<a name="line.493"></a>
<span class="sourceLineNo">494</span>                String initSeqNum  = line.substring(21,25).trim();<a name="line.494"></a>
<span class="sourceLineNo">495</span>                String initICode   = line.substring(25,26);<a name="line.495"></a>
<span class="sourceLineNo">496</span>                String endResName  = line.substring(27,30).trim();<a name="line.496"></a>
<span class="sourceLineNo">497</span>                String endChainId  = line.substring(31,32);<a name="line.497"></a>
<span class="sourceLineNo">498</span>                String endSeqNum   = line.substring(33,37).trim();<a name="line.498"></a>
<span class="sourceLineNo">499</span>                String endICode    = line.substring(37,38);<a name="line.499"></a>
<span class="sourceLineNo">500</span><a name="line.500"></a>
<span class="sourceLineNo">501</span>                //System.out.println(initResName + " " + initChainId + " " + initSeqNum + " " + initICode + " " +<a name="line.501"></a>
<span class="sourceLineNo">502</span>                //        endResName + " " + endChainId + " " + endSeqNum + " " + endICode);<a name="line.502"></a>
<span class="sourceLineNo">503</span><a name="line.503"></a>
<span class="sourceLineNo">504</span>                Map&lt;String,String&gt; m = new HashMap&lt;String,String&gt;();<a name="line.504"></a>
<span class="sourceLineNo">505</span><a name="line.505"></a>
<span class="sourceLineNo">506</span>                m.put("initResName",initResName);<a name="line.506"></a>
<span class="sourceLineNo">507</span>                m.put("initChainId", initChainId);<a name="line.507"></a>
<span class="sourceLineNo">508</span>                m.put("initSeqNum", initSeqNum);<a name="line.508"></a>
<span class="sourceLineNo">509</span>                m.put("initICode", initICode);<a name="line.509"></a>
<span class="sourceLineNo">510</span>                m.put("endResName", endResName);<a name="line.510"></a>
<span class="sourceLineNo">511</span>                m.put("endChainId", endChainId);<a name="line.511"></a>
<span class="sourceLineNo">512</span>                m.put("endSeqNum",endSeqNum);<a name="line.512"></a>
<span class="sourceLineNo">513</span>                m.put("endICode",endICode);<a name="line.513"></a>
<span class="sourceLineNo">514</span><a name="line.514"></a>
<span class="sourceLineNo">515</span>                helixList.add(m);<a name="line.515"></a>
<span class="sourceLineNo">516</span><a name="line.516"></a>
<span class="sourceLineNo">517</span>        }<a name="line.517"></a>
<span class="sourceLineNo">518</span><a name="line.518"></a>
<span class="sourceLineNo">519</span>        /**<a name="line.519"></a>
<span class="sourceLineNo">520</span>      Handler for<a name="line.520"></a>
<span class="sourceLineNo">521</span>      &lt;pre&gt;<a name="line.521"></a>
<span class="sourceLineNo">522</span>      COLUMNS     DATA TYPE        FIELD           DEFINITION<a name="line.522"></a>
<span class="sourceLineNo">523</span>--------------------------------------------------------------<a name="line.523"></a>
<span class="sourceLineNo">524</span> 1 -  6     Record name      "SHEET "<a name="line.524"></a>
<span class="sourceLineNo">525</span> 8 - 10     Integer          strand       Strand number which starts at 1<a name="line.525"></a>
<span class="sourceLineNo">526</span>                                          for each strand within a sheet<a name="line.526"></a>
<span class="sourceLineNo">527</span>                                          and increases by one.<a name="line.527"></a>
<span class="sourceLineNo">528</span>12 - 14     LString(3)       sheetID      Sheet identifier.<a name="line.528"></a>
<span class="sourceLineNo">529</span>15 - 16     Integer          numStrands   Number of strands in sheet.<a name="line.529"></a>
<span class="sourceLineNo">530</span>18 - 20     Residue name     initResName  Residue name of initial residue.<a name="line.530"></a>
<span class="sourceLineNo">531</span>22          Character        initChainID  Chain identifier of initial<a name="line.531"></a>
<span class="sourceLineNo">532</span>                                          residue in strand.<a name="line.532"></a>
<span class="sourceLineNo">533</span>23 - 26     Integer          initSeqNum   Sequence number of initial<a name="line.533"></a>
<span class="sourceLineNo">534</span>                                          residue in strand.<a name="line.534"></a>
<span class="sourceLineNo">535</span>27          AChar            initICode    Insertion code of initial residue<a name="line.535"></a>
<span class="sourceLineNo">536</span>                                          in strand.<a name="line.536"></a>
<span class="sourceLineNo">537</span>29 - 31     Residue name     endResName   Residue name of terminal residue.<a name="line.537"></a>
<span class="sourceLineNo">538</span>33          Character        endChainID   Chain identifier of terminal<a name="line.538"></a>
<span class="sourceLineNo">539</span>                                          residue.<a name="line.539"></a>
<span class="sourceLineNo">540</span>34 - 37     Integer          endSeqNum    Sequence number of terminal<a name="line.540"></a>
<span class="sourceLineNo">541</span>                                          residue.<a name="line.541"></a>
<span class="sourceLineNo">542</span>38          AChar            endICode     Insertion code of terminal<a name="line.542"></a>
<span class="sourceLineNo">543</span>                                          residue.<a name="line.543"></a>
<span class="sourceLineNo">544</span>39 - 40     Integer          sense        Sense of strand with respect to<a name="line.544"></a>
<span class="sourceLineNo">545</span>                                          previous strand in the sheet. 0<a name="line.545"></a>
<span class="sourceLineNo">546</span>                                          if first strand, 1 if parallel,<a name="line.546"></a>
<span class="sourceLineNo">547</span>                                          -1 if anti-parallel.<a name="line.547"></a>
<span class="sourceLineNo">548</span>42 - 45     Atom             curAtom      Registration. Atom name in<a name="line.548"></a>
<span class="sourceLineNo">549</span>                                          current strand.<a name="line.549"></a>
<span class="sourceLineNo">550</span>46 - 48     Residue name     curResName   Registration. Residue name in<a name="line.550"></a>
<span class="sourceLineNo">551</span>                                          current strand.<a name="line.551"></a>
<span class="sourceLineNo">552</span>50          Character        curChainId   Registration. Chain identifier in<a name="line.552"></a>
<span class="sourceLineNo">553</span>                                          current strand.<a name="line.553"></a>
<span class="sourceLineNo">554</span>51 - 54     Integer          curResSeq    Registration. Residue sequence<a name="line.554"></a>
<span class="sourceLineNo">555</span>                                          number in current strand.<a name="line.555"></a>
<span class="sourceLineNo">556</span>55          AChar            curICode     Registration. Insertion code in<a name="line.556"></a>
<span class="sourceLineNo">557</span>                                          current strand.<a name="line.557"></a>
<span class="sourceLineNo">558</span>57 - 60     Atom             prevAtom     Registration. Atom name in<a name="line.558"></a>
<span class="sourceLineNo">559</span>                                          previous strand.<a name="line.559"></a>
<span class="sourceLineNo">560</span>61 - 63     Residue name     prevResName  Registration. Residue name in<a name="line.560"></a>
<span class="sourceLineNo">561</span>                                          previous strand.<a name="line.561"></a>
<span class="sourceLineNo">562</span>65          Character        prevChainId  Registration. Chain identifier in<a name="line.562"></a>
<span class="sourceLineNo">563</span>                                          previous strand.<a name="line.563"></a>
<span class="sourceLineNo">564</span>66 - 69     Integer          prevResSeq   Registration. Residue sequence<a name="line.564"></a>
<span class="sourceLineNo">565</span>                                          number in previous strand.<a name="line.565"></a>
<span class="sourceLineNo">566</span>70          AChar            prevICode    Registration. Insertion code in<a name="line.566"></a>
<span class="sourceLineNo">567</span>                                              previous strand.<a name="line.567"></a>
<span class="sourceLineNo">568</span>&lt;/pre&gt;<a name="line.568"></a>
<span class="sourceLineNo">569</span><a name="line.569"></a>
<span class="sourceLineNo">570</span><a name="line.570"></a>
<span class="sourceLineNo">571</span>         */<a name="line.571"></a>
<span class="sourceLineNo">572</span>        private void pdb_SHEET_Handler( String line){<a name="line.572"></a>
<span class="sourceLineNo">573</span><a name="line.573"></a>
<span class="sourceLineNo">574</span><a name="line.574"></a>
<span class="sourceLineNo">575</span>                String initResName = line.substring(17,20).trim();<a name="line.575"></a>
<span class="sourceLineNo">576</span>                String initChainId = line.substring(21,22);<a name="line.576"></a>
<span class="sourceLineNo">577</span>                String initSeqNum  = line.substring(22,26).trim();<a name="line.577"></a>
<span class="sourceLineNo">578</span>                String initICode   = line.substring(26,27);<a name="line.578"></a>
<span class="sourceLineNo">579</span>                String endResName  = line.substring(28,31).trim();<a name="line.579"></a>
<span class="sourceLineNo">580</span>                String endChainId  = line.substring(32,33);<a name="line.580"></a>
<span class="sourceLineNo">581</span>                String endSeqNum   = line.substring(33,37).trim();<a name="line.581"></a>
<span class="sourceLineNo">582</span>                String endICode    = line.substring(37,38);<a name="line.582"></a>
<span class="sourceLineNo">583</span><a name="line.583"></a>
<span class="sourceLineNo">584</span>                //System.out.println(initResName + " " + initChainId + " " + initSeqNum + " " + initICode + " " +<a name="line.584"></a>
<span class="sourceLineNo">585</span>                //        endResName + " " + endChainId + " " + endSeqNum + " " + endICode);<a name="line.585"></a>
<span class="sourceLineNo">586</span><a name="line.586"></a>
<span class="sourceLineNo">587</span>                Map&lt;String,String&gt; m = new HashMap&lt;String,String&gt;();<a name="line.587"></a>
<span class="sourceLineNo">588</span><a name="line.588"></a>
<span class="sourceLineNo">589</span>                m.put("initResName",initResName);<a name="line.589"></a>
<span class="sourceLineNo">590</span>                m.put("initChainId", initChainId);<a name="line.590"></a>
<span class="sourceLineNo">591</span>                m.put("initSeqNum", initSeqNum);<a name="line.591"></a>
<span class="sourceLineNo">592</span>                m.put("initICode", initICode);<a name="line.592"></a>
<span class="sourceLineNo">593</span>                m.put("endResName", endResName);<a name="line.593"></a>
<span class="sourceLineNo">594</span>                m.put("endChainId", endChainId);<a name="line.594"></a>
<span class="sourceLineNo">595</span>                m.put("endSeqNum",endSeqNum);<a name="line.595"></a>
<span class="sourceLineNo">596</span>                m.put("endICode",endICode);<a name="line.596"></a>
<span class="sourceLineNo">597</span><a name="line.597"></a>
<span class="sourceLineNo">598</span>                strandList.add(m);<a name="line.598"></a>
<span class="sourceLineNo">599</span>        }<a name="line.599"></a>
<span class="sourceLineNo">600</span><a name="line.600"></a>
<span class="sourceLineNo">601</span><a name="line.601"></a>
<span class="sourceLineNo">602</span>        /**<a name="line.602"></a>
<span class="sourceLineNo">603</span>         * Handler for TURN lines<a name="line.603"></a>
<span class="sourceLineNo">604</span>     &lt;pre&gt;<a name="line.604"></a>
<span class="sourceLineNo">605</span>     COLUMNS      DATA TYPE        FIELD         DEFINITION<a name="line.605"></a>
<span class="sourceLineNo">606</span>--------------------------------------------------------------------<a name="line.606"></a>
<span class="sourceLineNo">607</span> 1 -  6      Record name      "TURN "<a name="line.607"></a>
<span class="sourceLineNo">608</span> 8 - 10      Integer          seq           Turn number; starts with 1 and<a name="line.608"></a>
<span class="sourceLineNo">609</span>                                            increments by one.<a name="line.609"></a>
<span class="sourceLineNo">610</span>12 - 14      LString(3)       turnId        Turn identifier<a name="line.610"></a>
<span class="sourceLineNo">611</span>16 - 18      Residue name     initResName   Residue name of initial residue in<a name="line.611"></a>
<span class="sourceLineNo">612</span>                                            turn.<a name="line.612"></a>
<span class="sourceLineNo">613</span>20           Character        initChainId   Chain identifier for the chain<a name="line.613"></a>
<span class="sourceLineNo">614</span>                                            containing this turn.<a name="line.614"></a>
<span class="sourceLineNo">615</span>21 - 24      Integer          initSeqNum    Sequence number of initial residue<a name="line.615"></a>
<span class="sourceLineNo">616</span>                                            in turn.<a name="line.616"></a>
<span class="sourceLineNo">617</span>25           AChar            initICode     Insertion code of initial residue<a name="line.617"></a>
<span class="sourceLineNo">618</span>                                            in turn.<a name="line.618"></a>
<span class="sourceLineNo">619</span>27 - 29      Residue name     endResName    Residue name of terminal residue<a name="line.619"></a>
<span class="sourceLineNo">620</span>                                            of turn.<a name="line.620"></a>
<span class="sourceLineNo">621</span>31           Character        endChainId    Chain identifier for the chain<a name="line.621"></a>
<span class="sourceLineNo">622</span>                                            containing this turn.<a name="line.622"></a>
<span class="sourceLineNo">623</span>32 - 35      Integer          endSeqNum     Sequence number of terminal<a name="line.623"></a>
<span class="sourceLineNo">624</span>                                            residue of turn.<a name="line.624"></a>
<span class="sourceLineNo">625</span>36           AChar            endICode      Insertion code of terminal residue<a name="line.625"></a>
<span class="sourceLineNo">626</span>                                            of turn.<a name="line.626"></a>
<span class="sourceLineNo">627</span>41 - 70      String           comment       Associated comment.<a name="line.627"></a>
<span class="sourceLineNo">628</span><a name="line.628"></a>
<span class="sourceLineNo">629</span>     &lt;/pre&gt;<a name="line.629"></a>
<span class="sourceLineNo">630</span>         * @param line<a name="line.630"></a>
<span class="sourceLineNo">631</span>         */<a name="line.631"></a>
<span class="sourceLineNo">632</span>        private void pdb_TURN_Handler( String line){<a name="line.632"></a>
<span class="sourceLineNo">633</span>                String initResName = line.substring(15,18).trim();<a name="line.633"></a>
<span class="sourceLineNo">634</span>                String initChainId = line.substring(19,20);<a name="line.634"></a>
<span class="sourceLineNo">635</span>                String initSeqNum  = line.substring(20,24).trim();<a name="line.635"></a>
<span class="sourceLineNo">636</span>                String initICode   = line.substring(24,25);<a name="line.636"></a>
<span class="sourceLineNo">637</span>                String endResName  = line.substring(26,29).trim();<a name="line.637"></a>
<span class="sourceLineNo">638</span>                String endChainId  = line.substring(30,31);<a name="line.638"></a>
<span class="sourceLineNo">639</span>                String endSeqNum   = line.substring(31,35).trim();<a name="line.639"></a>
<span class="sourceLineNo">640</span>                String endICode    = line.substring(35,36);<a name="line.640"></a>
<span class="sourceLineNo">641</span><a name="line.641"></a>
<span class="sourceLineNo">642</span>                //System.out.println(initResName + " " + initChainId + " " + initSeqNum + " " + initICode + " " +<a name="line.642"></a>
<span class="sourceLineNo">643</span>                //        endResName + " " + endChainId + " " + endSeqNum + " " + endICode);<a name="line.643"></a>
<span class="sourceLineNo">644</span><a name="line.644"></a>
<span class="sourceLineNo">645</span>                Map&lt;String,String&gt; m = new HashMap&lt;String,String&gt;();<a name="line.645"></a>
<span class="sourceLineNo">646</span><a name="line.646"></a>
<span class="sourceLineNo">647</span>                m.put("initResName",initResName);<a name="line.647"></a>
<span class="sourceLineNo">648</span>                m.put("initChainId", initChainId);<a name="line.648"></a>
<span class="sourceLineNo">649</span>                m.put("initSeqNum", initSeqNum);<a name="line.649"></a>
<span class="sourceLineNo">650</span>                m.put("initICode", initICode);<a name="line.650"></a>
<span class="sourceLineNo">651</span>                m.put("endResName", endResName);<a name="line.651"></a>
<span class="sourceLineNo">652</span>                m.put("endChainId", endChainId);<a name="line.652"></a>
<span class="sourceLineNo">653</span>                m.put("endSeqNum",endSeqNum);<a name="line.653"></a>
<span class="sourceLineNo">654</span>                m.put("endICode",endICode);<a name="line.654"></a>
<span class="sourceLineNo">655</span><a name="line.655"></a>
<span class="sourceLineNo">656</span>                turnList.add(m);<a name="line.656"></a>
<span class="sourceLineNo">657</span>        }<a name="line.657"></a>
<span class="sourceLineNo">658</span><a name="line.658"></a>
<span class="sourceLineNo">659</span>        /**<a name="line.659"></a>
<span class="sourceLineNo">660</span>         Handler for<a name="line.660"></a>
<span class="sourceLineNo">661</span>         REVDAT Record format:<a name="line.661"></a>
<span class="sourceLineNo">662</span><a name="line.662"></a>
<span class="sourceLineNo">663</span>         COLUMNS       DATA TYPE      FIELD         DEFINITION<a name="line.663"></a>
<span class="sourceLineNo">664</span>         ----------------------------------------------------------------------------------<a name="line.664"></a>
<span class="sourceLineNo">665</span>         1 -  6       Record name    "REVDAT"<a name="line.665"></a>
<span class="sourceLineNo">666</span>         8 - 10       Integer        modNum        Modification number.<a name="line.666"></a>
<span class="sourceLineNo">667</span>         11 - 12       Continuation   continuation  Allows concatenation of multiple<a name="line.667"></a>
<span class="sourceLineNo">668</span>         records.<a name="line.668"></a>
<span class="sourceLineNo">669</span>         14 - 22       Date           modDate       Date of modification (or release for<a name="line.669"></a>
<span class="sourceLineNo">670</span>         new entries).  This is not repeated<a name="line.670"></a>
<span class="sourceLineNo">671</span>         on continuation lines.<a name="line.671"></a>
<span class="sourceLineNo">672</span>         24 - 28       String(5)      modId         Identifies this particular<a name="line.672"></a>
<span class="sourceLineNo">673</span>         modification.  It links to the<a name="line.673"></a>
<span class="sourceLineNo">674</span>         archive used internally by PDB.<a name="line.674"></a>
<span class="sourceLineNo">675</span>         This is not repeated on continuation<a name="line.675"></a>
<span class="sourceLineNo">676</span>         lines.<a name="line.676"></a>
<span class="sourceLineNo">677</span>         32            Integer        modType       An integer identifying the type of<a name="line.677"></a>
<span class="sourceLineNo">678</span>         modification.  In case of revisions<a name="line.678"></a>
<span class="sourceLineNo">679</span>         with more than one possible modType,<a name="line.679"></a>
<span class="sourceLineNo">680</span>         the highest value applicable will be<a name="line.680"></a>
<span class="sourceLineNo">681</span>         assigned.<a name="line.681"></a>
<span class="sourceLineNo">682</span>         40 - 45       LString(6)     record        Name of the modified record.<a name="line.682"></a>
<span class="sourceLineNo">683</span>         47 - 52       LString(6)     record        Name of the modified record.<a name="line.683"></a>
<span class="sourceLineNo">684</span>         54 - 59       LString(6)     record        Name of the modified record.<a name="line.684"></a>
<span class="sourceLineNo">685</span>         61 - 66       LString(6)     record        Name of the modified record.<a name="line.685"></a>
<span class="sourceLineNo">686</span>         */<a name="line.686"></a>
<span class="sourceLineNo">687</span>        private void pdb_REVDAT_Handler(String line) {<a name="line.687"></a>
<span class="sourceLineNo">688</span><a name="line.688"></a>
<span class="sourceLineNo">689</span>                // only keep the first...<a name="line.689"></a>
<span class="sourceLineNo">690</span>                String modDate = (String) header.get("modDate");<a name="line.690"></a>
<span class="sourceLineNo">691</span><a name="line.691"></a>
<span class="sourceLineNo">692</span>                if ( modDate.equals("0000-00-00") ) {<a name="line.692"></a>
<span class="sourceLineNo">693</span>                        // modDate is still initialized<a name="line.693"></a>
<span class="sourceLineNo">694</span>                        String modificationDate = line.substring (13, 22).trim() ;<a name="line.694"></a>
<span class="sourceLineNo">695</span>                        header.put("modDate",modificationDate);<a name="line.695"></a>
<span class="sourceLineNo">696</span><a name="line.696"></a>
<span class="sourceLineNo">697</span>                        try {<a name="line.697"></a>
<span class="sourceLineNo">698</span>                                Date dep = dateFormat.parse(modificationDate);<a name="line.698"></a>
<span class="sourceLineNo">699</span>                                pdbHeader.setModDate(dep);<a name="line.699"></a>
<span class="sourceLineNo">700</span>                        } catch (ParseException e){<a name="line.700"></a>
<span class="sourceLineNo">701</span>                                e.printStackTrace();<a name="line.701"></a>
<span class="sourceLineNo">702</span>                        }<a name="line.702"></a>
<span class="sourceLineNo">703</span><a name="line.703"></a>
<span class="sourceLineNo">704</span>                }<a name="line.704"></a>
<span class="sourceLineNo">705</span>        }<a name="line.705"></a>
<span class="sourceLineNo">706</span><a name="line.706"></a>
<span class="sourceLineNo">707</span>        /** @author Jules Jacobsen<a name="line.707"></a>
<span class="sourceLineNo">708</span>         * Handler for<a name="line.708"></a>
<span class="sourceLineNo">709</span>         * SEQRES record format<a name="line.709"></a>
<span class="sourceLineNo">710</span>         * SEQRES records contain the amino acid or nucleic acid sequence of residues in each chain of the macromolecule that was studied.<a name="line.710"></a>
<span class="sourceLineNo">711</span>         * &lt;p/&gt;<a name="line.711"></a>
<span class="sourceLineNo">712</span>         * Record Format<a name="line.712"></a>
<span class="sourceLineNo">713</span>         * &lt;p/&gt;<a name="line.713"></a>
<span class="sourceLineNo">714</span>         * COLUMNS        DATA TYPE       FIELD         DEFINITION<a name="line.714"></a>
<span class="sourceLineNo">715</span>         * ---------------------------------------------------------------------------------<a name="line.715"></a>
<span class="sourceLineNo">716</span>         * 1 -  6        Record name     "SEQRES"<a name="line.716"></a>
<span class="sourceLineNo">717</span>         * &lt;p/&gt;<a name="line.717"></a>
<span class="sourceLineNo">718</span>         * 9 - 10        Integer         serNum        Serial number of the SEQRES record<a name="line.718"></a>
<span class="sourceLineNo">719</span>         * for the current chain.  Starts at 1<a name="line.719"></a>
<span class="sourceLineNo">720</span>         * and increments by one each line.<a name="line.720"></a>
<span class="sourceLineNo">721</span>         * Reset to 1 for each chain.<a name="line.721"></a>
<span class="sourceLineNo">722</span>         * &lt;p/&gt;<a name="line.722"></a>
<span class="sourceLineNo">723</span>         * 12             Character       chainID       Chain identifier.  This may be any<a name="line.723"></a>
<span class="sourceLineNo">724</span>         * single legal character, including a<a name="line.724"></a>
<span class="sourceLineNo">725</span>         * blank which is used if there is<a name="line.725"></a>
<span class="sourceLineNo">726</span>         * only one chain.<a name="line.726"></a>
<span class="sourceLineNo">727</span>         * &lt;p/&gt;<a name="line.727"></a>
<span class="sourceLineNo">728</span>         * 14 - 17        Integer         numRes        Number of residues in the chain.<a name="line.728"></a>
<span class="sourceLineNo">729</span>         * This value is repeated on every<a name="line.729"></a>
<span class="sourceLineNo">730</span>         * record.<a name="line.730"></a>
<span class="sourceLineNo">731</span>         * &lt;p/&gt;<a name="line.731"></a>
<span class="sourceLineNo">732</span>         * 20 - 22        Residue name    resName       Residue name.<a name="line.732"></a>
<span class="sourceLineNo">733</span>         * &lt;p/&gt;<a name="line.733"></a>
<span class="sourceLineNo">734</span>         * 24 - 26        Residue name    resName       Residue name.<a name="line.734"></a>
<span class="sourceLineNo">735</span>         * &lt;p/&gt;<a name="line.735"></a>
<span class="sourceLineNo">736</span>         * 28 - 30        Residue name    resName       Residue name.<a name="line.736"></a>
<span class="sourceLineNo">737</span>         * &lt;p/&gt;<a name="line.737"></a>
<span class="sourceLineNo">738</span>         * 32 - 34        Residue name    resName       Residue name.<a name="line.738"></a>
<span class="sourceLineNo">739</span>         * &lt;p/&gt;<a name="line.739"></a>
<span class="sourceLineNo">740</span>         * 36 - 38        Residue name    resName       Residue name.<a name="line.740"></a>
<span class="sourceLineNo">741</span>         * &lt;p/&gt;<a name="line.741"></a>
<span class="sourceLineNo">742</span>         * 40 - 42        Residue name    resName       Residue name.<a name="line.742"></a>
<span class="sourceLineNo">743</span>         * &lt;p/&gt;<a name="line.743"></a>
<span class="sourceLineNo">744</span>         * 44 - 46        Residue name    resName       Residue name.<a name="line.744"></a>
<span class="sourceLineNo">745</span>         * &lt;p/&gt;<a name="line.745"></a>
<span class="sourceLineNo">746</span>         * 48 - 50        Residue name    resName       Residue name.<a name="line.746"></a>
<span class="sourceLineNo">747</span>         * &lt;p/&gt;<a name="line.747"></a>
<span class="sourceLineNo">748</span>         * 52 - 54        Residue name    resName       Residue name.<a name="line.748"></a>
<span class="sourceLineNo">749</span>         * &lt;p/&gt;<a name="line.749"></a>
<span class="sourceLineNo">750</span>         * 56 - 58        Residue name    resName       Residue name.<a name="line.750"></a>
<span class="sourceLineNo">751</span>         * &lt;p/&gt;<a name="line.751"></a>
<span class="sourceLineNo">752</span>         * 60 - 62        Residue name    resName       Residue name.<a name="line.752"></a>
<span class="sourceLineNo">753</span>         * &lt;p/&gt;<a name="line.753"></a>
<span class="sourceLineNo">754</span>         * 64 - 66        Residue name    resName       Residue name.<a name="line.754"></a>
<span class="sourceLineNo">755</span>         * &lt;p/&gt;<a name="line.755"></a>
<span class="sourceLineNo">756</span>         * 68 - 70        Residue name    resName       Residue name.<a name="line.756"></a>
<span class="sourceLineNo">757</span>         */<a name="line.757"></a>
<span class="sourceLineNo">758</span>        private void pdb_SEQRES_Handler(String line)<a name="line.758"></a>
<span class="sourceLineNo">759</span>        throws PDBParseException {<a name="line.759"></a>
<span class="sourceLineNo">760</span>                //              System.out.println("PDBFileParser.pdb_SEQRES_Handler: BEGIN");<a name="line.760"></a>
<span class="sourceLineNo">761</span>                //              System.out.println(line);<a name="line.761"></a>
<span class="sourceLineNo">762</span><a name="line.762"></a>
<span class="sourceLineNo">763</span>                //TODO: treat the following residues as amino acids?<a name="line.763"></a>
<span class="sourceLineNo">764</span>                /*<a name="line.764"></a>
<span class="sourceLineNo">765</span>        MSE Selenomethionine<a name="line.765"></a>
<span class="sourceLineNo">766</span>        CSE Selenocysteine<a name="line.766"></a>
<span class="sourceLineNo">767</span>        PTR Phosphotyrosine<a name="line.767"></a>
<span class="sourceLineNo">768</span>        SEP Phosphoserine<a name="line.768"></a>
<span class="sourceLineNo">769</span>        TPO Phosphothreonine<a name="line.769"></a>
<span class="sourceLineNo">770</span>        HYP 4-hydroxyproline<a name="line.770"></a>
<span class="sourceLineNo">771</span>        5HP Pyroglutamic acid; 5-hydroxyproline<a name="line.771"></a>
<span class="sourceLineNo">772</span>        PCA Pyroglutamic Acid<a name="line.772"></a>
<span class="sourceLineNo">773</span>        LYZ 5-hydroxylysine<a name="line.773"></a>
<span class="sourceLineNo">774</span>        GLX Glu or Gln<a name="line.774"></a>
<span class="sourceLineNo">775</span>        ASX Asp or Asn<a name="line.775"></a>
<span class="sourceLineNo">776</span>        GLA gamma-carboxy-glutamic acid<a name="line.776"></a>
<span class="sourceLineNo">777</span>                 1         2         3         4         5         6         7<a name="line.777"></a>
<span class="sourceLineNo">778</span>        1234567890123456789012345678901234567890123456789012345678901234567890<a name="line.778"></a>
<span class="sourceLineNo">779</span>        SEQRES   1 A  376  LYS PRO VAL THR VAL LYS LEU VAL ASP SER GLN ALA THR<a name="line.779"></a>
<span class="sourceLineNo">780</span>        SEQRES   1 A   21  GLY ILE VAL GLU GLN CYS CYS THR SER ILE CYS SER LEU<a name="line.780"></a>
<span class="sourceLineNo">781</span>        SEQRES   2 A   21  TYR GLN LEU GLU ASN TYR CYS ASN<a name="line.781"></a>
<span class="sourceLineNo">782</span>        SEQRES   1 B   30  PHE VAL ASN GLN HIS LEU CYS GLY SER HIS LEU VAL GLU<a name="line.782"></a>
<span class="sourceLineNo">783</span>        SEQRES   2 B   30  ALA LEU TYR LEU VAL CYS GLY GLU ARG GLY PHE PHE TYR<a name="line.783"></a>
<span class="sourceLineNo">784</span>        SEQRES   3 B   30  THR PRO LYS ALA<a name="line.784"></a>
<span class="sourceLineNo">785</span>        SEQRES   1 C   21  GLY ILE VAL GLU GLN CYS CYS THR SER ILE CYS SER LEU<a name="line.785"></a>
<span class="sourceLineNo">786</span>        SEQRES   2 C   21  TYR GLN LEU GLU ASN TYR CYS ASN<a name="line.786"></a>
<span class="sourceLineNo">787</span>        SEQRES   1 D   30  PHE VAL ASN GLN HIS LEU CYS GLY SER HIS LEU VAL GLU<a name="line.787"></a>
<span class="sourceLineNo">788</span>        SEQRES   2 D   30  ALA LEU TYR LEU VAL CYS GLY GLU ARG GLY PHE PHE TYR<a name="line.788"></a>
<span class="sourceLineNo">789</span>        SEQRES   3 D   30  THR PRO LYS ALA<a name="line.789"></a>
<span class="sourceLineNo">790</span>                 */<a name="line.790"></a>
<span class="sourceLineNo">791</span><a name="line.791"></a>
<span class="sourceLineNo">792</span>                //System.out.println(line);<a name="line.792"></a>
<span class="sourceLineNo">793</span>                String recordName = line.substring(0, 6).trim();<a name="line.793"></a>
<span class="sourceLineNo">794</span>                String chainID    = line.substring(11, 12);<a name="line.794"></a>
<span class="sourceLineNo">795</span>                String newLength   = line.substring(13,17).trim();<a name="line.795"></a>
<span class="sourceLineNo">796</span>                String subSequence = line.substring(18, 70);<a name="line.796"></a>
<span class="sourceLineNo">797</span><a name="line.797"></a>
<span class="sourceLineNo">798</span>                //System.out.println("newLength " + newLength );<a name="line.798"></a>
<span class="sourceLineNo">799</span><a name="line.799"></a>
<span class="sourceLineNo">800</span>                if ( lengthCheck == -1 ){<a name="line.800"></a>
<span class="sourceLineNo">801</span>                        lengthCheck = Integer.parseInt(newLength);<a name="line.801"></a>
<span class="sourceLineNo">802</span>                }<a name="line.802"></a>
<span class="sourceLineNo">803</span><a name="line.803"></a>
<span class="sourceLineNo">804</span>                //String resNum = line.substring(22, 27).trim() ;<a name="line.804"></a>
<span class="sourceLineNo">805</span>                StringTokenizer subSequenceResidues = new StringTokenizer(subSequence);<a name="line.805"></a>
<span class="sourceLineNo">806</span><a name="line.806"></a>
<span class="sourceLineNo">807</span>                Character aminoCode1 = null;<a name="line.807"></a>
<span class="sourceLineNo">808</span>                if (! recordName.equals(AminoAcid.SEQRESRECORD)) {<a name="line.808"></a>
<span class="sourceLineNo">809</span>                        // should not have been called<a name="line.809"></a>
<span class="sourceLineNo">810</span>                        return;<a name="line.810"></a>
<span class="sourceLineNo">811</span>                }<a name="line.811"></a>
<span class="sourceLineNo">812</span><a name="line.812"></a>
<span class="sourceLineNo">813</span>                current_chain = isKnownChain(chainID, seqResChains);<a name="line.813"></a>
<span class="sourceLineNo">814</span>                if ( current_chain == null) {<a name="line.814"></a>
<span class="sourceLineNo">815</span><a name="line.815"></a>
<span class="sourceLineNo">816</span>                        current_chain = new ChainImpl();<a name="line.816"></a>
<span class="sourceLineNo">817</span>                        current_chain.setChainID(chainID);<a name="line.817"></a>
<span class="sourceLineNo">818</span><a name="line.818"></a>
<span class="sourceLineNo">819</span>                }<a name="line.819"></a>
<span class="sourceLineNo">820</span><a name="line.820"></a>
<span class="sourceLineNo">821</span>                while (subSequenceResidues.hasMoreTokens()) {<a name="line.821"></a>
<span class="sourceLineNo">822</span><a name="line.822"></a>
<span class="sourceLineNo">823</span>                        String threeLetter = subSequenceResidues.nextToken();<a name="line.823"></a>
<span class="sourceLineNo">824</span><a name="line.824"></a>
<span class="sourceLineNo">825</span>                        aminoCode1 = StructureTools.get1LetterCode(threeLetter);<a name="line.825"></a>
<span class="sourceLineNo">826</span>                        //System.out.println(aminoCode1);<a name="line.826"></a>
<span class="sourceLineNo">827</span>                        //if (aminoCode1 == null) {<a name="line.827"></a>
<span class="sourceLineNo">828</span>                        // could be a nucleotide...<a name="line.828"></a>
<span class="sourceLineNo">829</span>                        // but getNewGroup takes care of that and converts ATOM records with aminoCode1 == nnull to nucleotide...<a name="line.829"></a>
<span class="sourceLineNo">830</span>                        //System.out.println(line);<a name="line.830"></a>
<span class="sourceLineNo">831</span>                        // b<a name="line.831"></a>
<span class="sourceLineNo">832</span>                        //}<a name="line.832"></a>
<span class="sourceLineNo">833</span>                        current_group = getNewGroup("ATOM", aminoCode1, threeLetter);<a name="line.833"></a>
<span class="sourceLineNo">834</span><a name="line.834"></a>
<span class="sourceLineNo">835</span>                        try {<a name="line.835"></a>
<span class="sourceLineNo">836</span>                                current_group.setPDBName(threeLetter);<a name="line.836"></a>
<span class="sourceLineNo">837</span>                        } catch (PDBParseException p){<a name="line.837"></a>
<span class="sourceLineNo">838</span>                                logger.fine(p.getMessage() );<a name="line.838"></a>
<span class="sourceLineNo">839</span>                        }<a name="line.839"></a>
<span class="sourceLineNo">840</span>                        if ( current_group instanceof AminoAcid){<a name="line.840"></a>
<span class="sourceLineNo">841</span>                                AminoAcid aa = (AminoAcid)current_group;<a name="line.841"></a>
<span class="sourceLineNo">842</span>                                aa.setRecordType(AminoAcid.SEQRESRECORD);<a name="line.842"></a>
<span class="sourceLineNo">843</span>                        }<a name="line.843"></a>
<span class="sourceLineNo">844</span>                        // add the current resNum to the new chain.<a name="line.844"></a>
<span class="sourceLineNo">845</span>                        current_chain.addGroup(current_group);<a name="line.845"></a>
<span class="sourceLineNo">846</span><a name="line.846"></a>
<span class="sourceLineNo">847</span>                }<a name="line.847"></a>
<span class="sourceLineNo">848</span>                Chain test = isKnownChain(chainID, seqResChains);<a name="line.848"></a>
<span class="sourceLineNo">849</span><a name="line.849"></a>
<span class="sourceLineNo">850</span>                if ( test == null)<a name="line.850"></a>
<span class="sourceLineNo">851</span>                        seqResChains.add(current_chain);<a name="line.851"></a>
<span class="sourceLineNo">852</span><a name="line.852"></a>
<span class="sourceLineNo">853</span>                current_group = null;<a name="line.853"></a>
<span class="sourceLineNo">854</span>                current_chain = null;<a name="line.854"></a>
<span class="sourceLineNo">855</span><a name="line.855"></a>
<span class="sourceLineNo">856</span>                //               the current chain is finished!<a name="line.856"></a>
<span class="sourceLineNo">857</span>                //if ( current_chain.getLength() != lengthCheck ){<a name="line.857"></a>
<span class="sourceLineNo">858</span>                //      System.err.println("the length of chain " + current_chain.getName() + "(" +<a name="line.858"></a>
<span class="sourceLineNo">859</span>                //                      current_chain.getLength() + ") does not match the expected " + lengthCheck);<a name="line.859"></a>
<span class="sourceLineNo">860</span>                //}<a name="line.860"></a>
<span class="sourceLineNo">861</span><a name="line.861"></a>
<span class="sourceLineNo">862</span>                lengthCheck = Integer.parseInt(newLength);<a name="line.862"></a>
<span class="sourceLineNo">863</span><a name="line.863"></a>
<span class="sourceLineNo">864</span>        }<a name="line.864"></a>
<span class="sourceLineNo">865</span><a name="line.865"></a>
<span class="sourceLineNo">866</span><a name="line.866"></a>
<span class="sourceLineNo">867</span><a name="line.867"></a>
<span class="sourceLineNo">868</span>        /** Handler for<a name="line.868"></a>
<span class="sourceLineNo">869</span>         TITLE Record Format<a name="line.869"></a>
<span class="sourceLineNo">870</span><a name="line.870"></a>
<span class="sourceLineNo">871</span>         COLUMNS        DATA TYPE       FIELD          DEFINITION<a name="line.871"></a>
<span class="sourceLineNo">872</span>         ----------------------------------------------------------------------------------<a name="line.872"></a>
<span class="sourceLineNo">873</span>         1 -  6        Record name     "TITLE "<a name="line.873"></a>
<span class="sourceLineNo">874</span>         9 - 10        Continuation    continuation   Allows concatenation of multiple<a name="line.874"></a>
<span class="sourceLineNo">875</span>         records.<a name="line.875"></a>
<span class="sourceLineNo">876</span>         11 - 70        String          title          Title of the experiment.<a name="line.876"></a>
<span class="sourceLineNo">877</span><a name="line.877"></a>
<span class="sourceLineNo">878</span><a name="line.878"></a>
<span class="sourceLineNo">879</span>         */<a name="line.879"></a>
<span class="sourceLineNo">880</span>        private void pdb_TITLE_Handler(String line) {<a name="line.880"></a>
<span class="sourceLineNo">881</span>                String title;<a name="line.881"></a>
<span class="sourceLineNo">882</span>                if ( line.length() &gt; 79)<a name="line.882"></a>
<span class="sourceLineNo">883</span>                        title = line.substring(10,80).trim();<a name="line.883"></a>
<span class="sourceLineNo">884</span>                else<a name="line.884"></a>
<span class="sourceLineNo">885</span>                        title = line.substring(10,line.length()).trim();<a name="line.885"></a>
<span class="sourceLineNo">886</span><a name="line.886"></a>
<span class="sourceLineNo">887</span>                String t= (String)header.get("title") ;<a name="line.887"></a>
<span class="sourceLineNo">888</span>                if ( (t != null) &amp;&amp; (! t.equals("")))<a name="line.888"></a>
<span class="sourceLineNo">889</span>                        t += " ";<a name="line.889"></a>
<span class="sourceLineNo">890</span>                t += title;<a name="line.890"></a>
<span class="sourceLineNo">891</span>                header.put("title",t);<a name="line.891"></a>
<span class="sourceLineNo">892</span>                pdbHeader.setTitle(t);<a name="line.892"></a>
<span class="sourceLineNo">893</span>        }<a name="line.893"></a>
<span class="sourceLineNo">894</span><a name="line.894"></a>
<span class="sourceLineNo">895</span>        /**<a name="line.895"></a>
<span class="sourceLineNo">896</span>         * JRNL handler.<a name="line.896"></a>
<span class="sourceLineNo">897</span>         * The JRNL record contains the primary literature citation that describes the experiment which resulted<a name="line.897"></a>
<span class="sourceLineNo">898</span>         * in the deposited coordinate set. There is at most one JRNL reference per entry. If there is no primary<a name="line.898"></a>
<span class="sourceLineNo">899</span>         * reference, then there is no JRNL reference. Other references are given in REMARK 1.<a name="line.899"></a>
<span class="sourceLineNo">900</span><a name="line.900"></a>
<span class="sourceLineNo">901</span>    Record Format<a name="line.901"></a>
<span class="sourceLineNo">902</span><a name="line.902"></a>
<span class="sourceLineNo">903</span>    COLUMNS       DATA TYPE     FIELD         DEFINITION<a name="line.903"></a>
<span class="sourceLineNo">904</span>    -----------------------------------------------------------------------<a name="line.904"></a>
<span class="sourceLineNo">905</span>    1 -  6       Record name   "JRNL  "<a name="line.905"></a>
<span class="sourceLineNo">906</span><a name="line.906"></a>
<span class="sourceLineNo">907</span>    13 - 70       LString        text         See Details below.<a name="line.907"></a>
<span class="sourceLineNo">908</span><a name="line.908"></a>
<span class="sourceLineNo">909</span>         */<a name="line.909"></a>
<span class="sourceLineNo">910</span>        private void pdb_JRNL_Handler(String line) {<a name="line.910"></a>
<span class="sourceLineNo">911</span>                //add the strings to the journalLines<a name="line.911"></a>
<span class="sourceLineNo">912</span>                //the actual JournalArticle is then built when the whole entry is being<a name="line.912"></a>
<span class="sourceLineNo">913</span>                //finalized with triggerEndFileChecks()<a name="line.913"></a>
<span class="sourceLineNo">914</span>                //JRNL        TITL   NMR SOLUTION STRUCTURE OF RECOMBINANT TICK           1TAP  10<a name="line.914"></a>
<span class="sourceLineNo">915</span>                if (line.substring(line.length() - 8, line.length() - 4).equals(pdbId)) {<a name="line.915"></a>
<span class="sourceLineNo">916</span>                        //trim off the trailing PDB id from legacy files.<a name="line.916"></a>
<span class="sourceLineNo">917</span>                        //are we really trying to still cater for these museum pieces?<a name="line.917"></a>
<span class="sourceLineNo">918</span>                        if (DEBUG) {<a name="line.918"></a>
<span class="sourceLineNo">919</span>                                System.out.println("trimming legacy PDB id from end of JRNL section line");<a name="line.919"></a>
<span class="sourceLineNo">920</span>                        }<a name="line.920"></a>
<span class="sourceLineNo">921</span>                        line = line.substring(0, line.length() - 8);<a name="line.921"></a>
<span class="sourceLineNo">922</span>                        journalLines.add(line);<a name="line.922"></a>
<span class="sourceLineNo">923</span>                } else {<a name="line.923"></a>
<span class="sourceLineNo">924</span>                        journalLines.add(line);<a name="line.924"></a>
<span class="sourceLineNo">925</span>                }<a name="line.925"></a>
<span class="sourceLineNo">926</span>        }<a name="line.926"></a>
<span class="sourceLineNo">927</span><a name="line.927"></a>
<span class="sourceLineNo">928</span>        /**<a name="line.928"></a>
<span class="sourceLineNo">929</span>         * This should not be accessed directly, other than by &lt;/code&gt;makeCompounds&lt;/code&gt;. It still deals with the same<a name="line.929"></a>
<span class="sourceLineNo">930</span>         * lines in a similar manner but if not accessed from &lt;/code&gt;makeCompounds&lt;/code&gt; the last element will be<a name="line.930"></a>
<span class="sourceLineNo">931</span>         * missing. Don't say I didn't warn you.<a name="line.931"></a>
<span class="sourceLineNo">932</span>         *<a name="line.932"></a>
<span class="sourceLineNo">933</span>         * @param line<a name="line.933"></a>
<span class="sourceLineNo">934</span>         */<a name="line.934"></a>
<span class="sourceLineNo">935</span>        private void pdb_COMPND_Handler(String line) {<a name="line.935"></a>
<span class="sourceLineNo">936</span><a name="line.936"></a>
<span class="sourceLineNo">937</span>                String continuationNr = line.substring(9, 10).trim();<a name="line.937"></a>
<span class="sourceLineNo">938</span>                if (DEBUG) {<a name="line.938"></a>
<span class="sourceLineNo">939</span>                        System.out.println("current continuationNo     is "<a name="line.939"></a>
<span class="sourceLineNo">940</span>                                        + continuationNr);<a name="line.940"></a>
<span class="sourceLineNo">941</span>                        System.out.println("previousContinuationField  is "<a name="line.941"></a>
<span class="sourceLineNo">942</span>                                        + previousContinuationField);<a name="line.942"></a>
<span class="sourceLineNo">943</span>                        System.out.println("current continuationField  is "<a name="line.943"></a>
<span class="sourceLineNo">944</span>                                        + continuationField);<a name="line.944"></a>
<span class="sourceLineNo">945</span>                        System.out.println("current continuationString is "<a name="line.945"></a>
<span class="sourceLineNo">946</span>                                        + continuationString);<a name="line.946"></a>
<span class="sourceLineNo">947</span>                        System.out.println("current compound           is "<a name="line.947"></a>
<span class="sourceLineNo">948</span>                                        + current_compound);<a name="line.948"></a>
<span class="sourceLineNo">949</span>                }<a name="line.949"></a>
<span class="sourceLineNo">950</span><a name="line.950"></a>
<span class="sourceLineNo">951</span>                // In legacy PDB files the line ends with the PDB code and a serial number, chop those off!<a name="line.951"></a>
<span class="sourceLineNo">952</span>                //format version 3.0 onwards will have 80 characters in a line<a name="line.952"></a>
<span class="sourceLineNo">953</span>                //              if (line.length() &gt; 72) {<a name="line.953"></a>
<span class="sourceLineNo">954</span>                if (isLegacyFormat) {<a name="line.954"></a>
<span class="sourceLineNo">955</span>                        //                    if (DEBUG) {<a name="line.955"></a>
<span class="sourceLineNo">956</span>                        //                        System.out.println("We have a legacy file - truncating line length to 71 characters:");<a name="line.956"></a>
<span class="sourceLineNo">957</span>                        //                        System.out.println(line);<a name="line.957"></a>
<span class="sourceLineNo">958</span>                        //                    }<a name="line.958"></a>
<span class="sourceLineNo">959</span>                        line = line.substring(0, 72);<a name="line.959"></a>
<span class="sourceLineNo">960</span>                }<a name="line.960"></a>
<span class="sourceLineNo">961</span><a name="line.961"></a>
<span class="sourceLineNo">962</span>                //String beginningOfLine = line.substring(0, 10);<a name="line.962"></a>
<span class="sourceLineNo">963</span>                //line = line.replace(beginningOfLine, "");<a name="line.963"></a>
<span class="sourceLineNo">964</span>                line = line.substring(10, line.length());<a name="line.964"></a>
<span class="sourceLineNo">965</span><a name="line.965"></a>
<span class="sourceLineNo">966</span>                if (DEBUG) {<a name="line.966"></a>
<span class="sourceLineNo">967</span>                        System.out.println("LINE: &gt;" + line + "&lt;");<a name="line.967"></a>
<span class="sourceLineNo">968</span>                }<a name="line.968"></a>
<span class="sourceLineNo">969</span>                String[] fieldList = line.split("\\s+");<a name="line.969"></a>
<span class="sourceLineNo">970</span>                int fl = fieldList.length;<a name="line.970"></a>
<span class="sourceLineNo">971</span>                if ((fl &gt;0 ) &amp;&amp; (!fieldList[0].equals(""))<a name="line.971"></a>
<span class="sourceLineNo">972</span>                                &amp;&amp; compndFieldValues.contains(fieldList[0])) {<a name="line.972"></a>
<span class="sourceLineNo">973</span>                        //                      System.out.println("[PDBFileParser.pdb_COMPND_Handler] Setting continuationField to '" + fieldList[0] + "'");<a name="line.973"></a>
<span class="sourceLineNo">974</span>                        continuationField = fieldList[0];<a name="line.974"></a>
<span class="sourceLineNo">975</span>                        if (previousContinuationField.equals("")) {<a name="line.975"></a>
<span class="sourceLineNo">976</span>                                previousContinuationField = continuationField;<a name="line.976"></a>
<span class="sourceLineNo">977</span>                        }<a name="line.977"></a>
<span class="sourceLineNo">978</span><a name="line.978"></a>
<span class="sourceLineNo">979</span>                } else if ((fl &gt;1 ) &amp;&amp; compndFieldValues.contains(fieldList[1])) {<a name="line.979"></a>
<span class="sourceLineNo">980</span>                        //                      System.out.println("[PDBFileParser.pdb_COMPND_Handler] Setting continuationField to '" + fieldList[1] + "'");<a name="line.980"></a>
<span class="sourceLineNo">981</span>                        continuationField = fieldList[1];<a name="line.981"></a>
<span class="sourceLineNo">982</span>                        if (previousContinuationField.equals("")) {<a name="line.982"></a>
<span class="sourceLineNo">983</span>                                previousContinuationField = continuationField;<a name="line.983"></a>
<span class="sourceLineNo">984</span>                        }<a name="line.984"></a>
<span class="sourceLineNo">985</span><a name="line.985"></a>
<span class="sourceLineNo">986</span>                } else {<a name="line.986"></a>
<span class="sourceLineNo">987</span>                        if (continuationNr.equals("")) {<a name="line.987"></a>
<span class="sourceLineNo">988</span>                                if (DEBUG) {<a name="line.988"></a>
<span class="sourceLineNo">989</span>                                        System.out.println("looks like an old PDB file");<a name="line.989"></a>
<span class="sourceLineNo">990</span>                                }<a name="line.990"></a>
<span class="sourceLineNo">991</span>                                continuationField = "MOLECULE:";<a name="line.991"></a>
<span class="sourceLineNo">992</span>                                if (previousContinuationField.equals("")) {<a name="line.992"></a>
<span class="sourceLineNo">993</span>                                        previousContinuationField = continuationField;<a name="line.993"></a>
<span class="sourceLineNo">994</span>                                }<a name="line.994"></a>
<span class="sourceLineNo">995</span>                        }<a name="line.995"></a>
<span class="sourceLineNo">996</span><a name="line.996"></a>
<span class="sourceLineNo">997</span>                }<a name="line.997"></a>
<span class="sourceLineNo">998</span><a name="line.998"></a>
<span class="sourceLineNo">999</span>                line = line.replace(continuationField, "").trim();<a name="line.999"></a>
<span class="sourceLineNo">1000</span><a name="line.1000"></a>
<span class="sourceLineNo">1001</span>                StringTokenizer compndTokens = new StringTokenizer(line);<a name="line.1001"></a>
<span class="sourceLineNo">1002</span><a name="line.1002"></a>
<span class="sourceLineNo">1003</span>                //              System.out.println("PDBFileParser.pdb_COMPND_Handler: Tokenizing '" + line + "'");<a name="line.1003"></a>
<span class="sourceLineNo">1004</span><a name="line.1004"></a>
<span class="sourceLineNo">1005</span>                while (compndTokens.hasMoreTokens()) {<a name="line.1005"></a>
<span class="sourceLineNo">1006</span>                        String token = compndTokens.nextToken();<a name="line.1006"></a>
<span class="sourceLineNo">1007</span><a name="line.1007"></a>
<span class="sourceLineNo">1008</span>                        if (previousContinuationField.equals("")) {<a name="line.1008"></a>
<span class="sourceLineNo">1009</span>                                previousContinuationField = continuationField;<a name="line.1009"></a>
<span class="sourceLineNo">1010</span>                        }<a name="line.1010"></a>
<span class="sourceLineNo">1011</span><a name="line.1011"></a>
<span class="sourceLineNo">1012</span>                        if (previousContinuationField.equals(continuationField)<a name="line.1012"></a>
<span class="sourceLineNo">1013</span>                                        &amp;&amp; compndFieldValues.contains(continuationField)) {<a name="line.1013"></a>
<span class="sourceLineNo">1014</span>                                if (DEBUG) {<a name="line.1014"></a>
<span class="sourceLineNo">1015</span>                                        System.out.println("Still in field " + continuationField);<a name="line.1015"></a>
<span class="sourceLineNo">1016</span>                                        System.out.println("token = " + token);<a name="line.1016"></a>
<span class="sourceLineNo">1017</span>                                }<a name="line.1017"></a>
<span class="sourceLineNo">1018</span>                                continuationString = continuationString.concat(token + " ");<a name="line.1018"></a>
<span class="sourceLineNo">1019</span>                                if (DEBUG) {<a name="line.1019"></a>
<span class="sourceLineNo">1020</span>                                        System.out.println("continuationString = "<a name="line.1020"></a>
<span class="sourceLineNo">1021</span>                                                        + continuationString);<a name="line.1021"></a>
<span class="sourceLineNo">1022</span>                                }<a name="line.1022"></a>
<span class="sourceLineNo">1023</span>                        }<a name="line.1023"></a>
<span class="sourceLineNo">1024</span>                        if (!continuationField.equals(previousContinuationField)) {<a name="line.1024"></a>
<span class="sourceLineNo">1025</span><a name="line.1025"></a>
<span class="sourceLineNo">1026</span>                                if (continuationString.equals("")) {<a name="line.1026"></a>
<span class="sourceLineNo">1027</span>                                        continuationString = token;<a name="line.1027"></a>
<span class="sourceLineNo">1028</span><a name="line.1028"></a>
<span class="sourceLineNo">1029</span>                                } else {<a name="line.1029"></a>
<span class="sourceLineNo">1030</span><a name="line.1030"></a>
<span class="sourceLineNo">1031</span>                                        compndValueSetter(previousContinuationField,<a name="line.1031"></a>
<span class="sourceLineNo">1032</span>                                                        continuationString);<a name="line.1032"></a>
<span class="sourceLineNo">1033</span>                                        previousContinuationField = continuationField;<a name="line.1033"></a>
<span class="sourceLineNo">1034</span>                                        continuationString = token + " ";<a name="line.1034"></a>
<span class="sourceLineNo">1035</span>                                }<a name="line.1035"></a>
<span class="sourceLineNo">1036</span>                        } else if (ignoreCompndFieldValues.contains(token)) {<a name="line.1036"></a>
<span class="sourceLineNo">1037</span>                                // this field shall be ignored<a name="line.1037"></a>
<span class="sourceLineNo">1038</span>                                //continuationField = token;<a name="line.1038"></a>
<span class="sourceLineNo">1039</span>                        }<a name="line.1039"></a>
<span class="sourceLineNo">1040</span>                }<a name="line.1040"></a>
<span class="sourceLineNo">1041</span>                if (isLastCompndLine) {<a name="line.1041"></a>
<span class="sourceLineNo">1042</span>                        // final line in the section - finish off the compound<a name="line.1042"></a>
<span class="sourceLineNo">1043</span>                        //                      System.out.println("[pdb_COMPND_Handler] Final COMPND line - Finishing off final MolID header.");<a name="line.1043"></a>
<span class="sourceLineNo">1044</span>                        compndValueSetter(continuationField, continuationString);<a name="line.1044"></a>
<span class="sourceLineNo">1045</span>                        continuationString = "";<a name="line.1045"></a>
<span class="sourceLineNo">1046</span>                        compounds.add(current_compound);<a name="line.1046"></a>
<span class="sourceLineNo">1047</span>                }<a name="line.1047"></a>
<span class="sourceLineNo">1048</span>        }<a name="line.1048"></a>
<span class="sourceLineNo">1049</span><a name="line.1049"></a>
<span class="sourceLineNo">1050</span>        /** set the value in the currrent molId object<a name="line.1050"></a>
<span class="sourceLineNo">1051</span>         *<a name="line.1051"></a>
<span class="sourceLineNo">1052</span>         * @param field<a name="line.1052"></a>
<span class="sourceLineNo">1053</span>         * @param value<a name="line.1053"></a>
<span class="sourceLineNo">1054</span>         */<a name="line.1054"></a>
<span class="sourceLineNo">1055</span>        private void compndValueSetter(String field, String value) {<a name="line.1055"></a>
<span class="sourceLineNo">1056</span><a name="line.1056"></a>
<span class="sourceLineNo">1057</span>                value = value.trim().replace(";", "");<a name="line.1057"></a>
<span class="sourceLineNo">1058</span>                if (field.equals("MOL_ID:")) {<a name="line.1058"></a>
<span class="sourceLineNo">1059</span><a name="line.1059"></a>
<span class="sourceLineNo">1060</span>                        //todo: find out why an extra mol or chain gets added  and why 1H1J, 1J1H ATOM records are missing, but not 1H1H....<a name="line.1060"></a>
<span class="sourceLineNo">1061</span>                        if (DEBUG)<a name="line.1061"></a>
<span class="sourceLineNo">1062</span>                                System.out.println("molTypeCounter " + molTypeCounter + " "<a name="line.1062"></a>
<span class="sourceLineNo">1063</span>                                                + value);<a name="line.1063"></a>
<span class="sourceLineNo">1064</span>                        int i = -1;<a name="line.1064"></a>
<span class="sourceLineNo">1065</span>                        try {<a name="line.1065"></a>
<span class="sourceLineNo">1066</span>                                i = Integer.valueOf(value);<a name="line.1066"></a>
<span class="sourceLineNo">1067</span>                        } catch (NumberFormatException e){<a name="line.1067"></a>
<span class="sourceLineNo">1068</span>                                logger.fine(e.getMessage() + " while trying to parse COMPND line.");<a name="line.1068"></a>
<span class="sourceLineNo">1069</span>                        }<a name="line.1069"></a>
<span class="sourceLineNo">1070</span>                        if (molTypeCounter != i) {<a name="line.1070"></a>
<span class="sourceLineNo">1071</span>                                molTypeCounter++;<a name="line.1071"></a>
<span class="sourceLineNo">1072</span><a name="line.1072"></a>
<span class="sourceLineNo">1073</span>                                compounds.add(current_compound);<a name="line.1073"></a>
<span class="sourceLineNo">1074</span>                                current_compound = null;<a name="line.1074"></a>
<span class="sourceLineNo">1075</span>                                current_compound = new Compound();<a name="line.1075"></a>
<span class="sourceLineNo">1076</span><a name="line.1076"></a>
<span class="sourceLineNo">1077</span>                        }<a name="line.1077"></a>
<span class="sourceLineNo">1078</span><a name="line.1078"></a>
<span class="sourceLineNo">1079</span>                        current_compound.setMolId(value);<a name="line.1079"></a>
<span class="sourceLineNo">1080</span>                }<a name="line.1080"></a>
<span class="sourceLineNo">1081</span>                if (field.equals("MOLECULE:")) {<a name="line.1081"></a>
<span class="sourceLineNo">1082</span>                        current_compound.setMolName(value);<a name="line.1082"></a>
<span class="sourceLineNo">1083</span><a name="line.1083"></a>
<span class="sourceLineNo">1084</span>                }<a name="line.1084"></a>
<span class="sourceLineNo">1085</span>                if (field.equals("CHAIN:")) {<a name="line.1085"></a>
<span class="sourceLineNo">1086</span>                        //System.out.println(value);<a name="line.1086"></a>
<span class="sourceLineNo">1087</span>                        StringTokenizer chainTokens = new StringTokenizer(value, ",");<a name="line.1087"></a>
<span class="sourceLineNo">1088</span>                        List&lt;String&gt; chains = new ArrayList&lt;String&gt;();<a name="line.1088"></a>
<span class="sourceLineNo">1089</span><a name="line.1089"></a>
<span class="sourceLineNo">1090</span>                        while (chainTokens.hasMoreTokens()) {<a name="line.1090"></a>
<span class="sourceLineNo">1091</span>                                String chainID = chainTokens.nextToken().trim();<a name="line.1091"></a>
<span class="sourceLineNo">1092</span>                                // NULL is used in old PDB files to represent empty chain DI<a name="line.1092"></a>
<span class="sourceLineNo">1093</span>                                if (chainID.equals("NULL"))<a name="line.1093"></a>
<span class="sourceLineNo">1094</span>                                        chainID = " ";<a name="line.1094"></a>
<span class="sourceLineNo">1095</span>                                chains.add(chainID);<a name="line.1095"></a>
<span class="sourceLineNo">1096</span>                        }<a name="line.1096"></a>
<span class="sourceLineNo">1097</span>                        current_compound.setChainId(chains);<a name="line.1097"></a>
<span class="sourceLineNo">1098</span><a name="line.1098"></a>
<span class="sourceLineNo">1099</span>                }<a name="line.1099"></a>
<span class="sourceLineNo">1100</span>                if (field.equals("SYNONYM:")) {<a name="line.1100"></a>
<span class="sourceLineNo">1101</span><a name="line.1101"></a>
<span class="sourceLineNo">1102</span>                        StringTokenizer synonyms = new StringTokenizer(value, ",");<a name="line.1102"></a>
<span class="sourceLineNo">1103</span>                        List&lt;String&gt; names = new ArrayList&lt;String&gt;();<a name="line.1103"></a>
<span class="sourceLineNo">1104</span><a name="line.1104"></a>
<span class="sourceLineNo">1105</span>                        while (synonyms.hasMoreTokens()) {<a name="line.1105"></a>
<span class="sourceLineNo">1106</span>                                names.add(synonyms.nextToken());<a name="line.1106"></a>
<span class="sourceLineNo">1107</span><a name="line.1107"></a>
<span class="sourceLineNo">1108</span>                                current_compound.setSynonyms(names);<a name="line.1108"></a>
<span class="sourceLineNo">1109</span>                        }<a name="line.1109"></a>
<span class="sourceLineNo">1110</span><a name="line.1110"></a>
<span class="sourceLineNo">1111</span>                }<a name="line.1111"></a>
<span class="sourceLineNo">1112</span><a name="line.1112"></a>
<span class="sourceLineNo">1113</span>                if (field.equals("EC:")) {<a name="line.1113"></a>
<span class="sourceLineNo">1114</span><a name="line.1114"></a>
<span class="sourceLineNo">1115</span>                        StringTokenizer ecNumTokens = new StringTokenizer(value, ",");<a name="line.1115"></a>
<span class="sourceLineNo">1116</span>                        List&lt;String&gt; ecNums = new ArrayList&lt;String&gt;();<a name="line.1116"></a>
<span class="sourceLineNo">1117</span><a name="line.1117"></a>
<span class="sourceLineNo">1118</span>                        while (ecNumTokens.hasMoreTokens()) {<a name="line.1118"></a>
<span class="sourceLineNo">1119</span>                                ecNums.add(ecNumTokens.nextToken());<a name="line.1119"></a>
<span class="sourceLineNo">1120</span><a name="line.1120"></a>
<span class="sourceLineNo">1121</span>                                current_compound.setEcNums(ecNums);<a name="line.1121"></a>
<span class="sourceLineNo">1122</span>                        }<a name="line.1122"></a>
<span class="sourceLineNo">1123</span><a name="line.1123"></a>
<span class="sourceLineNo">1124</span>                }<a name="line.1124"></a>
<span class="sourceLineNo">1125</span>                if (field.equals("FRAGMENT:")) {<a name="line.1125"></a>
<span class="sourceLineNo">1126</span><a name="line.1126"></a>
<span class="sourceLineNo">1127</span>                        current_compound.setFragment(value);<a name="line.1127"></a>
<span class="sourceLineNo">1128</span><a name="line.1128"></a>
<span class="sourceLineNo">1129</span>                }<a name="line.1129"></a>
<span class="sourceLineNo">1130</span>                if (field.equals("ENGINEERED:")) {<a name="line.1130"></a>
<span class="sourceLineNo">1131</span><a name="line.1131"></a>
<span class="sourceLineNo">1132</span>                        current_compound.setEngineered(value);<a name="line.1132"></a>
<span class="sourceLineNo">1133</span><a name="line.1133"></a>
<span class="sourceLineNo">1134</span>                }<a name="line.1134"></a>
<span class="sourceLineNo">1135</span>                if (field.equals("MUTATION:")) {<a name="line.1135"></a>
<span class="sourceLineNo">1136</span><a name="line.1136"></a>
<span class="sourceLineNo">1137</span>                        current_compound.setMutation(value);<a name="line.1137"></a>
<span class="sourceLineNo">1138</span><a name="line.1138"></a>
<span class="sourceLineNo">1139</span>                }<a name="line.1139"></a>
<span class="sourceLineNo">1140</span>                if (field.equals("BIOLOGICAL_UNIT:")) {<a name="line.1140"></a>
<span class="sourceLineNo">1141</span><a name="line.1141"></a>
<span class="sourceLineNo">1142</span>                        current_compound.setBiologicalUnit(value);<a name="line.1142"></a>
<span class="sourceLineNo">1143</span><a name="line.1143"></a>
<span class="sourceLineNo">1144</span>                }<a name="line.1144"></a>
<span class="sourceLineNo">1145</span>                if (field.equals("OTHER_DETAILS:")) {<a name="line.1145"></a>
<span class="sourceLineNo">1146</span><a name="line.1146"></a>
<span class="sourceLineNo">1147</span>                        current_compound.setDetails(value);<a name="line.1147"></a>
<span class="sourceLineNo">1148</span><a name="line.1148"></a>
<span class="sourceLineNo">1149</span>                }<a name="line.1149"></a>
<span class="sourceLineNo">1150</span><a name="line.1150"></a>
<span class="sourceLineNo">1151</span>        }<a name="line.1151"></a>
<span class="sourceLineNo">1152</span><a name="line.1152"></a>
<span class="sourceLineNo">1153</span><a name="line.1153"></a>
<span class="sourceLineNo">1154</span>        /** Handler for<a name="line.1154"></a>
<span class="sourceLineNo">1155</span>         * SOURCE Record format<a name="line.1155"></a>
<span class="sourceLineNo">1156</span>         *<a name="line.1156"></a>
<span class="sourceLineNo">1157</span>         * The SOURCE record specifies the biological and/or chemical source of each biological molecule in the entry. Sources are described by both the common name and the scientific name, e.g., genus and species. Strain and/or cell-line for immortalized cells are given when they help to uniquely identify the biological entity studied.<a name="line.1157"></a>
<span class="sourceLineNo">1158</span>Record Format<a name="line.1158"></a>
<span class="sourceLineNo">1159</span><a name="line.1159"></a>
<span class="sourceLineNo">1160</span>COLUMNS   DATA TYPE         FIELD          DEFINITION<a name="line.1160"></a>
<span class="sourceLineNo">1161</span>-------------------------------------------------------------------------------<a name="line.1161"></a>
<span class="sourceLineNo">1162</span> 1 -  6   Record name       "SOURCE"<a name="line.1162"></a>
<span class="sourceLineNo">1163</span> 9 - 10   Continuation      continuation   Allows concatenation of multiple records.<a name="line.1163"></a>
<span class="sourceLineNo">1164</span>11 - 70   Specification     srcName        Identifies the source of the macromolecule in<a name="line.1164"></a>
<span class="sourceLineNo">1165</span>           list                            a token: value format.<a name="line.1165"></a>
<span class="sourceLineNo">1166</span>         * @param line the line to be parsed<a name="line.1166"></a>
<span class="sourceLineNo">1167</span><a name="line.1167"></a>
<span class="sourceLineNo">1168</span>         */<a name="line.1168"></a>
<span class="sourceLineNo">1169</span>        private void pdb_SOURCE_Handler(String line) {<a name="line.1169"></a>
<span class="sourceLineNo">1170</span>                // works in the same way as the pdb_COMPND_Handler.<a name="line.1170"></a>
<span class="sourceLineNo">1171</span>                boolean sourceDebug = false;<a name="line.1171"></a>
<span class="sourceLineNo">1172</span><a name="line.1172"></a>
<span class="sourceLineNo">1173</span>                String continuationNr = line.substring(9, 10).trim();<a name="line.1173"></a>
<span class="sourceLineNo">1174</span><a name="line.1174"></a>
<span class="sourceLineNo">1175</span>                if (sourceDebug) {<a name="line.1175"></a>
<span class="sourceLineNo">1176</span>                        System.out.println("current continuationNo     is "<a name="line.1176"></a>
<span class="sourceLineNo">1177</span>                                        + continuationNr);<a name="line.1177"></a>
<span class="sourceLineNo">1178</span>                        System.out.println("previousContinuationField  is "<a name="line.1178"></a>
<span class="sourceLineNo">1179</span>                                        + previousContinuationField);<a name="line.1179"></a>
<span class="sourceLineNo">1180</span>                        System.out.println("current continuationField  is "<a name="line.1180"></a>
<span class="sourceLineNo">1181</span>                                        + continuationField);<a name="line.1181"></a>
<span class="sourceLineNo">1182</span>                        System.out.println("current continuationString is "<a name="line.1182"></a>
<span class="sourceLineNo">1183</span>                                        + continuationString);<a name="line.1183"></a>
<span class="sourceLineNo">1184</span>                        System.out.println("current compound           is "<a name="line.1184"></a>
<span class="sourceLineNo">1185</span>                                        + current_compound);<a name="line.1185"></a>
<span class="sourceLineNo">1186</span>                }<a name="line.1186"></a>
<span class="sourceLineNo">1187</span><a name="line.1187"></a>
<span class="sourceLineNo">1188</span>                // in some PDB files the line ends with the PDB code and a serial number, chop those off!<a name="line.1188"></a>
<span class="sourceLineNo">1189</span>                if (line.length() &gt; 72) {<a name="line.1189"></a>
<span class="sourceLineNo">1190</span>                        line = line.substring(0, 72);<a name="line.1190"></a>
<span class="sourceLineNo">1191</span>                }<a name="line.1191"></a>
<span class="sourceLineNo">1192</span><a name="line.1192"></a>
<span class="sourceLineNo">1193</span>                line = line.substring(10, line.length());<a name="line.1193"></a>
<span class="sourceLineNo">1194</span><a name="line.1194"></a>
<span class="sourceLineNo">1195</span>                if (sourceDebug) {<a name="line.1195"></a>
<span class="sourceLineNo">1196</span>                        System.out.println("LINE: &gt;" + line + "&lt;");<a name="line.1196"></a>
<span class="sourceLineNo">1197</span>                }<a name="line.1197"></a>
<span class="sourceLineNo">1198</span>                String[] fieldList = line.split("\\s+");<a name="line.1198"></a>
<span class="sourceLineNo">1199</span><a name="line.1199"></a>
<span class="sourceLineNo">1200</span>                if (!fieldList[0].equals("")<a name="line.1200"></a>
<span class="sourceLineNo">1201</span>                                &amp;&amp; sourceFieldValues.contains(fieldList[0])) {<a name="line.1201"></a>
<span class="sourceLineNo">1202</span>                        //                      System.out.println("[PDBFileParser.pdb_COMPND_Handler] Setting continuationField to '" + fieldList[0] + "'");<a name="line.1202"></a>
<span class="sourceLineNo">1203</span>                        continuationField = fieldList[0];<a name="line.1203"></a>
<span class="sourceLineNo">1204</span>                        if (previousContinuationField.equals("")) {<a name="line.1204"></a>
<span class="sourceLineNo">1205</span>                                previousContinuationField = continuationField;<a name="line.1205"></a>
<span class="sourceLineNo">1206</span>                        }<a name="line.1206"></a>
<span class="sourceLineNo">1207</span><a name="line.1207"></a>
<span class="sourceLineNo">1208</span>                } else if ((fieldList.length &gt; 1) &amp;&amp; ( sourceFieldValues.contains(fieldList[1]))) {<a name="line.1208"></a>
<span class="sourceLineNo">1209</span>                        //                      System.out.println("[PDBFileParser.pdb_COMPND_Handler] Setting continuationField to '" + fieldList[1] + "'");<a name="line.1209"></a>
<span class="sourceLineNo">1210</span>                        continuationField = fieldList[1];<a name="line.1210"></a>
<span class="sourceLineNo">1211</span>                        if (previousContinuationField.equals("")) {<a name="line.1211"></a>
<span class="sourceLineNo">1212</span>                                previousContinuationField = continuationField;<a name="line.1212"></a>
<span class="sourceLineNo">1213</span>                        }<a name="line.1213"></a>
<span class="sourceLineNo">1214</span><a name="line.1214"></a>
<span class="sourceLineNo">1215</span>                } else {<a name="line.1215"></a>
<span class="sourceLineNo">1216</span>                        if (continuationNr.equals("")) {<a name="line.1216"></a>
<span class="sourceLineNo">1217</span>                                if (sourceDebug) {<a name="line.1217"></a>
<span class="sourceLineNo">1218</span>                                        System.out.println("looks like an old PDB file");<a name="line.1218"></a>
<span class="sourceLineNo">1219</span>                                }<a name="line.1219"></a>
<span class="sourceLineNo">1220</span>                                continuationField = "MOLECULE:";<a name="line.1220"></a>
<span class="sourceLineNo">1221</span>                                if (previousContinuationField.equals("")) {<a name="line.1221"></a>
<span class="sourceLineNo">1222</span>                                        previousContinuationField = continuationField;<a name="line.1222"></a>
<span class="sourceLineNo">1223</span>                                }<a name="line.1223"></a>
<span class="sourceLineNo">1224</span>                        }<a name="line.1224"></a>
<span class="sourceLineNo">1225</span><a name="line.1225"></a>
<span class="sourceLineNo">1226</span>                }<a name="line.1226"></a>
<span class="sourceLineNo">1227</span><a name="line.1227"></a>
<span class="sourceLineNo">1228</span>                line = line.replace(continuationField, "").trim();<a name="line.1228"></a>
<span class="sourceLineNo">1229</span><a name="line.1229"></a>
<span class="sourceLineNo">1230</span>                StringTokenizer compndTokens = new StringTokenizer(line);<a name="line.1230"></a>
<span class="sourceLineNo">1231</span><a name="line.1231"></a>
<span class="sourceLineNo">1232</span>                //              System.out.println("PDBFileParser.pdb_COMPND_Handler: Tokenizing '" + line + "'");<a name="line.1232"></a>
<span class="sourceLineNo">1233</span><a name="line.1233"></a>
<span class="sourceLineNo">1234</span>                while (compndTokens.hasMoreTokens()) {<a name="line.1234"></a>
<span class="sourceLineNo">1235</span>                        String token = compndTokens.nextToken();<a name="line.1235"></a>
<span class="sourceLineNo">1236</span><a name="line.1236"></a>
<span class="sourceLineNo">1237</span>                        if (previousContinuationField.equals("")) {<a name="line.1237"></a>
<span class="sourceLineNo">1238</span>                                //                              System.out.println("previousContinuationField is empty. Setting to : " + continuationField);<a name="line.1238"></a>
<span class="sourceLineNo">1239</span>                                previousContinuationField = continuationField;<a name="line.1239"></a>
<span class="sourceLineNo">1240</span>                        }<a name="line.1240"></a>
<span class="sourceLineNo">1241</span><a name="line.1241"></a>
<span class="sourceLineNo">1242</span>                        if (previousContinuationField.equals(continuationField)<a name="line.1242"></a>
<span class="sourceLineNo">1243</span>                                        &amp;&amp; sourceFieldValues.contains(continuationField)) {<a name="line.1243"></a>
<span class="sourceLineNo">1244</span>                                if (sourceDebug)<a name="line.1244"></a>
<span class="sourceLineNo">1245</span>                                        System.out.println("Still in field " + continuationField);<a name="line.1245"></a>
<span class="sourceLineNo">1246</span><a name="line.1246"></a>
<span class="sourceLineNo">1247</span>                                continuationString = continuationString.concat(token + " ");<a name="line.1247"></a>
<span class="sourceLineNo">1248</span>                                if (sourceDebug)<a name="line.1248"></a>
<span class="sourceLineNo">1249</span>                                        System.out.println("continuationString = "<a name="line.1249"></a>
<span class="sourceLineNo">1250</span>                                                        + continuationString);<a name="line.1250"></a>
<span class="sourceLineNo">1251</span>                        }<a name="line.1251"></a>
<span class="sourceLineNo">1252</span>                        if (!continuationField.equals(previousContinuationField)) {<a name="line.1252"></a>
<span class="sourceLineNo">1253</span><a name="line.1253"></a>
<span class="sourceLineNo">1254</span>                                if (continuationString.equals("")) {<a name="line.1254"></a>
<span class="sourceLineNo">1255</span>                                        continuationString = token;<a name="line.1255"></a>
<span class="sourceLineNo">1256</span><a name="line.1256"></a>
<span class="sourceLineNo">1257</span>                                } else {<a name="line.1257"></a>
<span class="sourceLineNo">1258</span><a name="line.1258"></a>
<span class="sourceLineNo">1259</span>                                        sourceValueSetter(previousContinuationField,<a name="line.1259"></a>
<span class="sourceLineNo">1260</span>                                                        continuationString);<a name="line.1260"></a>
<span class="sourceLineNo">1261</span>                                        previousContinuationField = continuationField;<a name="line.1261"></a>
<span class="sourceLineNo">1262</span>                                        continuationString = token + " ";<a name="line.1262"></a>
<span class="sourceLineNo">1263</span>                                }<a name="line.1263"></a>
<span class="sourceLineNo">1264</span>                        } else if (ignoreCompndFieldValues.contains(token)) {<a name="line.1264"></a>
<span class="sourceLineNo">1265</span>                                // this field shall be ignored<a name="line.1265"></a>
<span class="sourceLineNo">1266</span>                                //continuationField = token;<a name="line.1266"></a>
<span class="sourceLineNo">1267</span>                        }<a name="line.1267"></a>
<span class="sourceLineNo">1268</span>                }<a name="line.1268"></a>
<span class="sourceLineNo">1269</span>                if (isLastSourceLine) {<a name="line.1269"></a>
<span class="sourceLineNo">1270</span>                        // final line in the section - finish off the compound<a name="line.1270"></a>
<span class="sourceLineNo">1271</span>                        //                      System.out.println("[pdb_SOURCE_Handler] Final SOURCE line - Finishing off final MolID header.");<a name="line.1271"></a>
<span class="sourceLineNo">1272</span>                        sourceValueSetter(continuationField, continuationString);<a name="line.1272"></a>
<span class="sourceLineNo">1273</span>                        continuationString = "";<a name="line.1273"></a>
<span class="sourceLineNo">1274</span>                        //compounds.add(current_compound);<a name="line.1274"></a>
<span class="sourceLineNo">1275</span>                }<a name="line.1275"></a>
<span class="sourceLineNo">1276</span><a name="line.1276"></a>
<span class="sourceLineNo">1277</span>        }<a name="line.1277"></a>
<span class="sourceLineNo">1278</span><a name="line.1278"></a>
<span class="sourceLineNo">1279</span><a name="line.1279"></a>
<span class="sourceLineNo">1280</span>        /** set the value in the currrent molId object<a name="line.1280"></a>
<span class="sourceLineNo">1281</span>         *<a name="line.1281"></a>
<span class="sourceLineNo">1282</span>         * @param field<a name="line.1282"></a>
<span class="sourceLineNo">1283</span>         * @param value<a name="line.1283"></a>
<span class="sourceLineNo">1284</span>         */<a name="line.1284"></a>
<span class="sourceLineNo">1285</span>        private void sourceValueSetter(String field, String value) {<a name="line.1285"></a>
<span class="sourceLineNo">1286</span><a name="line.1286"></a>
<span class="sourceLineNo">1287</span>                value = value.trim().replace(";", "");<a name="line.1287"></a>
<span class="sourceLineNo">1288</span>                //              System.out.println("[sourceValueSetter] " + field);<a name="line.1288"></a>
<span class="sourceLineNo">1289</span>                if (field.equals("MOL_ID:")) {<a name="line.1289"></a>
<span class="sourceLineNo">1290</span><a name="line.1290"></a>
<span class="sourceLineNo">1291</span>                        try {<a name="line.1291"></a>
<span class="sourceLineNo">1292</span>                                current_compound = compounds.get(Integer.valueOf(value) - 1);<a name="line.1292"></a>
<span class="sourceLineNo">1293</span>                        } catch (Exception e){<a name="line.1293"></a>
<span class="sourceLineNo">1294</span>                                logger.fine("could not process SOURCE MOL_ID record correctly:" + e.getMessage());<a name="line.1294"></a>
<span class="sourceLineNo">1295</span>                                return;<a name="line.1295"></a>
<span class="sourceLineNo">1296</span>                        }<a name="line.1296"></a>
<span class="sourceLineNo">1297</span><a name="line.1297"></a>
<span class="sourceLineNo">1298</span><a name="line.1298"></a>
<span class="sourceLineNo">1299</span>                        //                      System.out.println("[sourceValueSetter] Fetching compound " + value + " " + current_compound.getMolId());<a name="line.1299"></a>
<span class="sourceLineNo">1300</span><a name="line.1300"></a>
<span class="sourceLineNo">1301</span>                }<a name="line.1301"></a>
<span class="sourceLineNo">1302</span>                if (field.equals("SYNTHETIC:")) {<a name="line.1302"></a>
<span class="sourceLineNo">1303</span>                        current_compound.setSynthetic(value);<a name="line.1303"></a>
<span class="sourceLineNo">1304</span>                } else if (field.equals("FRAGMENT:")) {<a name="line.1304"></a>
<span class="sourceLineNo">1305</span>                        current_compound.setFragment(value);<a name="line.1305"></a>
<span class="sourceLineNo">1306</span>                } else if (field.equals("ORGANISM_SCIENTIFIC:")) {<a name="line.1306"></a>
<span class="sourceLineNo">1307</span>                        current_compound.setOrganismScientific(value);<a name="line.1307"></a>
<span class="sourceLineNo">1308</span>                } else if (field.equals("ORGANISM_TAXID:")) {<a name="line.1308"></a>
<span class="sourceLineNo">1309</span>                        current_compound.setOrganismTaxId(value);<a name="line.1309"></a>
<span class="sourceLineNo">1310</span>                } else if (field.equals("ORGANISM_COMMON:")) {<a name="line.1310"></a>
<span class="sourceLineNo">1311</span>                        current_compound.setOrganismCommon(value);<a name="line.1311"></a>
<span class="sourceLineNo">1312</span>                } else if (field.equals("STRAIN:")) {<a name="line.1312"></a>
<span class="sourceLineNo">1313</span>                        current_compound.setStrain(value);<a name="line.1313"></a>
<span class="sourceLineNo">1314</span>                } else if (field.equals("VARIANT:")) {<a name="line.1314"></a>
<span class="sourceLineNo">1315</span>                        current_compound.setVariant(value);<a name="line.1315"></a>
<span class="sourceLineNo">1316</span>                } else if (field.equals("CELL_LINE:")) {<a name="line.1316"></a>
<span class="sourceLineNo">1317</span>                        current_compound.setCellLine(value);<a name="line.1317"></a>
<span class="sourceLineNo">1318</span>                } else if (field.equals("ATCC:")) {<a name="line.1318"></a>
<span class="sourceLineNo">1319</span>                        current_compound.setAtcc(value);<a name="line.1319"></a>
<span class="sourceLineNo">1320</span>                } else if (field.equals("ORGAN:")) {<a name="line.1320"></a>
<span class="sourceLineNo">1321</span>                        current_compound.setOrgan(value);<a name="line.1321"></a>
<span class="sourceLineNo">1322</span>                } else if (field.equals("TISSUE:")) {<a name="line.1322"></a>
<span class="sourceLineNo">1323</span>                        current_compound.setTissue(value);<a name="line.1323"></a>
<span class="sourceLineNo">1324</span>                } else if (field.equals("CELL:")) {<a name="line.1324"></a>
<span class="sourceLineNo">1325</span>                        current_compound.setCell(value);<a name="line.1325"></a>
<span class="sourceLineNo">1326</span>                } else if (field.equals("ORGANELLE:")) {<a name="line.1326"></a>
<span class="sourceLineNo">1327</span>                        current_compound.setOrganelle(value);<a name="line.1327"></a>
<span class="sourceLineNo">1328</span>                } else if (field.equals("SECRETION:")) {<a name="line.1328"></a>
<span class="sourceLineNo">1329</span>                        current_compound.setSecretion(value);<a name="line.1329"></a>
<span class="sourceLineNo">1330</span>                } else if (field.equals("GENE:")) {<a name="line.1330"></a>
<span class="sourceLineNo">1331</span>                        current_compound.setGene(value);<a name="line.1331"></a>
<span class="sourceLineNo">1332</span>                } else if (field.equals("CELLULAR_LOCATION:")) {<a name="line.1332"></a>
<span class="sourceLineNo">1333</span>                        current_compound.setCellularLocation(value);<a name="line.1333"></a>
<span class="sourceLineNo">1334</span>                } else if (field.equals("EXPRESSION_SYSTEM:")) {<a name="line.1334"></a>
<span class="sourceLineNo">1335</span>                        current_compound.setExpressionSystem(value);<a name="line.1335"></a>
<span class="sourceLineNo">1336</span>                } else if (field.equals("EXPRESSION_SYSTEM_TAXID:")) {<a name="line.1336"></a>
<span class="sourceLineNo">1337</span>                        current_compound.setExpressionSystemTaxId(value);<a name="line.1337"></a>
<span class="sourceLineNo">1338</span>                } else if (field.equals("EXPRESSION_SYSTEM_STRAIN:")) {<a name="line.1338"></a>
<span class="sourceLineNo">1339</span>                        current_compound.setExpressionSystemStrain(value);<a name="line.1339"></a>
<span class="sourceLineNo">1340</span>                } else if (field.equals("EXPRESSION_SYSTEM_VARIANT:")) {<a name="line.1340"></a>
<span class="sourceLineNo">1341</span>                        current_compound.setExpressionSystemVariant(value);<a name="line.1341"></a>
<span class="sourceLineNo">1342</span>                } else if (field.equals("EXPRESSION_SYSTEM_CELL_LINE:")) {<a name="line.1342"></a>
<span class="sourceLineNo">1343</span>                        current_compound.setExpressionSystemCellLine(value);<a name="line.1343"></a>
<span class="sourceLineNo">1344</span>                } else if (field.equals("EXPRESSION_SYSTEM_ATCC_NUMBER:")) {<a name="line.1344"></a>
<span class="sourceLineNo">1345</span>                        current_compound.setExpressionSystemAtccNumber(value);<a name="line.1345"></a>
<span class="sourceLineNo">1346</span>                } else if (field.equals("EXPRESSION_SYSTEM_ORGAN:")) {<a name="line.1346"></a>
<span class="sourceLineNo">1347</span>                        current_compound.setExpressionSystemOrgan(value);<a name="line.1347"></a>
<span class="sourceLineNo">1348</span>                } else if (field.equals("EXPRESSION_SYSTEM_TISSUE:")) {<a name="line.1348"></a>
<span class="sourceLineNo">1349</span>                        current_compound.setExpressionSystemTissue(value);<a name="line.1349"></a>
<span class="sourceLineNo">1350</span>                } else if (field.equals("EXPRESSION_SYSTEM_CELL:")) {<a name="line.1350"></a>
<span class="sourceLineNo">1351</span>                        current_compound.setExpressionSystemCell(value);<a name="line.1351"></a>
<span class="sourceLineNo">1352</span>                } else if (field.equals("EXPRESSION_SYSTEM_ORGANELLE:")) {<a name="line.1352"></a>
<span class="sourceLineNo">1353</span>                        current_compound.setExpressionSystemOrganelle(value);<a name="line.1353"></a>
<span class="sourceLineNo">1354</span>                } else if (field.equals("EXPRESSION_SYSTEM_CELLULAR_LOCATION:")) {<a name="line.1354"></a>
<span class="sourceLineNo">1355</span>                        current_compound.setExpressionSystemCellularLocation(value);<a name="line.1355"></a>
<span class="sourceLineNo">1356</span>                } else if (field.equals("EXPRESSION_SYSTEM_VECTOR_TYPE:")) {<a name="line.1356"></a>
<span class="sourceLineNo">1357</span>                        current_compound.setExpressionSystemVectorType(value);<a name="line.1357"></a>
<span class="sourceLineNo">1358</span>                } else if (field.equals("EXPRESSION_SYSTEM_VECTOR:")) {<a name="line.1358"></a>
<span class="sourceLineNo">1359</span>                        current_compound.setExpressionSystemVector(value);<a name="line.1359"></a>
<span class="sourceLineNo">1360</span>                } else if (field.equals("EXPRESSION_SYSTEM_PLASMID:")) {<a name="line.1360"></a>
<span class="sourceLineNo">1361</span>                        current_compound.setExpressionSystemPlasmid(value);<a name="line.1361"></a>
<span class="sourceLineNo">1362</span>                } else if (field.equals("EXPRESSION_SYSTEM_GENE:")) {<a name="line.1362"></a>
<span class="sourceLineNo">1363</span>                        current_compound.setExpressionSystemGene(value);<a name="line.1363"></a>
<span class="sourceLineNo">1364</span>                } else if (field.equals("OTHER_DETAILS:")) {<a name="line.1364"></a>
<span class="sourceLineNo">1365</span>                        current_compound.setExpressionSystemOtherDetails(value);<a name="line.1365"></a>
<span class="sourceLineNo">1366</span>                }<a name="line.1366"></a>
<span class="sourceLineNo">1367</span><a name="line.1367"></a>
<span class="sourceLineNo">1368</span>        }<a name="line.1368"></a>
<span class="sourceLineNo">1369</span><a name="line.1369"></a>
<span class="sourceLineNo">1370</span><a name="line.1370"></a>
<span class="sourceLineNo">1371</span>        /** Handler for<a name="line.1371"></a>
<span class="sourceLineNo">1372</span>         REMARK  2<a name="line.1372"></a>
<span class="sourceLineNo">1373</span><a name="line.1373"></a>
<span class="sourceLineNo">1374</span>         * For diffraction experiments:<a name="line.1374"></a>
<span class="sourceLineNo">1375</span><a name="line.1375"></a>
<span class="sourceLineNo">1376</span>         COLUMNS        DATA TYPE       FIELD               DEFINITION<a name="line.1376"></a>
<span class="sourceLineNo">1377</span>         --------------------------------------------------------------------------------<a name="line.1377"></a>
<span class="sourceLineNo">1378</span>         1 -  6        Record name     "REMARK"<a name="line.1378"></a>
<span class="sourceLineNo">1379</span>         10             LString(1)      "2"<a name="line.1379"></a>
<span class="sourceLineNo">1380</span>         12 - 22        LString(11)     "RESOLUTION."<a name="line.1380"></a>
<span class="sourceLineNo">1381</span>         23 - 27        Real(5.2)       resolution          Resolution.<a name="line.1381"></a>
<span class="sourceLineNo">1382</span>         29 - 38        LString(10)     "ANGSTROMS."<a name="line.1382"></a>
<span class="sourceLineNo">1383</span>         */<a name="line.1383"></a>
<span class="sourceLineNo">1384</span><a name="line.1384"></a>
<span class="sourceLineNo">1385</span>        private void pdb_REMARK_2_Handler(String line) {<a name="line.1385"></a>
<span class="sourceLineNo">1386</span>                //System.out.println(line);<a name="line.1386"></a>
<span class="sourceLineNo">1387</span>                int i = line.indexOf("ANGSTROM");<a name="line.1387"></a>
<span class="sourceLineNo">1388</span>                if ( i != -1) {<a name="line.1388"></a>
<span class="sourceLineNo">1389</span>                        // line contains ANGSTROM info...<a name="line.1389"></a>
<span class="sourceLineNo">1390</span>                        //get the chars between 22 and where Angstrom starts<a name="line.1390"></a>
<span class="sourceLineNo">1391</span>                        // this is for backwards compatibility<a name="line.1391"></a>
<span class="sourceLineNo">1392</span>                        // new PDB files start at 24!!!<a name="line.1392"></a>
<span class="sourceLineNo">1393</span>                        //System.out.println(i);<a name="line.1393"></a>
<span class="sourceLineNo">1394</span><a name="line.1394"></a>
<span class="sourceLineNo">1395</span>                        String resolution = line.substring(22,i).trim();<a name="line.1395"></a>
<span class="sourceLineNo">1396</span>                        //System.out.println(resolution);<a name="line.1396"></a>
<span class="sourceLineNo">1397</span>                        // convert string to float<a name="line.1397"></a>
<span class="sourceLineNo">1398</span>                        float res = PDBHeader.DEFAULT_RESOLUTION ;<a name="line.1398"></a>
<span class="sourceLineNo">1399</span>                        try {<a name="line.1399"></a>
<span class="sourceLineNo">1400</span>                                res = Float.parseFloat(resolution);<a name="line.1400"></a>
<span class="sourceLineNo">1401</span>                        } catch (NumberFormatException e) {<a name="line.1401"></a>
<span class="sourceLineNo">1402</span>                                logger.fine(e.getMessage());<a name="line.1402"></a>
<span class="sourceLineNo">1403</span>                                logger.fine("could not parse resolution from line and ignoring it " + line);<a name="line.1403"></a>
<span class="sourceLineNo">1404</span>                                return ;<a name="line.1404"></a>
<span class="sourceLineNo">1405</span>                        }<a name="line.1405"></a>
<span class="sourceLineNo">1406</span>                        //System.out.println("got resolution:" +res);<a name="line.1406"></a>
<span class="sourceLineNo">1407</span>                        header.put("resolution",new Float(res));<a name="line.1407"></a>
<span class="sourceLineNo">1408</span>                        pdbHeader.setResolution(res);<a name="line.1408"></a>
<span class="sourceLineNo">1409</span>                }<a name="line.1409"></a>
<span class="sourceLineNo">1410</span><a name="line.1410"></a>
<span class="sourceLineNo">1411</span>        }<a name="line.1411"></a>
<span class="sourceLineNo">1412</span><a name="line.1412"></a>
<span class="sourceLineNo">1413</span><a name="line.1413"></a>
<span class="sourceLineNo">1414</span>        /** Handler for REMARK lines<a name="line.1414"></a>
<span class="sourceLineNo">1415</span>         */<a name="line.1415"></a>
<span class="sourceLineNo">1416</span>        private void pdb_REMARK_Handler(String line) {<a name="line.1416"></a>
<span class="sourceLineNo">1417</span>                // finish off the compound handler!<a name="line.1417"></a>
<span class="sourceLineNo">1418</span><a name="line.1418"></a>
<span class="sourceLineNo">1419</span><a name="line.1419"></a>
<span class="sourceLineNo">1420</span><a name="line.1420"></a>
<span class="sourceLineNo">1421</span>                String l = line.substring(0,11).trim();<a name="line.1421"></a>
<span class="sourceLineNo">1422</span>                if (l.equals("REMARK   2"))pdb_REMARK_2_Handler(line);<a name="line.1422"></a>
<span class="sourceLineNo">1423</span><a name="line.1423"></a>
<span class="sourceLineNo">1424</span>                if (line.startsWith("REMARK 800")) {<a name="line.1424"></a>
<span class="sourceLineNo">1425</span>                        pdb_REMARK_800_Handler(line);<a name="line.1425"></a>
<span class="sourceLineNo">1426</span>                }<a name="line.1426"></a>
<span class="sourceLineNo">1427</span><a name="line.1427"></a>
<span class="sourceLineNo">1428</span>        }<a name="line.1428"></a>
<span class="sourceLineNo">1429</span><a name="line.1429"></a>
<span class="sourceLineNo">1430</span><a name="line.1430"></a>
<span class="sourceLineNo">1431</span>        /** Handler for<a name="line.1431"></a>
<span class="sourceLineNo">1432</span>         EXPDTA Record Format<a name="line.1432"></a>
<span class="sourceLineNo">1433</span><a name="line.1433"></a>
<span class="sourceLineNo">1434</span>         COLUMNS       DATA TYPE      FIELD         DEFINITION<a name="line.1434"></a>
<span class="sourceLineNo">1435</span>         -------------------------------------------------------------------------------<a name="line.1435"></a>
<span class="sourceLineNo">1436</span>         1 -  6       Record name    "EXPDTA"<a name="line.1436"></a>
<span class="sourceLineNo">1437</span>         9 - 10       Continuation   continuation  Allows concatenation of multiple<a name="line.1437"></a>
<span class="sourceLineNo">1438</span>         records.<a name="line.1438"></a>
<span class="sourceLineNo">1439</span>         11 - 70       SList          technique     The experimental technique(s) with<a name="line.1439"></a>
<span class="sourceLineNo">1440</span>         optional comment describing the<a name="line.1440"></a>
<span class="sourceLineNo">1441</span>         sample or experiment.<a name="line.1441"></a>
<span class="sourceLineNo">1442</span><a name="line.1442"></a>
<span class="sourceLineNo">1443</span>         allowed techniques are:<a name="line.1443"></a>
<span class="sourceLineNo">1444</span>         ELECTRON DIFFRACTION<a name="line.1444"></a>
<span class="sourceLineNo">1445</span>         FIBER DIFFRACTION<a name="line.1445"></a>
<span class="sourceLineNo">1446</span>         FLUORESCENCE TRANSFER<a name="line.1446"></a>
<span class="sourceLineNo">1447</span>         NEUTRON DIFFRACTION<a name="line.1447"></a>
<span class="sourceLineNo">1448</span>         NMR<a name="line.1448"></a>
<span class="sourceLineNo">1449</span>         THEORETICAL MODEL<a name="line.1449"></a>
<span class="sourceLineNo">1450</span>         X-RAY DIFFRACTION<a name="line.1450"></a>
<span class="sourceLineNo">1451</span><a name="line.1451"></a>
<span class="sourceLineNo">1452</span>         */<a name="line.1452"></a>
<span class="sourceLineNo">1453</span><a name="line.1453"></a>
<span class="sourceLineNo">1454</span>        private void pdb_EXPDTA_Handler(String line) {<a name="line.1454"></a>
<span class="sourceLineNo">1455</span><a name="line.1455"></a>
<span class="sourceLineNo">1456</span>                String technique  ;<a name="line.1456"></a>
<span class="sourceLineNo">1457</span>                if (line.length() &gt; 69)<a name="line.1457"></a>
<span class="sourceLineNo">1458</span>                        technique = line.substring (10, 70).trim() ;<a name="line.1458"></a>
<span class="sourceLineNo">1459</span>                else<a name="line.1459"></a>
<span class="sourceLineNo">1460</span>                        technique = line.substring(10).trim();<a name="line.1460"></a>
<span class="sourceLineNo">1461</span><a name="line.1461"></a>
<span class="sourceLineNo">1462</span>                String t =(String) header.get("technique");<a name="line.1462"></a>
<span class="sourceLineNo">1463</span>                t += technique +" ";<a name="line.1463"></a>
<span class="sourceLineNo">1464</span>                header.put("technique",t);<a name="line.1464"></a>
<span class="sourceLineNo">1465</span>                pdbHeader.setTechnique(t);<a name="line.1465"></a>
<span class="sourceLineNo">1466</span><a name="line.1466"></a>
<span class="sourceLineNo">1467</span>                int nmr = technique.indexOf("NMR");<a name="line.1467"></a>
<span class="sourceLineNo">1468</span>                if ( nmr != -1 ) structure.setNmr(true);  ;<a name="line.1468"></a>
<span class="sourceLineNo">1469</span><a name="line.1469"></a>
<span class="sourceLineNo">1470</span>        }<a name="line.1470"></a>
<span class="sourceLineNo">1471</span><a name="line.1471"></a>
<span class="sourceLineNo">1472</span>        /**<a name="line.1472"></a>
<span class="sourceLineNo">1473</span>         * Decides whether or not a Group is qualified to be added to the<a name="line.1473"></a>
<span class="sourceLineNo">1474</span>         * Structure.hetGroups list. If it likes it, it adds it.<a name="line.1474"></a>
<span class="sourceLineNo">1475</span>         * @param group<a name="line.1475"></a>
<span class="sourceLineNo">1476</span>         */<a name="line.1476"></a>
<span class="sourceLineNo">1477</span>        private void addTohetGroupsDecider(Group group) {<a name="line.1477"></a>
<span class="sourceLineNo">1478</span>                boolean wanted = false;<a name="line.1478"></a>
<span class="sourceLineNo">1479</span>                //these are HET groups, but they are usually less interesting<a name="line.1479"></a>
<span class="sourceLineNo">1480</span>                //than other types<a name="line.1480"></a>
<span class="sourceLineNo">1481</span>                if (group.getPDBName().equals("HOH"))<a name="line.1481"></a>
<span class="sourceLineNo">1482</span>                        return;<a name="line.1482"></a>
<span class="sourceLineNo">1483</span>                if (group.getChemComp() == null) {<a name="line.1483"></a>
<span class="sourceLineNo">1484</span>                        if (group.getType().equals(GroupType.HETATM)) {<a name="line.1484"></a>
<span class="sourceLineNo">1485</span>                                wanted = true;<a name="line.1485"></a>
<span class="sourceLineNo">1486</span>                        }<a name="line.1486"></a>
<span class="sourceLineNo">1487</span>                } else if (!group.getChemComp().isStandard()) {<a name="line.1487"></a>
<span class="sourceLineNo">1488</span>                        //also want to add modified amino acids e.g. TYS<a name="line.1488"></a>
<span class="sourceLineNo">1489</span>                        //these are GroupType.AMINOACID, so we need to check the ChemComp<a name="line.1489"></a>
<span class="sourceLineNo">1490</span>                        wanted = true;<a name="line.1490"></a>
<span class="sourceLineNo">1491</span>                }<a name="line.1491"></a>
<span class="sourceLineNo">1492</span><a name="line.1492"></a>
<span class="sourceLineNo">1493</span>                if (wanted) {<a name="line.1493"></a>
<span class="sourceLineNo">1494</span>                        if (! structure.getHetGroups().contains(group)) {<a name="line.1494"></a>
<span class="sourceLineNo">1495</span>                                //                    System.out.println("Added " + group + " to structure.hetgroups");<a name="line.1495"></a>
<span class="sourceLineNo">1496</span>                                structure.getHetGroups().add(group);<a name="line.1496"></a>
<span class="sourceLineNo">1497</span>                        }<a name="line.1497"></a>
<span class="sourceLineNo">1498</span>                }<a name="line.1498"></a>
<span class="sourceLineNo">1499</span>        }<a name="line.1499"></a>
<span class="sourceLineNo">1500</span><a name="line.1500"></a>
<span class="sourceLineNo">1501</span>        /**<a name="line.1501"></a>
<span class="sourceLineNo">1502</span>         Handler for<a name="line.1502"></a>
<span class="sourceLineNo">1503</span>         ATOM Record Format<a name="line.1503"></a>
<span class="sourceLineNo">1504</span>         *<a name="line.1504"></a>
<span class="sourceLineNo">1505</span>         &lt;pre&gt;<a name="line.1505"></a>
<span class="sourceLineNo">1506</span>         ATOM      1  N   ASP A  15     110.964  24.941  59.191  1.00 83.44           N<a name="line.1506"></a>
<span class="sourceLineNo">1507</span>         *<a name="line.1507"></a>
<span class="sourceLineNo">1508</span>         COLUMNS        DATA TYPE       FIELD         DEFINITION<a name="line.1508"></a>
<span class="sourceLineNo">1509</span>         ---------------------------------------------------------------------------------<a name="line.1509"></a>
<span class="sourceLineNo">1510</span>         1 -  6        Record name     "ATOM  "<a name="line.1510"></a>
<span class="sourceLineNo">1511</span>         7 - 11        Integer         serial        Atom serial number.<a name="line.1511"></a>
<span class="sourceLineNo">1512</span>         13 - 16        Atom            name          Atom name.<a name="line.1512"></a>
<span class="sourceLineNo">1513</span>         17             Character       altLoc        Alternate location indicator.<a name="line.1513"></a>
<span class="sourceLineNo">1514</span>         18 - 20        Residue name    resName       Residue name.<a name="line.1514"></a>
<span class="sourceLineNo">1515</span>         22             Character       chainID       Chain identifier.<a name="line.1515"></a>
<span class="sourceLineNo">1516</span>         23 - 26        Integer         resSeq        Residue sequence number.<a name="line.1516"></a>
<span class="sourceLineNo">1517</span>         27             AChar           iCode         Code for insertion of residues.<a name="line.1517"></a>
<span class="sourceLineNo">1518</span>         31 - 38        Real(8.3)       x             Orthogonal coordinates for X in<a name="line.1518"></a>
<span class="sourceLineNo">1519</span>         Angstroms.<a name="line.1519"></a>
<span class="sourceLineNo">1520</span>         39 - 46        Real(8.3)       y             Orthogonal coordinates for Y in<a name="line.1520"></a>
<span class="sourceLineNo">1521</span>         Angstroms.<a name="line.1521"></a>
<span class="sourceLineNo">1522</span>         47 - 54        Real(8.3)       z             Orthogonal coordinates for Z in<a name="line.1522"></a>
<span class="sourceLineNo">1523</span>         Angstroms.<a name="line.1523"></a>
<span class="sourceLineNo">1524</span>         55 - 60        Real(6.2)       occupancy     Occupancy.<a name="line.1524"></a>
<span class="sourceLineNo">1525</span>         61 - 66        Real(6.2)       tempFactor    Temperature factor.<a name="line.1525"></a>
<span class="sourceLineNo">1526</span>         73 - 76        LString(4)      segID         Segment identifier, left-justified.<a name="line.1526"></a>
<span class="sourceLineNo">1527</span>         77 - 78        LString(2)      element       Element symbol, right-justified.<a name="line.1527"></a>
<span class="sourceLineNo">1528</span>         79 - 80        LString(2)      charge        Charge on the atom.<a name="line.1528"></a>
<span class="sourceLineNo">1529</span>         &lt;/pre&gt;<a name="line.1529"></a>
<span class="sourceLineNo">1530</span>         */<a name="line.1530"></a>
<span class="sourceLineNo">1531</span>        private void  pdb_ATOM_Handler(String line)<a name="line.1531"></a>
<span class="sourceLineNo">1532</span>        throws PDBParseException<a name="line.1532"></a>
<span class="sourceLineNo">1533</span>        {<a name="line.1533"></a>
<span class="sourceLineNo">1534</span>                // build up chains first.<a name="line.1534"></a>
<span class="sourceLineNo">1535</span>                // headerOnly just goes down to chain resolution.<a name="line.1535"></a>
<span class="sourceLineNo">1536</span><a name="line.1536"></a>
<span class="sourceLineNo">1537</span>                boolean startOfNewChain = false;<a name="line.1537"></a>
<span class="sourceLineNo">1538</span><a name="line.1538"></a>
<span class="sourceLineNo">1539</span>                String chain_id      = line.substring(21,22);<a name="line.1539"></a>
<span class="sourceLineNo">1540</span><a name="line.1540"></a>
<span class="sourceLineNo">1541</span>                if (current_chain == null) {<a name="line.1541"></a>
<span class="sourceLineNo">1542</span>                        current_chain = new ChainImpl();<a name="line.1542"></a>
<span class="sourceLineNo">1543</span>                        current_chain.setChainID(chain_id);<a name="line.1543"></a>
<span class="sourceLineNo">1544</span>                        startOfNewChain = true;<a name="line.1544"></a>
<span class="sourceLineNo">1545</span>                        current_model.add(current_chain);               <a name="line.1545"></a>
<span class="sourceLineNo">1546</span>                }<a name="line.1546"></a>
<span class="sourceLineNo">1547</span><a name="line.1547"></a>
<span class="sourceLineNo">1548</span><a name="line.1548"></a>
<span class="sourceLineNo">1549</span>                if ( ! chain_id.equals(current_chain.getChainID()) ) {<a name="line.1549"></a>
<span class="sourceLineNo">1550</span><a name="line.1550"></a>
<span class="sourceLineNo">1551</span>                        startOfNewChain = true;<a name="line.1551"></a>
<span class="sourceLineNo">1552</span><a name="line.1552"></a>
<span class="sourceLineNo">1553</span>                        // end up old chain...<a name="line.1553"></a>
<span class="sourceLineNo">1554</span>                        current_chain.addGroup(current_group);<a name="line.1554"></a>
<span class="sourceLineNo">1555</span><a name="line.1555"></a>
<span class="sourceLineNo">1556</span>                        // see if old chain is known ...<a name="line.1556"></a>
<span class="sourceLineNo">1557</span>                        Chain testchain ;<a name="line.1557"></a>
<span class="sourceLineNo">1558</span>                        testchain = isKnownChain(current_chain.getChainID(),current_model);<a name="line.1558"></a>
<span class="sourceLineNo">1559</span><a name="line.1559"></a>
<span class="sourceLineNo">1560</span>                        //System.out.println("trying to re-using known chain " + current_chain.getName() + " " + chain_id);             <a name="line.1560"></a>
<span class="sourceLineNo">1561</span>                        if ( testchain != null &amp;&amp; testchain.getChainID().equals(chain_id)){<a name="line.1561"></a>
<span class="sourceLineNo">1562</span>                                //System.out.println("re-using known chain " + current_chain.getName() + " " + chain_id);                               <a name="line.1562"></a>
<span class="sourceLineNo">1563</span><a name="line.1563"></a>
<span class="sourceLineNo">1564</span>                        } else {<a name="line.1564"></a>
<span class="sourceLineNo">1565</span><a name="line.1565"></a>
<span class="sourceLineNo">1566</span>                                testchain = isKnownChain(chain_id,current_model);<a name="line.1566"></a>
<span class="sourceLineNo">1567</span>                        }<a name="line.1567"></a>
<span class="sourceLineNo">1568</span><a name="line.1568"></a>
<span class="sourceLineNo">1569</span>                        if ( testchain == null) {<a name="line.1569"></a>
<span class="sourceLineNo">1570</span>                                //System.out.println("unknown chain. creating new chain.");<a name="line.1570"></a>
<span class="sourceLineNo">1571</span><a name="line.1571"></a>
<span class="sourceLineNo">1572</span>                                current_chain = new ChainImpl();<a name="line.1572"></a>
<span class="sourceLineNo">1573</span>                                current_chain.setChainID(chain_id);<a name="line.1573"></a>
<span class="sourceLineNo">1574</span><a name="line.1574"></a>
<span class="sourceLineNo">1575</span>                        }   else {<a name="line.1575"></a>
<span class="sourceLineNo">1576</span>                                current_chain = testchain;<a name="line.1576"></a>
<span class="sourceLineNo">1577</span>                        }<a name="line.1577"></a>
<span class="sourceLineNo">1578</span><a name="line.1578"></a>
<span class="sourceLineNo">1579</span>                        if ( ! current_model.contains(current_chain))<a name="line.1579"></a>
<span class="sourceLineNo">1580</span>                                current_model.add(current_chain);<a name="line.1580"></a>
<span class="sourceLineNo">1581</span><a name="line.1581"></a>
<span class="sourceLineNo">1582</span><a name="line.1582"></a>
<span class="sourceLineNo">1583</span>                } <a name="line.1583"></a>
<span class="sourceLineNo">1584</span><a name="line.1584"></a>
<span class="sourceLineNo">1585</span>                // process group data:<a name="line.1585"></a>
<span class="sourceLineNo">1586</span>                // join residue numbers and insertion codes together<a name="line.1586"></a>
<span class="sourceLineNo">1587</span>                String recordName     = line.substring (0, 6).trim ();<a name="line.1587"></a>
<span class="sourceLineNo">1588</span>                //String pdbCode = line.substring(22,27).trim();<a name="line.1588"></a>
<span class="sourceLineNo">1589</span>                String groupCode3     = line.substring(17,20);<a name="line.1589"></a>
<span class="sourceLineNo">1590</span>                // pdbCode is the old way of doing things...it's a concatenation<a name="line.1590"></a>
<span class="sourceLineNo">1591</span>                //of resNum and iCode which are now defined explicitly<a name="line.1591"></a>
<span class="sourceLineNo">1592</span>                String resNum  = line.substring(22,26).trim();<a name="line.1592"></a>
<span class="sourceLineNo">1593</span>                Character iCode = line.substring(26,27).charAt(0);<a name="line.1593"></a>
<span class="sourceLineNo">1594</span>                if ( iCode == ' ')<a name="line.1594"></a>
<span class="sourceLineNo">1595</span>                        iCode = null;<a name="line.1595"></a>
<span class="sourceLineNo">1596</span>                ResidueNumber residueNumber = new ResidueNumber(chain_id, Integer.valueOf(resNum), iCode);<a name="line.1596"></a>
<span class="sourceLineNo">1597</span><a name="line.1597"></a>
<span class="sourceLineNo">1598</span>                //recordName      groupCode3<a name="line.1598"></a>
<span class="sourceLineNo">1599</span>                //|                |    resNum<a name="line.1599"></a>
<span class="sourceLineNo">1600</span>                //|                |    |   iCode<a name="line.1600"></a>
<span class="sourceLineNo">1601</span>                //|     |          | |  |   ||<a name="line.1601"></a>
<span class="sourceLineNo">1602</span>                //ATOM      1  N   ASP A  15     110.964  24.941  59.191  1.00 83.44           N<a name="line.1602"></a>
<span class="sourceLineNo">1603</span>                //ATOM   1964  N   ARG H 221A      5.963 -16.715  27.669  1.00 28.59           N<a name="line.1603"></a>
<span class="sourceLineNo">1604</span><a name="line.1604"></a>
<span class="sourceLineNo">1605</span>                Character aminoCode1 = null;<a name="line.1605"></a>
<span class="sourceLineNo">1606</span><a name="line.1606"></a>
<span class="sourceLineNo">1607</span>                if ( recordName.equals("ATOM") ){<a name="line.1607"></a>
<span class="sourceLineNo">1608</span>                        aminoCode1 = StructureTools.get1LetterCode(groupCode3);<a name="line.1608"></a>
<span class="sourceLineNo">1609</span>                } else {<a name="line.1609"></a>
<span class="sourceLineNo">1610</span>                        // HETATOM RECORDS are treated slightly differently<a name="line.1610"></a>
<span class="sourceLineNo">1611</span>                        // some modified amino acids that we want to treat as amino acids<a name="line.1611"></a>
<span class="sourceLineNo">1612</span>                        // can be found as HETATOM records<a name="line.1612"></a>
<span class="sourceLineNo">1613</span>                        aminoCode1 = StructureTools.get1LetterCode(groupCode3);<a name="line.1613"></a>
<span class="sourceLineNo">1614</span>                        if ( aminoCode1 != null)<a name="line.1614"></a>
<span class="sourceLineNo">1615</span>                                if ( aminoCode1.equals(StructureTools.UNKNOWN_GROUP_LABEL))<a name="line.1615"></a>
<span class="sourceLineNo">1616</span>                                        aminoCode1 = null;<a name="line.1616"></a>
<span class="sourceLineNo">1617</span>                }<a name="line.1617"></a>
<span class="sourceLineNo">1618</span><a name="line.1618"></a>
<span class="sourceLineNo">1619</span>                if (current_group == null) {<a name="line.1619"></a>
<span class="sourceLineNo">1620</span><a name="line.1620"></a>
<span class="sourceLineNo">1621</span>                        current_group = getNewGroup(recordName,aminoCode1,groupCode3);<a name="line.1621"></a>
<span class="sourceLineNo">1622</span>                        //               current_group.setPDBCode(pdbCode);<a name="line.1622"></a>
<span class="sourceLineNo">1623</span>                        current_group.setPDBName(groupCode3);<a name="line.1623"></a>
<span class="sourceLineNo">1624</span>                        current_group.setResidueNumber(residueNumber);<a name="line.1624"></a>
<span class="sourceLineNo">1625</span>                        //                                              System.out.println("Made new group: " + groupCode3 + " " + resNum + " " + iCode);<a name="line.1625"></a>
<span class="sourceLineNo">1626</span>                        addTohetGroupsDecider(current_group);<a name="line.1626"></a>
<span class="sourceLineNo">1627</span>                }<a name="line.1627"></a>
<span class="sourceLineNo">1628</span><a name="line.1628"></a>
<span class="sourceLineNo">1629</span><a name="line.1629"></a>
<span class="sourceLineNo">1630</span>                if ( startOfNewChain) {<a name="line.1630"></a>
<span class="sourceLineNo">1631</span>                        //System.out.println("end of chain: "+current_chain.getName()+" &gt;"+chain_id+"&lt;");<a name="line.1631"></a>
<span class="sourceLineNo">1632</span><a name="line.1632"></a>
<span class="sourceLineNo">1633</span>                        current_group = getNewGroup(recordName,aminoCode1,groupCode3);<a name="line.1633"></a>
<span class="sourceLineNo">1634</span>                        //current_group.setPDBCode(pdbCode);<a name="line.1634"></a>
<span class="sourceLineNo">1635</span>                        current_group.setPDBName(groupCode3);<a name="line.1635"></a>
<span class="sourceLineNo">1636</span>                        current_group.setResidueNumber(residueNumber);<a name="line.1636"></a>
<span class="sourceLineNo">1637</span>                        addTohetGroupsDecider(current_group);<a name="line.1637"></a>
<span class="sourceLineNo">1638</span>                        //                        System.out.println("Made new start of chain group:  " + groupCode3 + " " + resNum + " " + iCode);<a name="line.1638"></a>
<span class="sourceLineNo">1639</span>                }<a name="line.1639"></a>
<span class="sourceLineNo">1640</span><a name="line.1640"></a>
<span class="sourceLineNo">1641</span><a name="line.1641"></a>
<span class="sourceLineNo">1642</span>                Character altLoc   = new Character(line.substring (16, 17).charAt(0));<a name="line.1642"></a>
<span class="sourceLineNo">1643</span>                Group altGroup = null;<a name="line.1643"></a>
<span class="sourceLineNo">1644</span><a name="line.1644"></a>
<span class="sourceLineNo">1645</span>                //System.out.println(current_group + " " + residueNumber);<a name="line.1645"></a>
<span class="sourceLineNo">1646</span><a name="line.1646"></a>
<span class="sourceLineNo">1647</span>                // check if residue number is the same ...<a name="line.1647"></a>
<span class="sourceLineNo">1648</span>                // insertion code is part of residue number<a name="line.1648"></a>
<span class="sourceLineNo">1649</span>                if ( ! residueNumber.equals(current_group.getResidueNumber())) {<a name="line.1649"></a>
<span class="sourceLineNo">1650</span><a name="line.1650"></a>
<span class="sourceLineNo">1651</span>                        current_chain.addGroup(current_group);<a name="line.1651"></a>
<span class="sourceLineNo">1652</span><a name="line.1652"></a>
<span class="sourceLineNo">1653</span>                        current_group = getNewGroup(recordName,aminoCode1,groupCode3);<a name="line.1653"></a>
<span class="sourceLineNo">1654</span><a name="line.1654"></a>
<span class="sourceLineNo">1655</span>                        //current_group.setPDBCode(pdbCode);<a name="line.1655"></a>
<span class="sourceLineNo">1656</span>                        current_group.setPDBName(groupCode3);<a name="line.1656"></a>
<span class="sourceLineNo">1657</span>                        current_group.setResidueNumber(residueNumber);<a name="line.1657"></a>
<span class="sourceLineNo">1658</span>                        addTohetGroupsDecider(current_group);<a name="line.1658"></a>
<span class="sourceLineNo">1659</span>                        //                        System.out.println("Made new group:  " + groupCode3 + " " + resNum + " " + iCode);<a name="line.1659"></a>
<span class="sourceLineNo">1660</span><a name="line.1660"></a>
<span class="sourceLineNo">1661</span>                } else {<a name="line.1661"></a>
<span class="sourceLineNo">1662</span>                        // same residueNumber, but altLocs...<a name="line.1662"></a>
<span class="sourceLineNo">1663</span><a name="line.1663"></a>
<span class="sourceLineNo">1664</span>                        // test altLoc<a name="line.1664"></a>
<span class="sourceLineNo">1665</span>                        if ( ! altLoc.equals(' ')) {                                                                                            <a name="line.1665"></a>
<span class="sourceLineNo">1666</span>                                altGroup = getCorrectAltLocGroup( altLoc,recordName,aminoCode1,groupCode3);<a name="line.1666"></a>
<span class="sourceLineNo">1667</span>                                if ( altGroup.getChain() == null) {<a name="line.1667"></a>
<span class="sourceLineNo">1668</span>                                        // need to set current chain<a name="line.1668"></a>
<span class="sourceLineNo">1669</span>                                        altGroup.setChain(current_chain);<a name="line.1669"></a>
<span class="sourceLineNo">1670</span>                                }<a name="line.1670"></a>
<span class="sourceLineNo">1671</span>                                //System.out.println("found altLoc! " + current_group + " " + altGroup);<a name="line.1671"></a>
<span class="sourceLineNo">1672</span>                        }<a name="line.1672"></a>
<span class="sourceLineNo">1673</span>                }<a name="line.1673"></a>
<span class="sourceLineNo">1674</span><a name="line.1674"></a>
<span class="sourceLineNo">1675</span><a name="line.1675"></a>
<span class="sourceLineNo">1676</span><a name="line.1676"></a>
<span class="sourceLineNo">1677</span>                if ( params.isHeaderOnly())<a name="line.1677"></a>
<span class="sourceLineNo">1678</span>                        return;<a name="line.1678"></a>
<span class="sourceLineNo">1679</span><a name="line.1679"></a>
<span class="sourceLineNo">1680</span>                atomCount++;<a name="line.1680"></a>
<span class="sourceLineNo">1681</span><a name="line.1681"></a>
<span class="sourceLineNo">1682</span>                if ( atomCount == ATOM_CA_THRESHOLD ) {<a name="line.1682"></a>
<span class="sourceLineNo">1683</span>                        // throw away the SEQRES lines - too much to deal with...<a name="line.1683"></a>
<span class="sourceLineNo">1684</span>                        System.err.println("more than " + ATOM_CA_THRESHOLD + " atoms in this structure, ignoring the SEQRES lines");<a name="line.1684"></a>
<span class="sourceLineNo">1685</span>                        seqResChains.clear();<a name="line.1685"></a>
<span class="sourceLineNo">1686</span><a name="line.1686"></a>
<span class="sourceLineNo">1687</span>                        switchCAOnly();<a name="line.1687"></a>
<span class="sourceLineNo">1688</span><a name="line.1688"></a>
<span class="sourceLineNo">1689</span>                }<a name="line.1689"></a>
<span class="sourceLineNo">1690</span><a name="line.1690"></a>
<span class="sourceLineNo">1691</span>                if ( atomCount == MAX_ATOMS){<a name="line.1691"></a>
<span class="sourceLineNo">1692</span>                        System.err.println("too many atoms (&gt;"+MAX_ATOMS+"in this protein structure.");<a name="line.1692"></a>
<span class="sourceLineNo">1693</span>                        System.err.println("ignoring lines after: " + line);<a name="line.1693"></a>
<span class="sourceLineNo">1694</span>                        return;<a name="line.1694"></a>
<span class="sourceLineNo">1695</span>                }<a name="line.1695"></a>
<span class="sourceLineNo">1696</span>                if ( atomCount &gt; MAX_ATOMS){<a name="line.1696"></a>
<span class="sourceLineNo">1697</span>                        //System.out.println("too many atoms in this protein structure.");<a name="line.1697"></a>
<span class="sourceLineNo">1698</span>                        //System.out.println("ignoring line: " + line);<a name="line.1698"></a>
<span class="sourceLineNo">1699</span>                        return;<a name="line.1699"></a>
<span class="sourceLineNo">1700</span>                }<a name="line.1700"></a>
<span class="sourceLineNo">1701</span><a name="line.1701"></a>
<span class="sourceLineNo">1702</span><a name="line.1702"></a>
<span class="sourceLineNo">1703</span>                //          1         2         3         4         5         6<a name="line.1703"></a>
<span class="sourceLineNo">1704</span>                //012345678901234567890123456789012345678901234567890123456789<a name="line.1704"></a>
<span class="sourceLineNo">1705</span>                //ATOM      1  N   MET     1      20.154  29.699   5.276   1.0<a name="line.1705"></a>
<span class="sourceLineNo">1706</span>                //ATOM    112  CA  ASP   112      41.017  33.527  28.371  1.00  0.00<a name="line.1706"></a>
<span class="sourceLineNo">1707</span>                //ATOM     53  CA  MET     7      23.772  33.989 -21.600  1.00  0.00           C<a name="line.1707"></a>
<span class="sourceLineNo">1708</span>                //ATOM    112  CA  ASP   112      37.613  26.621  33.571     0     0<a name="line.1708"></a>
<span class="sourceLineNo">1709</span><a name="line.1709"></a>
<span class="sourceLineNo">1710</span><a name="line.1710"></a>
<span class="sourceLineNo">1711</span>                String fullname = line.substring (12, 16);<a name="line.1711"></a>
<span class="sourceLineNo">1712</span><a name="line.1712"></a>
<span class="sourceLineNo">1713</span>                // check for CA only if requested<a name="line.1713"></a>
<span class="sourceLineNo">1714</span>                if ( parseCAonly ){<a name="line.1714"></a>
<span class="sourceLineNo">1715</span>                        // yes , user wants to get CA only<a name="line.1715"></a>
<span class="sourceLineNo">1716</span>                        // only parse CA atoms...<a name="line.1716"></a>
<span class="sourceLineNo">1717</span>                        if (! fullname.equals(" CA ")){<a name="line.1717"></a>
<span class="sourceLineNo">1718</span>                                //System.out.println("ignoring " + line);<a name="line.1718"></a>
<span class="sourceLineNo">1719</span>                                atomCount--;<a name="line.1719"></a>
<span class="sourceLineNo">1720</span>                                return;<a name="line.1720"></a>
<span class="sourceLineNo">1721</span>                        }<a name="line.1721"></a>
<span class="sourceLineNo">1722</span>                }<a name="line.1722"></a>
<span class="sourceLineNo">1723</span>                // create new atom<a name="line.1723"></a>
<span class="sourceLineNo">1724</span><a name="line.1724"></a>
<span class="sourceLineNo">1725</span>                int pdbnumber = Integer.parseInt (line.substring (6, 11).trim ());<a name="line.1725"></a>
<span class="sourceLineNo">1726</span>                AtomImpl atom = new AtomImpl() ;<a name="line.1726"></a>
<span class="sourceLineNo">1727</span>                atom.setPDBserial(pdbnumber) ;<a name="line.1727"></a>
<span class="sourceLineNo">1728</span><a name="line.1728"></a>
<span class="sourceLineNo">1729</span>                atom.setAltLoc(altLoc);<a name="line.1729"></a>
<span class="sourceLineNo">1730</span>                atom.setFullName(fullname) ;<a name="line.1730"></a>
<span class="sourceLineNo">1731</span>                atom.setName(fullname.trim());<a name="line.1731"></a>
<span class="sourceLineNo">1732</span><a name="line.1732"></a>
<span class="sourceLineNo">1733</span>                double x = Double.parseDouble (line.substring (30, 38).trim());<a name="line.1733"></a>
<span class="sourceLineNo">1734</span>                double y = Double.parseDouble (line.substring (38, 46).trim());<a name="line.1734"></a>
<span class="sourceLineNo">1735</span>                double z = Double.parseDouble (line.substring (46, 54).trim());<a name="line.1735"></a>
<span class="sourceLineNo">1736</span><a name="line.1736"></a>
<span class="sourceLineNo">1737</span>                double[] coords = new double[3];<a name="line.1737"></a>
<span class="sourceLineNo">1738</span>                coords[0] = x ;<a name="line.1738"></a>
<span class="sourceLineNo">1739</span>                coords[1] = y ;<a name="line.1739"></a>
<span class="sourceLineNo">1740</span>                coords[2] = z ;<a name="line.1740"></a>
<span class="sourceLineNo">1741</span>                atom.setCoords(coords);<a name="line.1741"></a>
<span class="sourceLineNo">1742</span><a name="line.1742"></a>
<span class="sourceLineNo">1743</span>                double occu  = 1.0;<a name="line.1743"></a>
<span class="sourceLineNo">1744</span>                if ( line.length() &gt; 59 ) {<a name="line.1744"></a>
<span class="sourceLineNo">1745</span>                        try {<a name="line.1745"></a>
<span class="sourceLineNo">1746</span>                                // occu and tempf are sometimes not used :-/<a name="line.1746"></a>
<span class="sourceLineNo">1747</span>                                occu = Double.parseDouble (line.substring (54, 60).trim());<a name="line.1747"></a>
<span class="sourceLineNo">1748</span>                        }  catch (NumberFormatException e){}<a name="line.1748"></a>
<span class="sourceLineNo">1749</span>                }<a name="line.1749"></a>
<span class="sourceLineNo">1750</span><a name="line.1750"></a>
<span class="sourceLineNo">1751</span>                double tempf = 0.0;<a name="line.1751"></a>
<span class="sourceLineNo">1752</span>                if ( line.length() &gt; 65) {<a name="line.1752"></a>
<span class="sourceLineNo">1753</span>                        try {<a name="line.1753"></a>
<span class="sourceLineNo">1754</span>                                tempf = Double.parseDouble (line.substring (60, 66).trim());<a name="line.1754"></a>
<span class="sourceLineNo">1755</span>                        }  catch (NumberFormatException e){}<a name="line.1755"></a>
<span class="sourceLineNo">1756</span>                }<a name="line.1756"></a>
<span class="sourceLineNo">1757</span><a name="line.1757"></a>
<span class="sourceLineNo">1758</span>                atom.setOccupancy(  occu  );<a name="line.1758"></a>
<span class="sourceLineNo">1759</span>                atom.setTempFactor( tempf );<a name="line.1759"></a>
<span class="sourceLineNo">1760</span><a name="line.1760"></a>
<span class="sourceLineNo">1761</span><a name="line.1761"></a>
<span class="sourceLineNo">1762</span><a name="line.1762"></a>
<span class="sourceLineNo">1763</span><a name="line.1763"></a>
<span class="sourceLineNo">1764</span>                // Parse element from the element field. If this field is<a name="line.1764"></a>
<span class="sourceLineNo">1765</span>                // missing (i.e. misformatted PDB file), then parse the<a name="line.1765"></a>
<span class="sourceLineNo">1766</span>                // name from the atom name.<a name="line.1766"></a>
<span class="sourceLineNo">1767</span>                Element element = Element.R;<a name="line.1767"></a>
<span class="sourceLineNo">1768</span>                if ( line.length() &gt; 77 ) {<a name="line.1768"></a>
<span class="sourceLineNo">1769</span>                        // parse element from element field<a name="line.1769"></a>
<span class="sourceLineNo">1770</span>                        try {<a name="line.1770"></a>
<span class="sourceLineNo">1771</span>                                element = Element.valueOfIgnoreCase(line.substring (76, 78).trim());<a name="line.1771"></a>
<span class="sourceLineNo">1772</span>                        }  catch (IllegalArgumentException e){}<a name="line.1772"></a>
<span class="sourceLineNo">1773</span>                } else {<a name="line.1773"></a>
<span class="sourceLineNo">1774</span>                        // parse the name from the atom name<a name="line.1774"></a>
<span class="sourceLineNo">1775</span>                        String elementSymbol = null;<a name="line.1775"></a>
<span class="sourceLineNo">1776</span>                        // for atom names with 4 characters, the element is<a name="line.1776"></a>
<span class="sourceLineNo">1777</span>                        // at the first position, example HG23 in Valine<a name="line.1777"></a>
<span class="sourceLineNo">1778</span>                        if (fullname.trim().length() == 4) {<a name="line.1778"></a>
<span class="sourceLineNo">1779</span>                                elementSymbol = fullname.substring(0, 1);<a name="line.1779"></a>
<span class="sourceLineNo">1780</span>                        } else if ( fullname.trim().length() &gt; 1){<a name="line.1780"></a>
<span class="sourceLineNo">1781</span>                                elementSymbol = fullname.substring(0, 2).trim();<a name="line.1781"></a>
<span class="sourceLineNo">1782</span>                        } else {<a name="line.1782"></a>
<span class="sourceLineNo">1783</span>                                // unknown element...<a name="line.1783"></a>
<span class="sourceLineNo">1784</span>                                elementSymbol = "R";<a name="line.1784"></a>
<span class="sourceLineNo">1785</span>                        }<a name="line.1785"></a>
<span class="sourceLineNo">1786</span><a name="line.1786"></a>
<span class="sourceLineNo">1787</span>                        try {<a name="line.1787"></a>
<span class="sourceLineNo">1788</span>                                element = Element.valueOfIgnoreCase(elementSymbol);<a name="line.1788"></a>
<span class="sourceLineNo">1789</span>                        }  catch (IllegalArgumentException e){}<a name="line.1789"></a>
<span class="sourceLineNo">1790</span>                }<a name="line.1790"></a>
<span class="sourceLineNo">1791</span>                atom.setElement(element);<a name="line.1791"></a>
<span class="sourceLineNo">1792</span><a name="line.1792"></a>
<span class="sourceLineNo">1793</span><a name="line.1793"></a>
<span class="sourceLineNo">1794</span>                //see if chain_id is one of the previous chains ...<a name="line.1794"></a>
<span class="sourceLineNo">1795</span>                if ( altGroup != null) {<a name="line.1795"></a>
<span class="sourceLineNo">1796</span>                        altGroup.addAtom(atom);<a name="line.1796"></a>
<span class="sourceLineNo">1797</span>                        altGroup = null;<a name="line.1797"></a>
<span class="sourceLineNo">1798</span>                }<a name="line.1798"></a>
<span class="sourceLineNo">1799</span>                else {<a name="line.1799"></a>
<span class="sourceLineNo">1800</span>                        current_group.addAtom(atom);<a name="line.1800"></a>
<span class="sourceLineNo">1801</span>                }<a name="line.1801"></a>
<span class="sourceLineNo">1802</span>                //System.out.println(current_group);<a name="line.1802"></a>
<span class="sourceLineNo">1803</span>        }<a name="line.1803"></a>
<span class="sourceLineNo">1804</span><a name="line.1804"></a>
<span class="sourceLineNo">1805</span><a name="line.1805"></a>
<span class="sourceLineNo">1806</span>        private Group getCorrectAltLocGroup( Character altLoc,<a name="line.1806"></a>
<span class="sourceLineNo">1807</span>                        String recordName, Character aminoCode1, String groupCode3) {<a name="line.1807"></a>
<span class="sourceLineNo">1808</span><a name="line.1808"></a>
<span class="sourceLineNo">1809</span>                // see if we know this altLoc already;<a name="line.1809"></a>
<span class="sourceLineNo">1810</span>                List&lt;Atom&gt; atoms = current_group.getAtoms();<a name="line.1810"></a>
<span class="sourceLineNo">1811</span>                if ( atoms.size() &gt; 0) {<a name="line.1811"></a>
<span class="sourceLineNo">1812</span>                        Atom a1 = atoms.get(0);<a name="line.1812"></a>
<span class="sourceLineNo">1813</span>                        // we are just adding atoms to the current group<a name="line.1813"></a>
<span class="sourceLineNo">1814</span>                        // probably there is a second group following later...<a name="line.1814"></a>
<span class="sourceLineNo">1815</span>                        if (a1.getAltLoc().equals(altLoc)) {<a name="line.1815"></a>
<span class="sourceLineNo">1816</span><a name="line.1816"></a>
<span class="sourceLineNo">1817</span>                                return current_group;<a name="line.1817"></a>
<span class="sourceLineNo">1818</span>                        }<a name="line.1818"></a>
<span class="sourceLineNo">1819</span>                }<a name="line.1819"></a>
<span class="sourceLineNo">1820</span><a name="line.1820"></a>
<span class="sourceLineNo">1821</span>                List&lt;Group&gt; altLocs = current_group.getAltLocs();<a name="line.1821"></a>
<span class="sourceLineNo">1822</span>                for ( Group altLocG : altLocs ){<a name="line.1822"></a>
<span class="sourceLineNo">1823</span>                        atoms = altLocG.getAtoms();<a name="line.1823"></a>
<span class="sourceLineNo">1824</span>                        if ( atoms.size() &gt; 0) {<a name="line.1824"></a>
<span class="sourceLineNo">1825</span>                                for ( Atom a1 : atoms) {<a name="line.1825"></a>
<span class="sourceLineNo">1826</span>                                        if (a1.getAltLoc().equals( altLoc)) {<a name="line.1826"></a>
<span class="sourceLineNo">1827</span><a name="line.1827"></a>
<span class="sourceLineNo">1828</span>                                                return altLocG;<a name="line.1828"></a>
<span class="sourceLineNo">1829</span>                                        }<a name="line.1829"></a>
<span class="sourceLineNo">1830</span>                                }<a name="line.1830"></a>
<span class="sourceLineNo">1831</span>                        }<a name="line.1831"></a>
<span class="sourceLineNo">1832</span>                }<a name="line.1832"></a>
<span class="sourceLineNo">1833</span><a name="line.1833"></a>
<span class="sourceLineNo">1834</span>                // no matching altLoc group found.<a name="line.1834"></a>
<span class="sourceLineNo">1835</span>                // build it up.<a name="line.1835"></a>
<span class="sourceLineNo">1836</span><a name="line.1836"></a>
<span class="sourceLineNo">1837</span>                if ( groupCode3.equals(current_group.getPDBName())) {<a name="line.1837"></a>
<span class="sourceLineNo">1838</span>                        if ( current_group.getAtoms().size() == 0)<a name="line.1838"></a>
<span class="sourceLineNo">1839</span>                                return current_group;<a name="line.1839"></a>
<span class="sourceLineNo">1840</span>                        //System.out.println("cloning current group");<a name="line.1840"></a>
<span class="sourceLineNo">1841</span>                        Group altLocG = (Group) current_group.clone();<a name="line.1841"></a>
<span class="sourceLineNo">1842</span>                        current_group.addAltLoc(altLocG);<a name="line.1842"></a>
<span class="sourceLineNo">1843</span>                        return altLocG; <a name="line.1843"></a>
<span class="sourceLineNo">1844</span>                }<a name="line.1844"></a>
<span class="sourceLineNo">1845</span><a name="line.1845"></a>
<span class="sourceLineNo">1846</span><a name="line.1846"></a>
<span class="sourceLineNo">1847</span>                Group altLocG = getNewGroup(recordName,aminoCode1,groupCode3);<a name="line.1847"></a>
<span class="sourceLineNo">1848</span><a name="line.1848"></a>
<span class="sourceLineNo">1849</span>                try {<a name="line.1849"></a>
<span class="sourceLineNo">1850</span>                        altLocG.setPDBName(groupCode3);<a name="line.1850"></a>
<span class="sourceLineNo">1851</span>                } catch (PDBParseException e) {<a name="line.1851"></a>
<span class="sourceLineNo">1852</span>                        e.printStackTrace();<a name="line.1852"></a>
<span class="sourceLineNo">1853</span>                }<a name="line.1853"></a>
<span class="sourceLineNo">1854</span>                altLocG.setResidueNumber(current_group.getResidueNumber());<a name="line.1854"></a>
<span class="sourceLineNo">1855</span>                current_group.addAltLoc(altLocG);<a name="line.1855"></a>
<span class="sourceLineNo">1856</span>                return altLocG;<a name="line.1856"></a>
<span class="sourceLineNo">1857</span>        }<a name="line.1857"></a>
<span class="sourceLineNo">1858</span><a name="line.1858"></a>
<span class="sourceLineNo">1859</span>        private void switchCAOnly(){<a name="line.1859"></a>
<span class="sourceLineNo">1860</span>                parseCAonly = true;<a name="line.1860"></a>
<span class="sourceLineNo">1861</span><a name="line.1861"></a>
<span class="sourceLineNo">1862</span><a name="line.1862"></a>
<span class="sourceLineNo">1863</span>                current_model = CAConverter.getCAOnly(current_model);<a name="line.1863"></a>
<span class="sourceLineNo">1864</span><a name="line.1864"></a>
<span class="sourceLineNo">1865</span>                for ( int i =0; i&lt; structure.nrModels() ; i++){<a name="line.1865"></a>
<span class="sourceLineNo">1866</span>                        //  iterate over all known models ...<a name="line.1866"></a>
<span class="sourceLineNo">1867</span>                        List&lt;Chain&gt; model = structure.getModel(i);<a name="line.1867"></a>
<span class="sourceLineNo">1868</span>                        model = CAConverter.getCAOnly(model);<a name="line.1868"></a>
<span class="sourceLineNo">1869</span>                        structure.setModel(i,model);<a name="line.1869"></a>
<span class="sourceLineNo">1870</span>                }<a name="line.1870"></a>
<span class="sourceLineNo">1871</span><a name="line.1871"></a>
<span class="sourceLineNo">1872</span>                current_chain = CAConverter.getCAOnly(current_chain);<a name="line.1872"></a>
<span class="sourceLineNo">1873</span><a name="line.1873"></a>
<span class="sourceLineNo">1874</span>        }<a name="line.1874"></a>
<span class="sourceLineNo">1875</span><a name="line.1875"></a>
<span class="sourceLineNo">1876</span><a name="line.1876"></a>
<span class="sourceLineNo">1877</span>        /** safes repeating a few lines ... */<a name="line.1877"></a>
<span class="sourceLineNo">1878</span>        private Integer conect_helper (String line,int start,int end) {<a name="line.1878"></a>
<span class="sourceLineNo">1879</span>                String sbond = line.substring(start,end).trim();<a name="line.1879"></a>
<span class="sourceLineNo">1880</span>                int bond  = -1 ;<a name="line.1880"></a>
<span class="sourceLineNo">1881</span>                Integer b = null ;<a name="line.1881"></a>
<span class="sourceLineNo">1882</span><a name="line.1882"></a>
<span class="sourceLineNo">1883</span>                if ( ! sbond.equals("")) {<a name="line.1883"></a>
<span class="sourceLineNo">1884</span>                        bond = Integer.parseInt(sbond);<a name="line.1884"></a>
<span class="sourceLineNo">1885</span>                        b = new Integer(bond);<a name="line.1885"></a>
<span class="sourceLineNo">1886</span>                }<a name="line.1886"></a>
<span class="sourceLineNo">1887</span><a name="line.1887"></a>
<span class="sourceLineNo">1888</span>                return b ;<a name="line.1888"></a>
<span class="sourceLineNo">1889</span>        }<a name="line.1889"></a>
<span class="sourceLineNo">1890</span><a name="line.1890"></a>
<span class="sourceLineNo">1891</span>        /**<a name="line.1891"></a>
<span class="sourceLineNo">1892</span>         Handler for<a name="line.1892"></a>
<span class="sourceLineNo">1893</span>         CONECT Record Format<a name="line.1893"></a>
<span class="sourceLineNo">1894</span><a name="line.1894"></a>
<span class="sourceLineNo">1895</span>         COLUMNS         DATA TYPE        FIELD           DEFINITION<a name="line.1895"></a>
<span class="sourceLineNo">1896</span>         ---------------------------------------------------------------------------------<a name="line.1896"></a>
<span class="sourceLineNo">1897</span>         1 -  6         Record name      "CONECT"<a name="line.1897"></a>
<span class="sourceLineNo">1898</span>         7 - 11         Integer          serial          Atom serial number<a name="line.1898"></a>
<span class="sourceLineNo">1899</span>         12 - 16         Integer          serial          Serial number of bonded atom<a name="line.1899"></a>
<span class="sourceLineNo">1900</span>         17 - 21         Integer          serial          Serial number of bonded atom<a name="line.1900"></a>
<span class="sourceLineNo">1901</span>         22 - 26         Integer          serial          Serial number of bonded atom<a name="line.1901"></a>
<span class="sourceLineNo">1902</span>         27 - 31         Integer          serial          Serial number of bonded atom<a name="line.1902"></a>
<span class="sourceLineNo">1903</span>         32 - 36         Integer          serial          Serial number of hydrogen bonded<a name="line.1903"></a>
<span class="sourceLineNo">1904</span>         atom<a name="line.1904"></a>
<span class="sourceLineNo">1905</span>         37 - 41         Integer          serial          Serial number of hydrogen bonded<a name="line.1905"></a>
<span class="sourceLineNo">1906</span>         atom<a name="line.1906"></a>
<span class="sourceLineNo">1907</span>         42 - 46         Integer          serial          Serial number of salt bridged<a name="line.1907"></a>
<span class="sourceLineNo">1908</span>         atom<a name="line.1908"></a>
<span class="sourceLineNo">1909</span>         47 - 51         Integer          serial          Serial number of hydrogen bonded<a name="line.1909"></a>
<span class="sourceLineNo">1910</span>         atom<a name="line.1910"></a>
<span class="sourceLineNo">1911</span>         52 - 56         Integer          serial          Serial number of hydrogen bonded<a name="line.1911"></a>
<span class="sourceLineNo">1912</span>         atom<a name="line.1912"></a>
<span class="sourceLineNo">1913</span>         57 - 61         Integer          serial          Serial number of salt bridged<a name="line.1913"></a>
<span class="sourceLineNo">1914</span>         atom<a name="line.1914"></a>
<span class="sourceLineNo">1915</span>         */<a name="line.1915"></a>
<span class="sourceLineNo">1916</span>        private void pdb_CONECT_Handler(String line) {<a name="line.1916"></a>
<span class="sourceLineNo">1917</span>                //System.out.println(line);<a name="line.1917"></a>
<span class="sourceLineNo">1918</span>                // this try .. catch is e.g. to catch 1gte which has wrongly formatted lines...<a name="line.1918"></a>
<span class="sourceLineNo">1919</span>                if ( atomOverflow) {<a name="line.1919"></a>
<span class="sourceLineNo">1920</span>                        return ;<a name="line.1920"></a>
<span class="sourceLineNo">1921</span>                }<a name="line.1921"></a>
<span class="sourceLineNo">1922</span>                try {<a name="line.1922"></a>
<span class="sourceLineNo">1923</span>                        int atomserial = Integer.parseInt (line.substring(6 ,11).trim());<a name="line.1923"></a>
<span class="sourceLineNo">1924</span>                        Integer bond1      = conect_helper(line,11,16);<a name="line.1924"></a>
<span class="sourceLineNo">1925</span>                        Integer bond2      = conect_helper(line,16,21);<a name="line.1925"></a>
<span class="sourceLineNo">1926</span>                        Integer bond3      = conect_helper(line,21,26);<a name="line.1926"></a>
<span class="sourceLineNo">1927</span>                        Integer bond4      = conect_helper(line,26,31);<a name="line.1927"></a>
<span class="sourceLineNo">1928</span>                        Integer hyd1       = conect_helper(line,31,36);<a name="line.1928"></a>
<span class="sourceLineNo">1929</span>                        Integer hyd2       = conect_helper(line,36,41);<a name="line.1929"></a>
<span class="sourceLineNo">1930</span>                        Integer salt1      = conect_helper(line,41,46);<a name="line.1930"></a>
<span class="sourceLineNo">1931</span>                        Integer hyd3       = conect_helper(line,46,51);<a name="line.1931"></a>
<span class="sourceLineNo">1932</span>                        Integer hyd4       = conect_helper(line,51,56);<a name="line.1932"></a>
<span class="sourceLineNo">1933</span>                        Integer salt2      = conect_helper(line,56,61);<a name="line.1933"></a>
<span class="sourceLineNo">1934</span><a name="line.1934"></a>
<span class="sourceLineNo">1935</span>                        //System.out.println(atomserial+ " "+ bond1 +" "+bond2+ " " +bond3+" "+bond4+" "+<a name="line.1935"></a>
<span class="sourceLineNo">1936</span>                        //                 hyd1+" "+hyd2 +" "+salt1+" "+hyd3+" "+hyd4+" "+salt2);<a name="line.1936"></a>
<span class="sourceLineNo">1937</span>                        HashMap&lt;String, Integer&gt; cons = new HashMap&lt;String, Integer&gt;();<a name="line.1937"></a>
<span class="sourceLineNo">1938</span>                        cons.put("atomserial",new Integer(atomserial));<a name="line.1938"></a>
<span class="sourceLineNo">1939</span><a name="line.1939"></a>
<span class="sourceLineNo">1940</span>                        if ( bond1 != null) cons.put("bond1",bond1);<a name="line.1940"></a>
<span class="sourceLineNo">1941</span>                        if ( bond2 != null) cons.put("bond2",bond2);<a name="line.1941"></a>
<span class="sourceLineNo">1942</span>                        if ( bond3 != null) cons.put("bond3",bond3);<a name="line.1942"></a>
<span class="sourceLineNo">1943</span>                        if ( bond4 != null) cons.put("bond4",bond4);<a name="line.1943"></a>
<span class="sourceLineNo">1944</span>                        if ( hyd1  != null) cons.put("hydrogen1",hyd1);<a name="line.1944"></a>
<span class="sourceLineNo">1945</span>                        if ( hyd2  != null) cons.put("hydrogen2",hyd2);<a name="line.1945"></a>
<span class="sourceLineNo">1946</span>                        if ( salt1 != null) cons.put("salt1",salt1);<a name="line.1946"></a>
<span class="sourceLineNo">1947</span>                        if ( hyd3  != null) cons.put("hydrogen3",hyd3);<a name="line.1947"></a>
<span class="sourceLineNo">1948</span>                        if ( hyd4  != null) cons.put("hydrogen4",hyd4);<a name="line.1948"></a>
<span class="sourceLineNo">1949</span>                        if ( salt2 != null) cons.put("salt2",salt2);<a name="line.1949"></a>
<span class="sourceLineNo">1950</span><a name="line.1950"></a>
<span class="sourceLineNo">1951</span>                        connects.add(cons);<a name="line.1951"></a>
<span class="sourceLineNo">1952</span>                } catch (Exception e){<a name="line.1952"></a>
<span class="sourceLineNo">1953</span>                        logger.fine("could not parse CONECT line correctly.");<a name="line.1953"></a>
<span class="sourceLineNo">1954</span>                        logger.fine(e.getMessage() + " at line " + line);<a name="line.1954"></a>
<span class="sourceLineNo">1955</span>                        return;<a name="line.1955"></a>
<span class="sourceLineNo">1956</span>                }<a name="line.1956"></a>
<span class="sourceLineNo">1957</span>        }<a name="line.1957"></a>
<span class="sourceLineNo">1958</span><a name="line.1958"></a>
<span class="sourceLineNo">1959</span>        /*<a name="line.1959"></a>
<span class="sourceLineNo">1960</span>         Handler for<a name="line.1960"></a>
<span class="sourceLineNo">1961</span>         MODEL Record Format<a name="line.1961"></a>
<span class="sourceLineNo">1962</span><a name="line.1962"></a>
<span class="sourceLineNo">1963</span>         COLUMNS       DATA TYPE      FIELD         DEFINITION<a name="line.1963"></a>
<span class="sourceLineNo">1964</span>         ----------------------------------------------------------------------<a name="line.1964"></a>
<span class="sourceLineNo">1965</span>         1 -  6       Record name    "MODEL "<a name="line.1965"></a>
<span class="sourceLineNo">1966</span>         11 - 14       Integer        serial        Model serial number.<a name="line.1966"></a>
<span class="sourceLineNo">1967</span>         */<a name="line.1967"></a>
<span class="sourceLineNo">1968</span><a name="line.1968"></a>
<span class="sourceLineNo">1969</span>        private void pdb_MODEL_Handler(String line) {<a name="line.1969"></a>
<span class="sourceLineNo">1970</span>                // check beginning of file ...<a name="line.1970"></a>
<span class="sourceLineNo">1971</span>                if (current_chain != null) {<a name="line.1971"></a>
<span class="sourceLineNo">1972</span>                        if (current_group != null) {<a name="line.1972"></a>
<span class="sourceLineNo">1973</span>                                current_chain.addGroup(current_group);<a name="line.1973"></a>
<span class="sourceLineNo">1974</span>                        }<a name="line.1974"></a>
<span class="sourceLineNo">1975</span>                        //System.out.println("starting new model "+(structure.nrModels()+1));<a name="line.1975"></a>
<span class="sourceLineNo">1976</span><a name="line.1976"></a>
<span class="sourceLineNo">1977</span>                        Chain ch = isKnownChain(current_chain.getChainID(),current_model) ;<a name="line.1977"></a>
<span class="sourceLineNo">1978</span>                        if ( ch == null ) {<a name="line.1978"></a>
<span class="sourceLineNo">1979</span>                                current_model.add(current_chain);<a name="line.1979"></a>
<span class="sourceLineNo">1980</span>                        }<a name="line.1980"></a>
<span class="sourceLineNo">1981</span>                        structure.addModel(current_model);<a name="line.1981"></a>
<span class="sourceLineNo">1982</span>                        current_model = new ArrayList&lt;Chain&gt;();<a name="line.1982"></a>
<span class="sourceLineNo">1983</span>                        current_chain = null;<a name="line.1983"></a>
<span class="sourceLineNo">1984</span>                        current_group = null;<a name="line.1984"></a>
<span class="sourceLineNo">1985</span>                }<a name="line.1985"></a>
<span class="sourceLineNo">1986</span><a name="line.1986"></a>
<span class="sourceLineNo">1987</span>        }<a name="line.1987"></a>
<span class="sourceLineNo">1988</span><a name="line.1988"></a>
<span class="sourceLineNo">1989</span><a name="line.1989"></a>
<span class="sourceLineNo">1990</span>        /**<a name="line.1990"></a>
<span class="sourceLineNo">1991</span>    COLUMNS       DATA TYPE          FIELD          DEFINITION<a name="line.1991"></a>
<span class="sourceLineNo">1992</span>    ----------------------------------------------------------------<a name="line.1992"></a>
<span class="sourceLineNo">1993</span>     1 - 6        Record name        "DBREF "<a name="line.1993"></a>
<span class="sourceLineNo">1994</span>     8 - 11       IDcode             idCode         ID code of this entry.<a name="line.1994"></a>
<span class="sourceLineNo">1995</span>    13            Character          chainID        Chain identifier.<a name="line.1995"></a>
<span class="sourceLineNo">1996</span>    15 - 18       Integer            seqBegin       Initial sequence number<a name="line.1996"></a>
<span class="sourceLineNo">1997</span>                                                    of the PDB sequence segment.<a name="line.1997"></a>
<span class="sourceLineNo">1998</span>    19            AChar              insertBegin    Initial insertion code<a name="line.1998"></a>
<span class="sourceLineNo">1999</span>                                                    of the PDB sequence segment.<a name="line.1999"></a>
<span class="sourceLineNo">2000</span>    21 - 24       Integer            seqEnd         Ending sequence number<a name="line.2000"></a>
<span class="sourceLineNo">2001</span>                                                    of the PDB sequence segment.<a name="line.2001"></a>
<span class="sourceLineNo">2002</span>    25            AChar              insertEnd      Ending insertion code<a name="line.2002"></a>
<span class="sourceLineNo">2003</span>                                                    of the PDB sequence segment.<a name="line.2003"></a>
<span class="sourceLineNo">2004</span>    27 - 32       LString            database       Sequence database name.<a name="line.2004"></a>
<span class="sourceLineNo">2005</span>    34 - 41       LString            dbAccession    Sequence database accession code.<a name="line.2005"></a>
<span class="sourceLineNo">2006</span>    43 - 54      LString            dbIdCode        Sequence database<a name="line.2006"></a>
<span class="sourceLineNo">2007</span>                                                    identification code.<a name="line.2007"></a>
<span class="sourceLineNo">2008</span>    56 - 60      Integer            dbseqBegin      Initial sequence number of the<a name="line.2008"></a>
<span class="sourceLineNo">2009</span>                                                    database seqment.<a name="line.2009"></a>
<span class="sourceLineNo">2010</span>    61           AChar              idbnsBeg        Insertion code of initial residue<a name="line.2010"></a>
<span class="sourceLineNo">2011</span>                                                    of the segment, if PDB is the<a name="line.2011"></a>
<span class="sourceLineNo">2012</span>                                                    reference.<a name="line.2012"></a>
<span class="sourceLineNo">2013</span>    63 - 67      Integer            dbseqEnd        Ending sequence number of the<a name="line.2013"></a>
<span class="sourceLineNo">2014</span>                                                    database segment.<a name="line.2014"></a>
<span class="sourceLineNo">2015</span>    68           AChar              dbinsEnd        Insertion code of the ending<a name="line.2015"></a>
<span class="sourceLineNo">2016</span>                                                    residue of the segment, if PDB is<a name="line.2016"></a>
<span class="sourceLineNo">2017</span>                                                    the reference.<a name="line.2017"></a>
<span class="sourceLineNo">2018</span>         */<a name="line.2018"></a>
<span class="sourceLineNo">2019</span>        private void pdb_DBREF_Handler(String line){<a name="line.2019"></a>
<span class="sourceLineNo">2020</span>                if (DEBUG) {<a name="line.2020"></a>
<span class="sourceLineNo">2021</span>                        logger.info("Parsing DBREF " + line);<a name="line.2021"></a>
<span class="sourceLineNo">2022</span>                }<a name="line.2022"></a>
<span class="sourceLineNo">2023</span>                DBRef dbref = new DBRef();<a name="line.2023"></a>
<span class="sourceLineNo">2024</span>                String idCode      = line.substring(7,11);<a name="line.2024"></a>
<span class="sourceLineNo">2025</span>                String chainId     = line.substring(12,13);<a name="line.2025"></a>
<span class="sourceLineNo">2026</span>                String seqBegin    = line.substring(14,18);<a name="line.2026"></a>
<span class="sourceLineNo">2027</span>                String insertBegin = line.substring(18,19);<a name="line.2027"></a>
<span class="sourceLineNo">2028</span>                String seqEnd      = line.substring(20,24);<a name="line.2028"></a>
<span class="sourceLineNo">2029</span>                String insertEnd   = line.substring(24,25);<a name="line.2029"></a>
<span class="sourceLineNo">2030</span>                String database    = line.substring(26,32);<a name="line.2030"></a>
<span class="sourceLineNo">2031</span>                String dbAccession = line.substring(33,41);<a name="line.2031"></a>
<span class="sourceLineNo">2032</span>                String dbIdCode    = line.substring(42,54);<a name="line.2032"></a>
<span class="sourceLineNo">2033</span>                String dbseqBegin  = line.substring(55,60);<a name="line.2033"></a>
<span class="sourceLineNo">2034</span>                String idbnsBeg    = line.substring(60,61);<a name="line.2034"></a>
<span class="sourceLineNo">2035</span>                String dbseqEnd    = line.substring(62,67);<a name="line.2035"></a>
<span class="sourceLineNo">2036</span>                String dbinsEnd    = line.substring(67,68);<a name="line.2036"></a>
<span class="sourceLineNo">2037</span><a name="line.2037"></a>
<span class="sourceLineNo">2038</span>                dbref.setIdCode(idCode);<a name="line.2038"></a>
<span class="sourceLineNo">2039</span>                dbref.setChainId(chainId.charAt(0));<a name="line.2039"></a>
<span class="sourceLineNo">2040</span>                dbref.setSeqBegin(intFromString(seqBegin));<a name="line.2040"></a>
<span class="sourceLineNo">2041</span>                dbref.setInsertBegin(insertBegin.charAt(0));<a name="line.2041"></a>
<span class="sourceLineNo">2042</span>                dbref.setSeqEnd(intFromString(seqEnd));<a name="line.2042"></a>
<span class="sourceLineNo">2043</span>                dbref.setInsertEnd(insertEnd.charAt(0));<a name="line.2043"></a>
<span class="sourceLineNo">2044</span>                dbref.setDatabase(database.trim());<a name="line.2044"></a>
<span class="sourceLineNo">2045</span>                dbref.setDbAccession(dbAccession.trim());<a name="line.2045"></a>
<span class="sourceLineNo">2046</span>                dbref.setDbIdCode(dbIdCode.trim());<a name="line.2046"></a>
<span class="sourceLineNo">2047</span>                dbref.setDbSeqBegin(intFromString(dbseqBegin));<a name="line.2047"></a>
<span class="sourceLineNo">2048</span>                dbref.setIdbnsBegin(idbnsBeg.charAt(0));<a name="line.2048"></a>
<span class="sourceLineNo">2049</span>                dbref.setDbSeqEnd(intFromString(dbseqEnd));<a name="line.2049"></a>
<span class="sourceLineNo">2050</span>                dbref.setIdbnsEnd(dbinsEnd.charAt(0));<a name="line.2050"></a>
<span class="sourceLineNo">2051</span><a name="line.2051"></a>
<span class="sourceLineNo">2052</span>                //System.out.println(dbref.toPDB());<a name="line.2052"></a>
<span class="sourceLineNo">2053</span>                dbrefs.add(dbref);<a name="line.2053"></a>
<span class="sourceLineNo">2054</span>        }<a name="line.2054"></a>
<span class="sourceLineNo">2055</span><a name="line.2055"></a>
<span class="sourceLineNo">2056</span>        /*<a name="line.2056"></a>
<span class="sourceLineNo">2057</span>         * For each het group that appears in the entry, the wwPDB checks that the corresponding HET, HETNAM, HETSYN, FORMUL, HETATM, and CONECT records appear, if applicable. The HET record is generated automatically using the Chemical Component Dictionary and information from the HETATM records.<a name="line.2057"></a>
<span class="sourceLineNo">2058</span><a name="line.2058"></a>
<span class="sourceLineNo">2059</span>         * Record Format<a name="line.2059"></a>
<span class="sourceLineNo">2060</span><a name="line.2060"></a>
<span class="sourceLineNo">2061</span>            COLUMNS       DATA  TYPE     FIELD         DEFINITION<a name="line.2061"></a>
<span class="sourceLineNo">2062</span>            ---------------------------------------------------------------------------------<a name="line.2062"></a>
<span class="sourceLineNo">2063</span>             1 -  6       Record name   "HET   "<a name="line.2063"></a>
<span class="sourceLineNo">2064</span>             8 - 10       LString(3)    hetID          Het identifier, right-justified.<a name="line.2064"></a>
<span class="sourceLineNo">2065</span>            13            Character     ChainID        Chain  identifier.<a name="line.2065"></a>
<span class="sourceLineNo">2066</span>            14 - 17       Integer       seqNum         Sequence  number.<a name="line.2066"></a>
<span class="sourceLineNo">2067</span>            18            AChar         iCode          Insertion  code.<a name="line.2067"></a>
<span class="sourceLineNo">2068</span>            21 - 25       Integer       numHetAtoms    Number of HETATM records for the group<a name="line.2068"></a>
<span class="sourceLineNo">2069</span>                                                       present in the entry.<a name="line.2069"></a>
<span class="sourceLineNo">2070</span>            31 - 70       String        text           Text describing Het group.<a name="line.2070"></a>
<span class="sourceLineNo">2071</span><a name="line.2071"></a>
<span class="sourceLineNo">2072</span>            Each unique hetID represents a unique molecule.<a name="line.2072"></a>
<span class="sourceLineNo">2073</span><a name="line.2073"></a>
<span class="sourceLineNo">2074</span>            Relationships to Other Record Types<a name="line.2074"></a>
<span class="sourceLineNo">2075</span><a name="line.2075"></a>
<span class="sourceLineNo">2076</span>            For each het group that appears in the entry, there must be corresponding HET, HETNAM, HETSYN, FORMUL,HETATM, and CONECT records. LINK records may also be created.<a name="line.2076"></a>
<span class="sourceLineNo">2077</span><a name="line.2077"></a>
<span class="sourceLineNo">2078</span>            Example<a name="line.2078"></a>
<span class="sourceLineNo">2079</span><a name="line.2079"></a>
<span class="sourceLineNo">2080</span>                     1         2         3         4         5         6         7         8<a name="line.2080"></a>
<span class="sourceLineNo">2081</span>            12345678901234567890123456789012345678901234567890123456789012345678901234567890<a name="line.2081"></a>
<span class="sourceLineNo">2082</span>            HET    TRS    975       8<a name="line.2082"></a>
<span class="sourceLineNo">2083</span><a name="line.2083"></a>
<span class="sourceLineNo">2084</span>            HET    UDP  A1457      25<a name="line.2084"></a>
<span class="sourceLineNo">2085</span>            HET    B3P  A1458      19<a name="line.2085"></a>
<span class="sourceLineNo">2086</span><a name="line.2086"></a>
<span class="sourceLineNo">2087</span>            HET    NAG  Y   3      15<a name="line.2087"></a>
<span class="sourceLineNo">2088</span>            HET    FUC  Y   4      10<a name="line.2088"></a>
<span class="sourceLineNo">2089</span>            HET    NON  Y   5      12<a name="line.2089"></a>
<span class="sourceLineNo">2090</span>            HET    UNK  A 161       1<a name="line.2090"></a>
<span class="sourceLineNo">2091</span><a name="line.2091"></a>
<span class="sourceLineNo">2092</span>         * Heterogen sections are HET, HETNAM, HETSYN, FORMUL<a name="line.2092"></a>
<span class="sourceLineNo">2093</span>         * @see http://www.wwpdb.org/documentation/format32/sect4.html<a name="line.2093"></a>
<span class="sourceLineNo">2094</span>         */<a name="line.2094"></a>
<span class="sourceLineNo">2095</span>        //private void pdb_HET_handler(String line) {<a name="line.2095"></a>
<span class="sourceLineNo">2096</span><a name="line.2096"></a>
<span class="sourceLineNo">2097</span>        //}<a name="line.2097"></a>
<span class="sourceLineNo">2098</span><a name="line.2098"></a>
<span class="sourceLineNo">2099</span>        /* process the disulfid bond info provided by an SSBOND record<a name="line.2099"></a>
<span class="sourceLineNo">2100</span>         *<a name="line.2100"></a>
<span class="sourceLineNo">2101</span>         *<a name="line.2101"></a>
<span class="sourceLineNo">2102</span>        COLUMNS        DATA TYPE       FIELD         DEFINITION<a name="line.2102"></a>
<span class="sourceLineNo">2103</span>        -------------------------------------------------------------------<a name="line.2103"></a>
<span class="sourceLineNo">2104</span>         1 -  6        Record name     "SSBOND"<a name="line.2104"></a>
<span class="sourceLineNo">2105</span>         8 - 10        Integer         serNum       Serial number.<a name="line.2105"></a>
<span class="sourceLineNo">2106</span>        12 - 14        LString(3)      "CYS"        Residue name.<a name="line.2106"></a>
<span class="sourceLineNo">2107</span>        16             Character       chainID1     Chain identifier.<a name="line.2107"></a>
<span class="sourceLineNo">2108</span>        18 - 21        Integer         seqNum1      Residue sequence number.<a name="line.2108"></a>
<span class="sourceLineNo">2109</span>        22             AChar           icode1       Insertion code.<a name="line.2109"></a>
<span class="sourceLineNo">2110</span>        26 - 28        LString(3)      "CYS"        Residue name.<a name="line.2110"></a>
<span class="sourceLineNo">2111</span>        30             Character       chainID2     Chain identifier.<a name="line.2111"></a>
<span class="sourceLineNo">2112</span>        32 - 35        Integer         seqNum2      Residue sequence number.<a name="line.2112"></a>
<span class="sourceLineNo">2113</span>        36             AChar           icode2       Insertion code.<a name="line.2113"></a>
<span class="sourceLineNo">2114</span>        60 - 65        SymOP           sym1         Symmetry oper for 1st resid<a name="line.2114"></a>
<span class="sourceLineNo">2115</span>        67 - 72        SymOP           sym2         Symmetry oper for 2nd resid<a name="line.2115"></a>
<span class="sourceLineNo">2116</span>         */<a name="line.2116"></a>
<span class="sourceLineNo">2117</span>        private void pdb_SSBOND_Handler(String line){<a name="line.2117"></a>
<span class="sourceLineNo">2118</span>                String chain1      = line.substring(15,16);<a name="line.2118"></a>
<span class="sourceLineNo">2119</span>                String seqNum1     = line.substring(18,21).trim();<a name="line.2119"></a>
<span class="sourceLineNo">2120</span>                String icode1      = line.substring(21,22);<a name="line.2120"></a>
<span class="sourceLineNo">2121</span>                String chain2      = line.substring(29,30);<a name="line.2121"></a>
<span class="sourceLineNo">2122</span>                String seqNum2     = line.substring(31,35).trim();<a name="line.2122"></a>
<span class="sourceLineNo">2123</span>                String icode2      = line.substring(35,36);<a name="line.2123"></a>
<span class="sourceLineNo">2124</span><a name="line.2124"></a>
<span class="sourceLineNo">2125</span>                if (icode1.equals(" "))<a name="line.2125"></a>
<span class="sourceLineNo">2126</span>                        icode1 = "";<a name="line.2126"></a>
<span class="sourceLineNo">2127</span>                if (icode2.equals(" "))<a name="line.2127"></a>
<span class="sourceLineNo">2128</span>                        icode2 = "";<a name="line.2128"></a>
<span class="sourceLineNo">2129</span><a name="line.2129"></a>
<span class="sourceLineNo">2130</span>                SSBond ssbond = new SSBond();<a name="line.2130"></a>
<span class="sourceLineNo">2131</span><a name="line.2131"></a>
<span class="sourceLineNo">2132</span>                ssbond.setChainID1(chain1);<a name="line.2132"></a>
<span class="sourceLineNo">2133</span>                ssbond.setResnum1(seqNum1);<a name="line.2133"></a>
<span class="sourceLineNo">2134</span>                ssbond.setChainID2(chain2);<a name="line.2134"></a>
<span class="sourceLineNo">2135</span>                ssbond.setResnum2(seqNum2);<a name="line.2135"></a>
<span class="sourceLineNo">2136</span>                ssbond.setInsCode1(icode1);<a name="line.2136"></a>
<span class="sourceLineNo">2137</span>                ssbond.setInsCode2(icode2);<a name="line.2137"></a>
<span class="sourceLineNo">2138</span>                structure.addSSBond(ssbond);<a name="line.2138"></a>
<span class="sourceLineNo">2139</span><a name="line.2139"></a>
<span class="sourceLineNo">2140</span><a name="line.2140"></a>
<span class="sourceLineNo">2141</span>        }<a name="line.2141"></a>
<span class="sourceLineNo">2142</span><a name="line.2142"></a>
<span class="sourceLineNo">2143</span>        /**<a name="line.2143"></a>
<span class="sourceLineNo">2144</span>         * Handler for the SITE records. &lt;br&gt;<a name="line.2144"></a>
<span class="sourceLineNo">2145</span>         *<a name="line.2145"></a>
<span class="sourceLineNo">2146</span>         * &lt;pre&gt;<a name="line.2146"></a>
<span class="sourceLineNo">2147</span>         *<a name="line.2147"></a>
<span class="sourceLineNo">2148</span>         * COLUMNS      DATA TYPE               FIELD           DEFINITION<a name="line.2148"></a>
<span class="sourceLineNo">2149</span>         * ---------------------------------------------------------------------------------<a name="line.2149"></a>
<span class="sourceLineNo">2150</span>         * 1 - 6        Record name     "SITE "<a name="line.2150"></a>
<span class="sourceLineNo">2151</span>         * 8 - 10       Integer                 seqNum          Sequence number.<a name="line.2151"></a>
<span class="sourceLineNo">2152</span>         * 12 - 14      LString(3)              siteID          Site name.<a name="line.2152"></a>
<span class="sourceLineNo">2153</span>         * 16 - 17      Integer                 numRes          Number of residues that compose the siteResidues.<a name="line.2153"></a>
<span class="sourceLineNo">2154</span>         * 19 - 21      Residue name    resName1        Residue name for first residue that<a name="line.2154"></a>
<span class="sourceLineNo">2155</span>         *                                                                              creates the siteResidues.<a name="line.2155"></a>
<span class="sourceLineNo">2156</span>         * 23           Character               chainID1        Chain identifier for first residue of siteResidues.<a name="line.2156"></a>
<span class="sourceLineNo">2157</span>         * 24 - 27      Integer                 seq1            Residue sequence number for first residue<a name="line.2157"></a>
<span class="sourceLineNo">2158</span>         *                                                                              of the siteResidues.<a name="line.2158"></a>
<span class="sourceLineNo">2159</span>         * 28           AChar                   iCode1          Insertion code for first residue of the siteResidues.<a name="line.2159"></a>
<span class="sourceLineNo">2160</span>         *<a name="line.2160"></a>
<span class="sourceLineNo">2161</span>         * example:<a name="line.2161"></a>
<span class="sourceLineNo">2162</span>         *          1         2         3         4         5         6         7         8<a name="line.2162"></a>
<span class="sourceLineNo">2163</span>         * 12345678901234567890123456789012345678901234567890123456789012345678901234567890<a name="line.2163"></a>
<span class="sourceLineNo">2164</span>         * SITE     1 AC1  3 HIS A  94 HIS A   96  HIS A 119<a name="line.2164"></a>
<span class="sourceLineNo">2165</span>         * SITE     1 AC2  5 ASN A  62 GLY A   63  HIS A  64  HOH A 328<a name="line.2165"></a>
<span class="sourceLineNo">2166</span>         * SITE     2 AC2  5 HOH A 634<a name="line.2166"></a>
<span class="sourceLineNo">2167</span>         * SITE     1 AC3  5 GLN A 136 GLN A  137  PRO A 138  GLU A 205<a name="line.2167"></a>
<span class="sourceLineNo">2168</span>         * SITE     2 AC3  5 CYS A 206<a name="line.2168"></a>
<span class="sourceLineNo">2169</span>         * SITE     1 AC4 11 HIS A  64 HIS A   94  HIS A  96  HIS A 119<a name="line.2169"></a>
<span class="sourceLineNo">2170</span>         * SITE     2 AC4 11 LEU A 198 THR A  199  THR A 200  TRP A 209<a name="line.2170"></a>
<span class="sourceLineNo">2171</span>         * SITE     3 AC4 11 HOH A 572 HOH A  582  HOH A 635<a name="line.2171"></a>
<span class="sourceLineNo">2172</span>         * &lt;/pre&gt;<a name="line.2172"></a>
<span class="sourceLineNo">2173</span>         * @param line the SITE line record being currently read<a name="line.2173"></a>
<span class="sourceLineNo">2174</span>         * @author Amr AL-Hossary<a name="line.2174"></a>
<span class="sourceLineNo">2175</span>         * @author Jules Jacobsen<a name="line.2175"></a>
<span class="sourceLineNo">2176</span>         */<a name="line.2176"></a>
<span class="sourceLineNo">2177</span>        private void pdb_SITE_Handler(String line){<a name="line.2177"></a>
<span class="sourceLineNo">2178</span>                boolean siteDebug = false;<a name="line.2178"></a>
<span class="sourceLineNo">2179</span><a name="line.2179"></a>
<span class="sourceLineNo">2180</span>                //  make a map of: SiteId to List&lt;ResidueNumber&gt;<a name="line.2180"></a>
<span class="sourceLineNo">2181</span>                if (DEBUG || siteDebug) {<a name="line.2181"></a>
<span class="sourceLineNo">2182</span>                        System.out.println("Site Line:"+line);<a name="line.2182"></a>
<span class="sourceLineNo">2183</span>                }<a name="line.2183"></a>
<span class="sourceLineNo">2184</span><a name="line.2184"></a>
<span class="sourceLineNo">2185</span>                String siteID = line.substring(11, 14);<a name="line.2185"></a>
<span class="sourceLineNo">2186</span>                //fetch the siteResidues from the map<a name="line.2186"></a>
<span class="sourceLineNo">2187</span>                List&lt;ResidueNumber&gt; siteResidues = siteToResidueMap.get(siteID);<a name="line.2187"></a>
<span class="sourceLineNo">2188</span><a name="line.2188"></a>
<span class="sourceLineNo">2189</span>                //if the siteResidues doesn't yet exist, make a new one.<a name="line.2189"></a>
<span class="sourceLineNo">2190</span>                if (siteResidues == null |! siteToResidueMap.containsKey(siteID.trim())){<a name="line.2190"></a>
<span class="sourceLineNo">2191</span>                        siteResidues = new ArrayList&lt;ResidueNumber&gt;();<a name="line.2191"></a>
<span class="sourceLineNo">2192</span>                        siteToResidueMap.put(siteID.trim(), siteResidues);<a name="line.2192"></a>
<span class="sourceLineNo">2193</span>                        if (DEBUG || siteDebug) {<a name="line.2193"></a>
<span class="sourceLineNo">2194</span>                                System.out.println(String.format("New Site made: %s %s", siteID,  siteResidues));<a name="line.2194"></a>
<span class="sourceLineNo">2195</span>                                System.out.println("Now made " + siteMap.size() + " sites");<a name="line.2195"></a>
<span class="sourceLineNo">2196</span>                        }<a name="line.2196"></a>
<span class="sourceLineNo">2197</span>                }<a name="line.2197"></a>
<span class="sourceLineNo">2198</span><a name="line.2198"></a>
<span class="sourceLineNo">2199</span>                if (DEBUG || siteDebug) {<a name="line.2199"></a>
<span class="sourceLineNo">2200</span>                        System.out.println(String.format("SiteId: %s", siteID));<a name="line.2200"></a>
<span class="sourceLineNo">2201</span>                }<a name="line.2201"></a>
<span class="sourceLineNo">2202</span><a name="line.2202"></a>
<span class="sourceLineNo">2203</span>                //line = 'SITE     1 AC1  6 ARG H 221A LYS H 224  HOH H 403  HOH H 460'<a name="line.2203"></a>
<span class="sourceLineNo">2204</span>                //line.substring(18) = 'ARG H 221A LYS H 224  HOH H 403  HOH H 460'<a name="line.2204"></a>
<span class="sourceLineNo">2205</span>                line = line.substring(18);<a name="line.2205"></a>
<span class="sourceLineNo">2206</span>                String groupString = null;<a name="line.2206"></a>
<span class="sourceLineNo">2207</span>                //groupString = 'ARG H 221A'<a name="line.2207"></a>
<span class="sourceLineNo">2208</span>                //keep iterating through chunks of 10 characters - these are the groups in the siteResidues<a name="line.2208"></a>
<span class="sourceLineNo">2209</span>                while (!(groupString = line.substring(0, 10)).equals("          ")) {<a name="line.2209"></a>
<span class="sourceLineNo">2210</span>                        //groupstring: 'ARG H 221A'<a name="line.2210"></a>
<span class="sourceLineNo">2211</span>                        if (DEBUG || siteDebug) {<a name="line.2211"></a>
<span class="sourceLineNo">2212</span>                                System.out.println("groupString: '" + groupString + "'");<a name="line.2212"></a>
<span class="sourceLineNo">2213</span>                        }<a name="line.2213"></a>
<span class="sourceLineNo">2214</span>                        //set the residue name<a name="line.2214"></a>
<span class="sourceLineNo">2215</span>                        //residueName = 'ARG'<a name="line.2215"></a>
<span class="sourceLineNo">2216</span>                        String residueName = groupString.substring(0, 3);<a name="line.2216"></a>
<span class="sourceLineNo">2217</span>                        Character aminoCode1 = StructureTools.get1LetterCode(residueName);<a name="line.2217"></a>
<span class="sourceLineNo">2218</span>                        if (aminoCode1 != null) {<a name="line.2218"></a>
<span class="sourceLineNo">2219</span>                                if (aminoCode1.equals(StructureTools.UNKNOWN_GROUP_LABEL)) {<a name="line.2219"></a>
<span class="sourceLineNo">2220</span>                                        aminoCode1 = null;<a name="line.2220"></a>
<span class="sourceLineNo">2221</span>                                }<a name="line.2221"></a>
<span class="sourceLineNo">2222</span>                        }<a name="line.2222"></a>
<span class="sourceLineNo">2223</span><a name="line.2223"></a>
<span class="sourceLineNo">2224</span>                        //this is already in the right format, so no need to fiddle with it...<a name="line.2224"></a>
<span class="sourceLineNo">2225</span>                        //pdbCode = 'H 221A'<a name="line.2225"></a>
<span class="sourceLineNo">2226</span>                        //                    String pdbCode = groupString.substring(4, 10).trim();<a name="line.2226"></a>
<span class="sourceLineNo">2227</span>                        String chainId = groupString.substring(4, 5);<a name="line.2227"></a>
<span class="sourceLineNo">2228</span>                        Integer resNum = Integer.valueOf(groupString.substring(5, 9).trim());<a name="line.2228"></a>
<span class="sourceLineNo">2229</span>                        Character insCode = groupString.substring(9, 10).charAt(0);<a name="line.2229"></a>
<span class="sourceLineNo">2230</span>                        //set insCode to null as a measure to prevent storing thousands of empty Strings<a name="line.2230"></a>
<span class="sourceLineNo">2231</span>                        //- the empty value is returned using Group.getInsCode() <a name="line.2231"></a>
<span class="sourceLineNo">2232</span>                        //                    if (insCode.equals(" ")) {<a name="line.2232"></a>
<span class="sourceLineNo">2233</span>                        //                        insCode = null;<a name="line.2233"></a>
<span class="sourceLineNo">2234</span>                        //                    }<a name="line.2234"></a>
<span class="sourceLineNo">2235</span>                        if (DEBUG || siteDebug) {<a name="line.2235"></a>
<span class="sourceLineNo">2236</span>                                System.out.println(String.format("Site: %s: 'resName:%s resNum:%s insCode:%s'", siteID, residueName, resNum, insCode));<a name="line.2236"></a>
<span class="sourceLineNo">2237</span>                        }<a name="line.2237"></a>
<span class="sourceLineNo">2238</span>                        //make a new resNum with the data - this will be linked up with a site later<a name="line.2238"></a>
<span class="sourceLineNo">2239</span>                        ResidueNumber residueNumber = new ResidueNumber();<a name="line.2239"></a>
<span class="sourceLineNo">2240</span><a name="line.2240"></a>
<span class="sourceLineNo">2241</span>                        if (DEBUG || siteDebug) {<a name="line.2241"></a>
<span class="sourceLineNo">2242</span>                                System.out.println("pdbCode: '" + resNum + insCode + "'");<a name="line.2242"></a>
<span class="sourceLineNo">2243</span>                        }<a name="line.2243"></a>
<span class="sourceLineNo">2244</span>                        residueNumber.setChainId(chainId);<a name="line.2244"></a>
<span class="sourceLineNo">2245</span>                        residueNumber.setSeqNum(resNum);<a name="line.2245"></a>
<span class="sourceLineNo">2246</span>                        residueNumber.setInsCode(insCode);<a name="line.2246"></a>
<span class="sourceLineNo">2247</span>                        //add the resNum to the groups<a name="line.2247"></a>
<span class="sourceLineNo">2248</span>                        siteResidues.add(residueNumber);<a name="line.2248"></a>
<span class="sourceLineNo">2249</span>                        if (DEBUG || siteDebug) {<a name="line.2249"></a>
<span class="sourceLineNo">2250</span>                                System.out.println("Adding residueNumber " + residueNumber + " to site " + siteID);<a name="line.2250"></a>
<span class="sourceLineNo">2251</span>                        }<a name="line.2251"></a>
<span class="sourceLineNo">2252</span>                        line = line.substring(11);<a name="line.2252"></a>
<span class="sourceLineNo">2253</span>                }<a name="line.2253"></a>
<span class="sourceLineNo">2254</span>                if (DEBUG || siteDebug) {<a name="line.2254"></a>
<span class="sourceLineNo">2255</span>                        System.out.println("Current SiteMap (contains "+ siteToResidueMap.keySet().size() + " sites):");<a name="line.2255"></a>
<span class="sourceLineNo">2256</span>                        for (String key : siteToResidueMap.keySet()) {<a name="line.2256"></a>
<span class="sourceLineNo">2257</span>                                System.out.println(key + " : " + siteToResidueMap.get(key));<a name="line.2257"></a>
<span class="sourceLineNo">2258</span>                        }<a name="line.2258"></a>
<span class="sourceLineNo">2259</span>                }<a name="line.2259"></a>
<span class="sourceLineNo">2260</span>        }<a name="line.2260"></a>
<span class="sourceLineNo">2261</span><a name="line.2261"></a>
<span class="sourceLineNo">2262</span>        //Site variable related to parsing the REMARK 800 records.<a name="line.2262"></a>
<span class="sourceLineNo">2263</span>        Site site;<a name="line.2263"></a>
<span class="sourceLineNo">2264</span>        private void pdb_REMARK_800_Handler(String line){<a name="line.2264"></a>
<span class="sourceLineNo">2265</span>                boolean remark800debug = false;<a name="line.2265"></a>
<span class="sourceLineNo">2266</span>                if (DEBUG || remark800debug) {<a name="line.2266"></a>
<span class="sourceLineNo">2267</span>                        //                System.out.println("Handling line: " + line);<a name="line.2267"></a>
<span class="sourceLineNo">2268</span>                }<a name="line.2268"></a>
<span class="sourceLineNo">2269</span>                // 'REMARK 800 SITE_IDENTIFIER: CAT                                                 '<a name="line.2269"></a>
<span class="sourceLineNo">2270</span>                line = line.substring(11);<a name="line.2270"></a>
<span class="sourceLineNo">2271</span>                String[] fields = line.split(": ");<a name="line.2271"></a>
<span class="sourceLineNo">2272</span><a name="line.2272"></a>
<span class="sourceLineNo">2273</span>                if (fields.length == 2) {<a name="line.2273"></a>
<span class="sourceLineNo">2274</span>                        if (fields[0].equals("SITE_IDENTIFIER")) {<a name="line.2274"></a>
<span class="sourceLineNo">2275</span>                                //                    remark800Counter++;<a name="line.2275"></a>
<span class="sourceLineNo">2276</span>                                String siteID = fields[1].trim();<a name="line.2276"></a>
<span class="sourceLineNo">2277</span>                                if (DEBUG || remark800debug) {<a name="line.2277"></a>
<span class="sourceLineNo">2278</span>                                        System.out.println("siteID: '" + siteID +"'");<a name="line.2278"></a>
<span class="sourceLineNo">2279</span>                                }<a name="line.2279"></a>
<span class="sourceLineNo">2280</span>                                //fetch the siteResidues from the map<a name="line.2280"></a>
<span class="sourceLineNo">2281</span>                                site = siteMap.get(siteID);<a name="line.2281"></a>
<span class="sourceLineNo">2282</span><a name="line.2282"></a>
<span class="sourceLineNo">2283</span>                                //if the siteResidues doesn't yet exist, make a new one.<a name="line.2283"></a>
<span class="sourceLineNo">2284</span>                                if (site == null || !siteID.equals(site.getSiteID())) {<a name="line.2284"></a>
<span class="sourceLineNo">2285</span>                                        site = new Site(siteID, new ArrayList&lt;Group&gt;());<a name="line.2285"></a>
<span class="sourceLineNo">2286</span>                                        siteMap.put(site.getSiteID(), site);<a name="line.2286"></a>
<span class="sourceLineNo">2287</span>                                        if (DEBUG || remark800debug) {<a name="line.2287"></a>
<span class="sourceLineNo">2288</span>                                                System.out.print("New Site made: " + site);<a name="line.2288"></a>
<span class="sourceLineNo">2289</span>                                                System.out.println("Now made " + siteMap.size() + " sites");<a name="line.2289"></a>
<span class="sourceLineNo">2290</span>                                        }<a name="line.2290"></a>
<span class="sourceLineNo">2291</span>                                }<a name="line.2291"></a>
<span class="sourceLineNo">2292</span>                        }<a name="line.2292"></a>
<span class="sourceLineNo">2293</span>                        if (fields[0].equals("EVIDENCE_CODE")) {<a name="line.2293"></a>
<span class="sourceLineNo">2294</span>                                //                    remark800Counter++;<a name="line.2294"></a>
<span class="sourceLineNo">2295</span>                                String evCode = fields[1].trim();<a name="line.2295"></a>
<span class="sourceLineNo">2296</span>                                if (DEBUG || remark800debug) {<a name="line.2296"></a>
<span class="sourceLineNo">2297</span>                                        System.out.println("evCode: '" + evCode +"'");<a name="line.2297"></a>
<span class="sourceLineNo">2298</span>                                }<a name="line.2298"></a>
<span class="sourceLineNo">2299</span>                                //fetch the siteResidues from the map<a name="line.2299"></a>
<span class="sourceLineNo">2300</span>                                site.setEvCode(evCode);<a name="line.2300"></a>
<span class="sourceLineNo">2301</span>                        }<a name="line.2301"></a>
<span class="sourceLineNo">2302</span>                        if (fields[0].equals("SITE_DESCRIPTION")) {<a name="line.2302"></a>
<span class="sourceLineNo">2303</span>                                //                    remark800Counter++;<a name="line.2303"></a>
<span class="sourceLineNo">2304</span>                                String desc = fields[1].trim();<a name="line.2304"></a>
<span class="sourceLineNo">2305</span>                                if (DEBUG || remark800debug) {<a name="line.2305"></a>
<span class="sourceLineNo">2306</span>                                        System.out.println("desc: '" + desc +"'");<a name="line.2306"></a>
<span class="sourceLineNo">2307</span>                                }<a name="line.2307"></a>
<span class="sourceLineNo">2308</span>                                //fetch the siteResidues from the map<a name="line.2308"></a>
<span class="sourceLineNo">2309</span>                                site.setDescription(desc);<a name="line.2309"></a>
<span class="sourceLineNo">2310</span>                                if (DEBUG || remark800debug) {<a name="line.2310"></a>
<span class="sourceLineNo">2311</span>                                        System.out.println("Finished making REMARK 800 for site " + site.getSiteID());<a name="line.2311"></a>
<span class="sourceLineNo">2312</span>                                        System.out.print(site.remark800toPDB());<a name="line.2312"></a>
<span class="sourceLineNo">2313</span>                                }<a name="line.2313"></a>
<span class="sourceLineNo">2314</span>                        }<a name="line.2314"></a>
<span class="sourceLineNo">2315</span>                }<a name="line.2315"></a>
<span class="sourceLineNo">2316</span>        }<a name="line.2316"></a>
<span class="sourceLineNo">2317</span><a name="line.2317"></a>
<span class="sourceLineNo">2318</span>        private int intFromString(String intString){<a name="line.2318"></a>
<span class="sourceLineNo">2319</span>                int val = Integer.MIN_VALUE;<a name="line.2319"></a>
<span class="sourceLineNo">2320</span>                try {<a name="line.2320"></a>
<span class="sourceLineNo">2321</span>                        val = Integer.parseInt(intString.trim());<a name="line.2321"></a>
<span class="sourceLineNo">2322</span>                } catch (NumberFormatException ex){<a name="line.2322"></a>
<span class="sourceLineNo">2323</span>                        //ex.printStackTrace();<a name="line.2323"></a>
<span class="sourceLineNo">2324</span>                        logger.fine("NumberformatException: " + ex.getMessage());<a name="line.2324"></a>
<span class="sourceLineNo">2325</span>                }<a name="line.2325"></a>
<span class="sourceLineNo">2326</span>                return val;<a name="line.2326"></a>
<span class="sourceLineNo">2327</span>        }<a name="line.2327"></a>
<span class="sourceLineNo">2328</span><a name="line.2328"></a>
<span class="sourceLineNo">2329</span><a name="line.2329"></a>
<span class="sourceLineNo">2330</span><a name="line.2330"></a>
<span class="sourceLineNo">2331</span>        /** test if the chain is already known (is in current_model<a name="line.2331"></a>
<span class="sourceLineNo">2332</span>         * ArrayList) and if yes, returns the chain<a name="line.2332"></a>
<span class="sourceLineNo">2333</span>         * if no -&gt; returns null<a name="line.2333"></a>
<span class="sourceLineNo">2334</span>         */<a name="line.2334"></a>
<span class="sourceLineNo">2335</span>        private Chain isKnownChain(String chainID, List&lt;Chain&gt; chains){<a name="line.2335"></a>
<span class="sourceLineNo">2336</span><a name="line.2336"></a>
<span class="sourceLineNo">2337</span>                for (int i = 0; i&lt; chains.size();i++){<a name="line.2337"></a>
<span class="sourceLineNo">2338</span>                        Chain testchain =  chains.get(i);<a name="line.2338"></a>
<span class="sourceLineNo">2339</span>                        //System.out.println("comparing chainID &gt;"+chainID+"&lt; against testchain " + i+" &gt;" +testchain.getName()+"&lt;");<a name="line.2339"></a>
<span class="sourceLineNo">2340</span>                        if (chainID.equals(testchain.getChainID())) {<a name="line.2340"></a>
<span class="sourceLineNo">2341</span>                                //System.out.println("chain "+ chainID+" already known ...");<a name="line.2341"></a>
<span class="sourceLineNo">2342</span>                                return testchain;<a name="line.2342"></a>
<span class="sourceLineNo">2343</span>                        }<a name="line.2343"></a>
<span class="sourceLineNo">2344</span>                }<a name="line.2344"></a>
<span class="sourceLineNo">2345</span><a name="line.2345"></a>
<span class="sourceLineNo">2346</span>                return null;<a name="line.2346"></a>
<span class="sourceLineNo">2347</span>        }<a name="line.2347"></a>
<span class="sourceLineNo">2348</span><a name="line.2348"></a>
<span class="sourceLineNo">2349</span><a name="line.2349"></a>
<span class="sourceLineNo">2350</span><a name="line.2350"></a>
<span class="sourceLineNo">2351</span>        private BufferedReader getBufferedReader(InputStream inStream)<a name="line.2351"></a>
<span class="sourceLineNo">2352</span>        throws IOException {<a name="line.2352"></a>
<span class="sourceLineNo">2353</span><a name="line.2353"></a>
<span class="sourceLineNo">2354</span>                BufferedReader buf ;<a name="line.2354"></a>
<span class="sourceLineNo">2355</span>                if (inStream == null) {<a name="line.2355"></a>
<span class="sourceLineNo">2356</span>                        throw new IOException ("input stream is null!");<a name="line.2356"></a>
<span class="sourceLineNo">2357</span>                }<a name="line.2357"></a>
<span class="sourceLineNo">2358</span><a name="line.2358"></a>
<span class="sourceLineNo">2359</span>                buf = new BufferedReader (new InputStreamReader (inStream));<a name="line.2359"></a>
<span class="sourceLineNo">2360</span>                return buf ;<a name="line.2360"></a>
<span class="sourceLineNo">2361</span><a name="line.2361"></a>
<span class="sourceLineNo">2362</span>        }<a name="line.2362"></a>
<span class="sourceLineNo">2363</span><a name="line.2363"></a>
<span class="sourceLineNo">2364</span><a name="line.2364"></a>
<span class="sourceLineNo">2365</span><a name="line.2365"></a>
<span class="sourceLineNo">2366</span>        /** parse a PDB file and return a datastructure implementing<a name="line.2366"></a>
<span class="sourceLineNo">2367</span>         * PDBStructure interface.<a name="line.2367"></a>
<span class="sourceLineNo">2368</span>         *<a name="line.2368"></a>
<span class="sourceLineNo">2369</span>         * @param inStream  an InputStream object<a name="line.2369"></a>
<span class="sourceLineNo">2370</span>         * @return a Structure object<a name="line.2370"></a>
<span class="sourceLineNo">2371</span>         * @throws IOException<a name="line.2371"></a>
<span class="sourceLineNo">2372</span>         */<a name="line.2372"></a>
<span class="sourceLineNo">2373</span>        public Structure parsePDBFile(InputStream inStream)<a name="line.2373"></a>
<span class="sourceLineNo">2374</span>        throws IOException<a name="line.2374"></a>
<span class="sourceLineNo">2375</span>        {<a name="line.2375"></a>
<span class="sourceLineNo">2376</span><a name="line.2376"></a>
<span class="sourceLineNo">2377</span>                //System.out.println("preparing buffer");<a name="line.2377"></a>
<span class="sourceLineNo">2378</span>                BufferedReader buf ;<a name="line.2378"></a>
<span class="sourceLineNo">2379</span>                try {<a name="line.2379"></a>
<span class="sourceLineNo">2380</span>                        buf = getBufferedReader(inStream);<a name="line.2380"></a>
<span class="sourceLineNo">2381</span><a name="line.2381"></a>
<span class="sourceLineNo">2382</span>                } catch (IOException e) {<a name="line.2382"></a>
<span class="sourceLineNo">2383</span>                        e.printStackTrace();<a name="line.2383"></a>
<span class="sourceLineNo">2384</span>                        throw new IOException ("error initializing BufferedReader");<a name="line.2384"></a>
<span class="sourceLineNo">2385</span>                }<a name="line.2385"></a>
<span class="sourceLineNo">2386</span>                //System.out.println("done");<a name="line.2386"></a>
<span class="sourceLineNo">2387</span><a name="line.2387"></a>
<span class="sourceLineNo">2388</span>                return parsePDBFile(buf);<a name="line.2388"></a>
<span class="sourceLineNo">2389</span><a name="line.2389"></a>
<span class="sourceLineNo">2390</span>        }<a name="line.2390"></a>
<span class="sourceLineNo">2391</span><a name="line.2391"></a>
<span class="sourceLineNo">2392</span>        /** parse a PDB file and return a datastructure implementing<a name="line.2392"></a>
<span class="sourceLineNo">2393</span>         * PDBStructure interface.<a name="line.2393"></a>
<span class="sourceLineNo">2394</span>         *<a name="line.2394"></a>
<span class="sourceLineNo">2395</span>         * @param buf  a BufferedReader object<a name="line.2395"></a>
<span class="sourceLineNo">2396</span>         * @return the Structure object<a name="line.2396"></a>
<span class="sourceLineNo">2397</span>         * @throws IOException ...<a name="line.2397"></a>
<span class="sourceLineNo">2398</span>         */<a name="line.2398"></a>
<span class="sourceLineNo">2399</span><a name="line.2399"></a>
<span class="sourceLineNo">2400</span>        public  Structure parsePDBFile(BufferedReader buf)<a name="line.2400"></a>
<span class="sourceLineNo">2401</span>        throws IOException<a name="line.2401"></a>
<span class="sourceLineNo">2402</span>        {<a name="line.2402"></a>
<span class="sourceLineNo">2403</span>                // (re)set structure<a name="line.2403"></a>
<span class="sourceLineNo">2404</span><a name="line.2404"></a>
<span class="sourceLineNo">2405</span>                structure     = new StructureImpl() ;<a name="line.2405"></a>
<span class="sourceLineNo">2406</span>                current_model = new ArrayList&lt;Chain&gt;();<a name="line.2406"></a>
<span class="sourceLineNo">2407</span>                seqResChains  = new ArrayList&lt;Chain&gt;();<a name="line.2407"></a>
<span class="sourceLineNo">2408</span>                siteMap = new LinkedHashMap&lt;String, Site&gt;();<a name="line.2408"></a>
<span class="sourceLineNo">2409</span>                current_chain = null           ;<a name="line.2409"></a>
<span class="sourceLineNo">2410</span>                current_group = null           ;<a name="line.2410"></a>
<span class="sourceLineNo">2411</span>                header        = init_header();<a name="line.2411"></a>
<span class="sourceLineNo">2412</span>                pdbHeader     = new PDBHeader();<a name="line.2412"></a>
<span class="sourceLineNo">2413</span>                connects      = new ArrayList&lt;Map&lt;String,Integer&gt;&gt;();<a name="line.2413"></a>
<span class="sourceLineNo">2414</span>                continuationField = "";<a name="line.2414"></a>
<span class="sourceLineNo">2415</span>                continuationString = "";<a name="line.2415"></a>
<span class="sourceLineNo">2416</span>                current_compound = new Compound();<a name="line.2416"></a>
<span class="sourceLineNo">2417</span>                sourceLines.clear();<a name="line.2417"></a>
<span class="sourceLineNo">2418</span>                compndLines.clear();<a name="line.2418"></a>
<span class="sourceLineNo">2419</span>                isLastCompndLine = false;<a name="line.2419"></a>
<span class="sourceLineNo">2420</span>                isLastSourceLine = false;<a name="line.2420"></a>
<span class="sourceLineNo">2421</span>                molTypeCounter = 1;<a name="line.2421"></a>
<span class="sourceLineNo">2422</span>                compounds.clear();<a name="line.2422"></a>
<span class="sourceLineNo">2423</span>                helixList.clear();<a name="line.2423"></a>
<span class="sourceLineNo">2424</span>                strandList.clear();<a name="line.2424"></a>
<span class="sourceLineNo">2425</span>                turnList.clear();<a name="line.2425"></a>
<span class="sourceLineNo">2426</span>                lengthCheck = -1;<a name="line.2426"></a>
<span class="sourceLineNo">2427</span>                atomCount = 0;<a name="line.2427"></a>
<span class="sourceLineNo">2428</span>                atomOverflow = false;<a name="line.2428"></a>
<span class="sourceLineNo">2429</span><a name="line.2429"></a>
<span class="sourceLineNo">2430</span>                parseCAonly = params.isParseCAOnly();<a name="line.2430"></a>
<span class="sourceLineNo">2431</span><a name="line.2431"></a>
<span class="sourceLineNo">2432</span>                String line = null;<a name="line.2432"></a>
<span class="sourceLineNo">2433</span>                try {<a name="line.2433"></a>
<span class="sourceLineNo">2434</span><a name="line.2434"></a>
<span class="sourceLineNo">2435</span>                        line = buf.readLine ();<a name="line.2435"></a>
<span class="sourceLineNo">2436</span>                        String recordName = "";<a name="line.2436"></a>
<span class="sourceLineNo">2437</span><a name="line.2437"></a>
<span class="sourceLineNo">2438</span>                        // if line is null already for the first time, the buffered Reader had a problem<a name="line.2438"></a>
<span class="sourceLineNo">2439</span>                        if ( line == null ) {<a name="line.2439"></a>
<span class="sourceLineNo">2440</span>                                throw new IOException ("could not parse PDB File, BufferedReader returns null!");<a name="line.2440"></a>
<span class="sourceLineNo">2441</span>                        }<a name="line.2441"></a>
<span class="sourceLineNo">2442</span><a name="line.2442"></a>
<span class="sourceLineNo">2443</span><a name="line.2443"></a>
<span class="sourceLineNo">2444</span><a name="line.2444"></a>
<span class="sourceLineNo">2445</span>                        while (line != null) {<a name="line.2445"></a>
<span class="sourceLineNo">2446</span><a name="line.2446"></a>
<span class="sourceLineNo">2447</span>                                // System.out.println ("&gt;"+line+"&lt;");<a name="line.2447"></a>
<span class="sourceLineNo">2448</span><a name="line.2448"></a>
<span class="sourceLineNo">2449</span>                                // ignore empty lines<a name="line.2449"></a>
<span class="sourceLineNo">2450</span>                                if ( line.equals("") ||<a name="line.2450"></a>
<span class="sourceLineNo">2451</span>                                                (line.equals(NEWLINE))){<a name="line.2451"></a>
<span class="sourceLineNo">2452</span><a name="line.2452"></a>
<span class="sourceLineNo">2453</span>                                        line = buf.readLine ();<a name="line.2453"></a>
<span class="sourceLineNo">2454</span>                                        continue;<a name="line.2454"></a>
<span class="sourceLineNo">2455</span>                                }<a name="line.2455"></a>
<span class="sourceLineNo">2456</span><a name="line.2456"></a>
<span class="sourceLineNo">2457</span><a name="line.2457"></a>
<span class="sourceLineNo">2458</span>                                // ignore short TER and END lines<a name="line.2458"></a>
<span class="sourceLineNo">2459</span>                                if ( (line.startsWith("TER")) ||<a name="line.2459"></a>
<span class="sourceLineNo">2460</span>                                                (line.startsWith("END"))) {<a name="line.2460"></a>
<span class="sourceLineNo">2461</span><a name="line.2461"></a>
<span class="sourceLineNo">2462</span>                                        line = buf.readLine ();<a name="line.2462"></a>
<span class="sourceLineNo">2463</span>                                        continue;<a name="line.2463"></a>
<span class="sourceLineNo">2464</span>                                }<a name="line.2464"></a>
<span class="sourceLineNo">2465</span><a name="line.2465"></a>
<span class="sourceLineNo">2466</span>                                if ( line.length() &lt; 6) {<a name="line.2466"></a>
<span class="sourceLineNo">2467</span>                                        System.err.println("found line length &lt; 6. ignoring it. &gt;" + line +"&lt;" );<a name="line.2467"></a>
<span class="sourceLineNo">2468</span>                                        line = buf.readLine ();<a name="line.2468"></a>
<span class="sourceLineNo">2469</span>                                        continue;<a name="line.2469"></a>
<span class="sourceLineNo">2470</span>                                }<a name="line.2470"></a>
<span class="sourceLineNo">2471</span><a name="line.2471"></a>
<span class="sourceLineNo">2472</span>                                try {<a name="line.2472"></a>
<span class="sourceLineNo">2473</span>                                        recordName = line.substring (0, 6).trim ();<a name="line.2473"></a>
<span class="sourceLineNo">2474</span><a name="line.2474"></a>
<span class="sourceLineNo">2475</span>                                } catch (StringIndexOutOfBoundsException e){<a name="line.2475"></a>
<span class="sourceLineNo">2476</span><a name="line.2476"></a>
<span class="sourceLineNo">2477</span>                                        System.err.println("StringIndexOutOfBoundsException at line &gt;" + line + "&lt;" + NEWLINE +<a name="line.2477"></a>
<span class="sourceLineNo">2478</span>                                        "this does not look like an expected PDB file") ;<a name="line.2478"></a>
<span class="sourceLineNo">2479</span>                                        e.printStackTrace();<a name="line.2479"></a>
<span class="sourceLineNo">2480</span>                                        throw new StringIndexOutOfBoundsException(e.getMessage());<a name="line.2480"></a>
<span class="sourceLineNo">2481</span><a name="line.2481"></a>
<span class="sourceLineNo">2482</span>                                }<a name="line.2482"></a>
<span class="sourceLineNo">2483</span><a name="line.2483"></a>
<span class="sourceLineNo">2484</span>                                //System.out.println(recordName);<a name="line.2484"></a>
<span class="sourceLineNo">2485</span><a name="line.2485"></a>
<span class="sourceLineNo">2486</span>                                try {<a name="line.2486"></a>
<span class="sourceLineNo">2487</span>                                        if (recordName.equals("ATOM"))<a name="line.2487"></a>
<span class="sourceLineNo">2488</span>                                                pdb_ATOM_Handler(line);<a name="line.2488"></a>
<span class="sourceLineNo">2489</span>                                        else if (recordName.equals("SEQRES"))<a name="line.2489"></a>
<span class="sourceLineNo">2490</span>                                                pdb_SEQRES_Handler(line);<a name="line.2490"></a>
<span class="sourceLineNo">2491</span>                                        else if (recordName.equals("HETATM"))<a name="line.2491"></a>
<span class="sourceLineNo">2492</span>                                                pdb_ATOM_Handler(line);<a name="line.2492"></a>
<span class="sourceLineNo">2493</span>                                        else if (recordName.equals("MODEL"))<a name="line.2493"></a>
<span class="sourceLineNo">2494</span>                                                pdb_MODEL_Handler(line);<a name="line.2494"></a>
<span class="sourceLineNo">2495</span>                                        else if (recordName.equals("HEADER"))<a name="line.2495"></a>
<span class="sourceLineNo">2496</span>                                                pdb_HEADER_Handler(line);<a name="line.2496"></a>
<span class="sourceLineNo">2497</span>                                        else if (recordName.equals("AUTHOR"))<a name="line.2497"></a>
<span class="sourceLineNo">2498</span>                                                pdb_AUTHOR_Handler(line);<a name="line.2498"></a>
<span class="sourceLineNo">2499</span>                                        else if (recordName.equals("TITLE"))<a name="line.2499"></a>
<span class="sourceLineNo">2500</span>                                                pdb_TITLE_Handler(line);<a name="line.2500"></a>
<span class="sourceLineNo">2501</span>                                        else if (recordName.equals("SOURCE"))<a name="line.2501"></a>
<span class="sourceLineNo">2502</span>                                                sourceLines.add(line); //pdb_SOURCE_Handler<a name="line.2502"></a>
<span class="sourceLineNo">2503</span>                                        else if (recordName.equals("COMPND"))<a name="line.2503"></a>
<span class="sourceLineNo">2504</span>                                                compndLines.add(line); //pdb_COMPND_Handler<a name="line.2504"></a>
<span class="sourceLineNo">2505</span>                                        else if (recordName.equals("JRNL"))<a name="line.2505"></a>
<span class="sourceLineNo">2506</span>                                                pdb_JRNL_Handler(line);<a name="line.2506"></a>
<span class="sourceLineNo">2507</span>                                        else if (recordName.equals("EXPDTA"))<a name="line.2507"></a>
<span class="sourceLineNo">2508</span>                                                pdb_EXPDTA_Handler(line);<a name="line.2508"></a>
<span class="sourceLineNo">2509</span>                                        else if (recordName.equals("REMARK"))<a name="line.2509"></a>
<span class="sourceLineNo">2510</span>                                                pdb_REMARK_Handler(line);<a name="line.2510"></a>
<span class="sourceLineNo">2511</span>                                        else if (recordName.equals("CONECT"))<a name="line.2511"></a>
<span class="sourceLineNo">2512</span>                                                pdb_CONECT_Handler(line);<a name="line.2512"></a>
<span class="sourceLineNo">2513</span>                                        else if (recordName.equals("REVDAT"))<a name="line.2513"></a>
<span class="sourceLineNo">2514</span>                                                pdb_REVDAT_Handler(line);<a name="line.2514"></a>
<span class="sourceLineNo">2515</span>                                        else if (recordName.equals("DBREF"))<a name="line.2515"></a>
<span class="sourceLineNo">2516</span>                                                pdb_DBREF_Handler(line);<a name="line.2516"></a>
<span class="sourceLineNo">2517</span>                                        else if (recordName.equals("SITE"))<a name="line.2517"></a>
<span class="sourceLineNo">2518</span>                                                pdb_SITE_Handler(line);<a name="line.2518"></a>
<span class="sourceLineNo">2519</span>                                        else if (recordName.equals("SSBOND"))<a name="line.2519"></a>
<span class="sourceLineNo">2520</span>                                                pdb_SSBOND_Handler(line);<a name="line.2520"></a>
<span class="sourceLineNo">2521</span>                                        else if ( params.isParseSecStruc()) {<a name="line.2521"></a>
<span class="sourceLineNo">2522</span>                                                if ( recordName.equals("HELIX") ) pdb_HELIX_Handler (  line ) ;<a name="line.2522"></a>
<span class="sourceLineNo">2523</span>                                                else if (recordName.equals("SHEET")) pdb_SHEET_Handler(line ) ;<a name="line.2523"></a>
<span class="sourceLineNo">2524</span>                                                else if (recordName.equals("TURN")) pdb_TURN_Handler(   line ) ;<a name="line.2524"></a>
<span class="sourceLineNo">2525</span>                                        }<a name="line.2525"></a>
<span class="sourceLineNo">2526</span>                                        else {<a name="line.2526"></a>
<span class="sourceLineNo">2527</span>                                                // this line type is not supported, yet.<a name="line.2527"></a>
<span class="sourceLineNo">2528</span>                                                // we ignore it<a name="line.2528"></a>
<span class="sourceLineNo">2529</span>                                        }<a name="line.2529"></a>
<span class="sourceLineNo">2530</span>                                } catch (Exception e){<a name="line.2530"></a>
<span class="sourceLineNo">2531</span>                                        // the line is badly formatted, ignore it!<a name="line.2531"></a>
<span class="sourceLineNo">2532</span>                                        e.printStackTrace();<a name="line.2532"></a>
<span class="sourceLineNo">2533</span>                                        System.err.println("badly formatted line ... " + line);<a name="line.2533"></a>
<span class="sourceLineNo">2534</span>                                }<a name="line.2534"></a>
<span class="sourceLineNo">2535</span>                                line = buf.readLine ();<a name="line.2535"></a>
<span class="sourceLineNo">2536</span>                        }<a name="line.2536"></a>
<span class="sourceLineNo">2537</span><a name="line.2537"></a>
<span class="sourceLineNo">2538</span>                        makeCompounds(compndLines, sourceLines);<a name="line.2538"></a>
<span class="sourceLineNo">2539</span><a name="line.2539"></a>
<span class="sourceLineNo">2540</span>                        triggerEndFileChecks();<a name="line.2540"></a>
<span class="sourceLineNo">2541</span><a name="line.2541"></a>
<span class="sourceLineNo">2542</span>                } catch (Exception e) {<a name="line.2542"></a>
<span class="sourceLineNo">2543</span>                        System.err.println(line);<a name="line.2543"></a>
<span class="sourceLineNo">2544</span>                        e.printStackTrace();<a name="line.2544"></a>
<span class="sourceLineNo">2545</span>                        throw new IOException ("Error parsing PDB file " + structure.getPDBCode() + " at line: " + line);<a name="line.2545"></a>
<span class="sourceLineNo">2546</span>                }<a name="line.2546"></a>
<span class="sourceLineNo">2547</span><a name="line.2547"></a>
<span class="sourceLineNo">2548</span>                if ( params.isParseSecStruc())<a name="line.2548"></a>
<span class="sourceLineNo">2549</span>                        setSecStruc();<a name="line.2549"></a>
<span class="sourceLineNo">2550</span><a name="line.2550"></a>
<span class="sourceLineNo">2551</span><a name="line.2551"></a>
<span class="sourceLineNo">2552</span>                return structure;<a name="line.2552"></a>
<span class="sourceLineNo">2553</span><a name="line.2553"></a>
<span class="sourceLineNo">2554</span>        }<a name="line.2554"></a>
<span class="sourceLineNo">2555</span><a name="line.2555"></a>
<span class="sourceLineNo">2556</span>        /**<a name="line.2556"></a>
<span class="sourceLineNo">2557</span>         * This is the new method for building the COMPND and SOURCE records. Now each method is self-contained.<a name="line.2557"></a>
<span class="sourceLineNo">2558</span>         * @author Jules Jacobsen<a name="line.2558"></a>
<span class="sourceLineNo">2559</span>         * @param  compoundList<a name="line.2559"></a>
<span class="sourceLineNo">2560</span>         * @param  sourceList<a name="line.2560"></a>
<span class="sourceLineNo">2561</span>         */<a name="line.2561"></a>
<span class="sourceLineNo">2562</span>        private void makeCompounds(List&lt;String&gt; compoundList,<a name="line.2562"></a>
<span class="sourceLineNo">2563</span>                        List&lt;String&gt; sourceList) {<a name="line.2563"></a>
<span class="sourceLineNo">2564</span>                //              System.out.println("[makeCompounds] making compounds from compoundLines");<a name="line.2564"></a>
<span class="sourceLineNo">2565</span><a name="line.2565"></a>
<span class="sourceLineNo">2566</span>                for (String line : compoundList) {<a name="line.2566"></a>
<span class="sourceLineNo">2567</span>                        if (compoundList.indexOf(line) + 1 == compoundList.size()) {<a name="line.2567"></a>
<span class="sourceLineNo">2568</span>                                //                              System.out.println("[makeCompounds] Final line in compoundLines.");<a name="line.2568"></a>
<span class="sourceLineNo">2569</span>                                isLastCompndLine = true;<a name="line.2569"></a>
<span class="sourceLineNo">2570</span>                        }<a name="line.2570"></a>
<span class="sourceLineNo">2571</span>                        pdb_COMPND_Handler(line);<a name="line.2571"></a>
<span class="sourceLineNo">2572</span><a name="line.2572"></a>
<span class="sourceLineNo">2573</span>                }<a name="line.2573"></a>
<span class="sourceLineNo">2574</span>                //              System.out.println("[makeCompounds] adding sources to compounds from sourceLines");<a name="line.2574"></a>
<span class="sourceLineNo">2575</span>                // since we're starting again from the first compound, reset it here<a name="line.2575"></a>
<span class="sourceLineNo">2576</span>                if ( compounds.size() == 0){<a name="line.2576"></a>
<span class="sourceLineNo">2577</span>                        current_compound = new Compound();<a name="line.2577"></a>
<span class="sourceLineNo">2578</span>                } else {<a name="line.2578"></a>
<span class="sourceLineNo">2579</span>                        current_compound = compounds.get(0);<a name="line.2579"></a>
<span class="sourceLineNo">2580</span>                }<a name="line.2580"></a>
<span class="sourceLineNo">2581</span>                for (String line : sourceList) {<a name="line.2581"></a>
<span class="sourceLineNo">2582</span>                        if (sourceList.indexOf(line) + 1 == sourceList.size()) {<a name="line.2582"></a>
<span class="sourceLineNo">2583</span>                                //                              System.out.println("[makeCompounds] Final line in sourceLines.");<a name="line.2583"></a>
<span class="sourceLineNo">2584</span>                                isLastSourceLine = true;<a name="line.2584"></a>
<span class="sourceLineNo">2585</span>                        }<a name="line.2585"></a>
<span class="sourceLineNo">2586</span>                        pdb_SOURCE_Handler(line);<a name="line.2586"></a>
<span class="sourceLineNo">2587</span>                }<a name="line.2587"></a>
<span class="sourceLineNo">2588</span><a name="line.2588"></a>
<span class="sourceLineNo">2589</span>        }<a name="line.2589"></a>
<span class="sourceLineNo">2590</span><a name="line.2590"></a>
<span class="sourceLineNo">2591</span><a name="line.2591"></a>
<span class="sourceLineNo">2592</span>        private void triggerEndFileChecks(){<a name="line.2592"></a>
<span class="sourceLineNo">2593</span>                // finish and add ...<a name="line.2593"></a>
<span class="sourceLineNo">2594</span><a name="line.2594"></a>
<span class="sourceLineNo">2595</span>                String modDate = (String) header.get("modDate");<a name="line.2595"></a>
<span class="sourceLineNo">2596</span>                if ( modDate.equals("0000-00-00") ) {<a name="line.2596"></a>
<span class="sourceLineNo">2597</span>                        // modification date = deposition date<a name="line.2597"></a>
<span class="sourceLineNo">2598</span>                        String depositionDate = (String) header.get("depDate");<a name="line.2598"></a>
<span class="sourceLineNo">2599</span>                        header.put("modDate",depositionDate) ;<a name="line.2599"></a>
<span class="sourceLineNo">2600</span><a name="line.2600"></a>
<span class="sourceLineNo">2601</span>                        if (! depositionDate.equals(modDate)){<a name="line.2601"></a>
<span class="sourceLineNo">2602</span>                                // depDate is 0000-00-00<a name="line.2602"></a>
<span class="sourceLineNo">2603</span><a name="line.2603"></a>
<span class="sourceLineNo">2604</span>                                try {<a name="line.2604"></a>
<span class="sourceLineNo">2605</span>                                        Date dep = dateFormat.parse(depositionDate);<a name="line.2605"></a>
<span class="sourceLineNo">2606</span>                                        pdbHeader.setDepDate(dep);<a name="line.2606"></a>
<span class="sourceLineNo">2607</span>                                } catch (ParseException e){<a name="line.2607"></a>
<span class="sourceLineNo">2608</span>                                        e.printStackTrace();<a name="line.2608"></a>
<span class="sourceLineNo">2609</span>                                }<a name="line.2609"></a>
<span class="sourceLineNo">2610</span>                        }<a name="line.2610"></a>
<span class="sourceLineNo">2611</span><a name="line.2611"></a>
<span class="sourceLineNo">2612</span>                }<a name="line.2612"></a>
<span class="sourceLineNo">2613</span><a name="line.2613"></a>
<span class="sourceLineNo">2614</span>                // a problem occurred earlier so current_chain = null ...<a name="line.2614"></a>
<span class="sourceLineNo">2615</span>                // most likely the buffered reader did not provide data ...<a name="line.2615"></a>
<span class="sourceLineNo">2616</span>                if ( current_chain != null ) {                  <a name="line.2616"></a>
<span class="sourceLineNo">2617</span>                        current_chain.addGroup(current_group);<a name="line.2617"></a>
<span class="sourceLineNo">2618</span><a name="line.2618"></a>
<span class="sourceLineNo">2619</span>                        if (isKnownChain(current_chain.getChainID(),current_model) == null) {<a name="line.2619"></a>
<span class="sourceLineNo">2620</span>                                current_model.add(current_chain);<a name="line.2620"></a>
<span class="sourceLineNo">2621</span>                        }<a name="line.2621"></a>
<span class="sourceLineNo">2622</span>                }<a name="line.2622"></a>
<span class="sourceLineNo">2623</span><a name="line.2623"></a>
<span class="sourceLineNo">2624</span>                //set the JournalArticle, if there is one<a name="line.2624"></a>
<span class="sourceLineNo">2625</span>                if (!journalLines.isEmpty()) {<a name="line.2625"></a>
<span class="sourceLineNo">2626</span>                        buildjournalArticle();<a name="line.2626"></a>
<span class="sourceLineNo">2627</span>                        structure.setJournalArticle(journalArticle);<a name="line.2627"></a>
<span class="sourceLineNo">2628</span>                }<a name="line.2628"></a>
<span class="sourceLineNo">2629</span><a name="line.2629"></a>
<span class="sourceLineNo">2630</span>                structure.addModel(current_model);<a name="line.2630"></a>
<span class="sourceLineNo">2631</span>                structure.setHeader(header);<a name="line.2631"></a>
<span class="sourceLineNo">2632</span>                structure.setPDBHeader(pdbHeader);<a name="line.2632"></a>
<span class="sourceLineNo">2633</span>                structure.setConnections(connects);<a name="line.2633"></a>
<span class="sourceLineNo">2634</span>                structure.setCompounds(compounds);<a name="line.2634"></a>
<span class="sourceLineNo">2635</span>                structure.setDBRefs(dbrefs);<a name="line.2635"></a>
<span class="sourceLineNo">2636</span><a name="line.2636"></a>
<span class="sourceLineNo">2637</span>                if ( params.isAlignSeqRes() ){<a name="line.2637"></a>
<span class="sourceLineNo">2638</span><a name="line.2638"></a>
<span class="sourceLineNo">2639</span>                        SeqRes2AtomAligner aligner = new SeqRes2AtomAligner();<a name="line.2639"></a>
<span class="sourceLineNo">2640</span>                        aligner.align(structure,seqResChains);<a name="line.2640"></a>
<span class="sourceLineNo">2641</span><a name="line.2641"></a>
<span class="sourceLineNo">2642</span>                } else if ( params.getStoreEmptySeqRes() ){<a name="line.2642"></a>
<span class="sourceLineNo">2643</span>                        // user wants to know about the seqres, but not align them<a name="line.2643"></a>
<span class="sourceLineNo">2644</span><a name="line.2644"></a>
<span class="sourceLineNo">2645</span>                        storeUnAlignedSeqRes(structure, seqResChains);<a name="line.2645"></a>
<span class="sourceLineNo">2646</span>                }<a name="line.2646"></a>
<span class="sourceLineNo">2647</span><a name="line.2647"></a>
<span class="sourceLineNo">2648</span><a name="line.2648"></a>
<span class="sourceLineNo">2649</span>                linkChains2Compound(structure);<a name="line.2649"></a>
<span class="sourceLineNo">2650</span>                //associate the temporary Groups in the siteMap to the ones<a name="line.2650"></a>
<span class="sourceLineNo">2651</span>                try { <a name="line.2651"></a>
<span class="sourceLineNo">2652</span>                        linkSitesToGroups(); // will work now that setSites is called<a name="line.2652"></a>
<span class="sourceLineNo">2653</span>                } catch (Exception e){<a name="line.2653"></a>
<span class="sourceLineNo">2654</span>                        logger.fine("Error while linking SITE records to groups. ..");<a name="line.2654"></a>
<span class="sourceLineNo">2655</span>                        logger.fine(e.getMessage());<a name="line.2655"></a>
<span class="sourceLineNo">2656</span>                }<a name="line.2656"></a>
<span class="sourceLineNo">2657</span>        }<a name="line.2657"></a>
<span class="sourceLineNo">2658</span><a name="line.2658"></a>
<span class="sourceLineNo">2659</span><a name="line.2659"></a>
<span class="sourceLineNo">2660</span>        private void storeUnAlignedSeqRes(Structure structure, List&lt;Chain&gt; seqResChains) {<a name="line.2660"></a>
<span class="sourceLineNo">2661</span>                SeqRes2AtomAligner aligner = new SeqRes2AtomAligner();<a name="line.2661"></a>
<span class="sourceLineNo">2662</span>                <a name="line.2662"></a>
<span class="sourceLineNo">2663</span>                for (int i = 0; i &lt; structure.nrModels(); i++) {<a name="line.2663"></a>
<span class="sourceLineNo">2664</span>                        List&lt;Chain&gt; atomList   = structure.getModel(i);<a name="line.2664"></a>
<span class="sourceLineNo">2665</span>                        <a name="line.2665"></a>
<span class="sourceLineNo">2666</span>                        for (Chain seqRes: seqResChains){<a name="line.2666"></a>
<span class="sourceLineNo">2667</span>                                Chain atomRes;<a name="line.2667"></a>
<span class="sourceLineNo">2668</span>                                try {<a name="line.2668"></a>
<span class="sourceLineNo">2669</span>                                        atomRes = aligner.getMatchingAtomRes(seqRes,atomList);<a name="line.2669"></a>
<span class="sourceLineNo">2670</span>                                        atomRes.setSeqResGroups(seqRes.getAtomGroups());<a name="line.2670"></a>
<span class="sourceLineNo">2671</span>                                } catch (StructureException e) {<a name="line.2671"></a>
<span class="sourceLineNo">2672</span>                                        // this is used for matching of biological units<a name="line.2672"></a>
<span class="sourceLineNo">2673</span>                                        // where chains can be missing<a name="line.2673"></a>
<span class="sourceLineNo">2674</span>                                        // ignore if chain can't be found.<a name="line.2674"></a>
<span class="sourceLineNo">2675</span><a name="line.2675"></a>
<span class="sourceLineNo">2676</span>                                        // e.printStackTrace();<a name="line.2676"></a>
<span class="sourceLineNo">2677</span>                                        continue;<a name="line.2677"></a>
<span class="sourceLineNo">2678</span>                                }<a name="line.2678"></a>
<span class="sourceLineNo">2679</span>                        }<a name="line.2679"></a>
<span class="sourceLineNo">2680</span>                }<a name="line.2680"></a>
<span class="sourceLineNo">2681</span>        }<a name="line.2681"></a>
<span class="sourceLineNo">2682</span><a name="line.2682"></a>
<span class="sourceLineNo">2683</span>        private void setSecStruc(){<a name="line.2683"></a>
<span class="sourceLineNo">2684</span><a name="line.2684"></a>
<span class="sourceLineNo">2685</span>                setSecElement(helixList,  PDB_AUTHOR_ASSIGNMENT, HELIX  );<a name="line.2685"></a>
<span class="sourceLineNo">2686</span>                setSecElement(strandList, PDB_AUTHOR_ASSIGNMENT, STRAND );<a name="line.2686"></a>
<span class="sourceLineNo">2687</span>                setSecElement(turnList,   PDB_AUTHOR_ASSIGNMENT, TURN   );<a name="line.2687"></a>
<span class="sourceLineNo">2688</span><a name="line.2688"></a>
<span class="sourceLineNo">2689</span>        }<a name="line.2689"></a>
<span class="sourceLineNo">2690</span><a name="line.2690"></a>
<span class="sourceLineNo">2691</span>        private void setSecElement(List&lt;Map&lt;String,String&gt;&gt; secList, String assignment, String type){<a name="line.2691"></a>
<span class="sourceLineNo">2692</span><a name="line.2692"></a>
<span class="sourceLineNo">2693</span><a name="line.2693"></a>
<span class="sourceLineNo">2694</span>                Iterator&lt;Map&lt;String,String&gt;&gt; iter = secList.iterator();<a name="line.2694"></a>
<span class="sourceLineNo">2695</span>                nextElement:<a name="line.2695"></a>
<span class="sourceLineNo">2696</span>                        while (iter.hasNext()){<a name="line.2696"></a>
<span class="sourceLineNo">2697</span>                                Map&lt;String,String&gt; m = iter.next();<a name="line.2697"></a>
<span class="sourceLineNo">2698</span><a name="line.2698"></a>
<span class="sourceLineNo">2699</span>                                // assign all residues in this range to this secondary structure type<a name="line.2699"></a>
<span class="sourceLineNo">2700</span>                                // String initResName = (String)m.get("initResName");<a name="line.2700"></a>
<span class="sourceLineNo">2701</span>                                String initChainId = (String)m.get("initChainId");<a name="line.2701"></a>
<span class="sourceLineNo">2702</span>                                String initSeqNum  = (String)m.get("initSeqNum" );<a name="line.2702"></a>
<span class="sourceLineNo">2703</span>                                String initICode   = (String)m.get("initICode" );<a name="line.2703"></a>
<span class="sourceLineNo">2704</span>                                // String endResName  = (String)m.get("endResName" );<a name="line.2704"></a>
<span class="sourceLineNo">2705</span>                                String endChainId  = (String)m.get("endChainId" );<a name="line.2705"></a>
<span class="sourceLineNo">2706</span>                                String endSeqNum   = (String)m.get("endSeqNum");<a name="line.2706"></a>
<span class="sourceLineNo">2707</span>                                String endICode    = (String)m.get("endICode");<a name="line.2707"></a>
<span class="sourceLineNo">2708</span><a name="line.2708"></a>
<span class="sourceLineNo">2709</span>                                if (initICode.equals(" "))<a name="line.2709"></a>
<span class="sourceLineNo">2710</span>                                        initICode = "";<a name="line.2710"></a>
<span class="sourceLineNo">2711</span>                                if (endICode.equals(" "))<a name="line.2711"></a>
<span class="sourceLineNo">2712</span>                                        endICode = "";<a name="line.2712"></a>
<span class="sourceLineNo">2713</span><a name="line.2713"></a>
<span class="sourceLineNo">2714</span><a name="line.2714"></a>
<span class="sourceLineNo">2715</span><a name="line.2715"></a>
<span class="sourceLineNo">2716</span>                                GroupIterator gi = new GroupIterator(structure);<a name="line.2716"></a>
<span class="sourceLineNo">2717</span>                                boolean inRange = false;<a name="line.2717"></a>
<span class="sourceLineNo">2718</span>                                while (gi.hasNext()){<a name="line.2718"></a>
<span class="sourceLineNo">2719</span>                                        Group g = (Group)gi.next();<a name="line.2719"></a>
<span class="sourceLineNo">2720</span>                                        Chain c = g.getChain();<a name="line.2720"></a>
<span class="sourceLineNo">2721</span><a name="line.2721"></a>
<span class="sourceLineNo">2722</span>                                        if (c.getChainID().equals(initChainId)){<a name="line.2722"></a>
<span class="sourceLineNo">2723</span><a name="line.2723"></a>
<span class="sourceLineNo">2724</span>                                                String pdbCode = initSeqNum + initICode;<a name="line.2724"></a>
<span class="sourceLineNo">2725</span>                                                if ( g.getResidueNumber().toString().equals(pdbCode)  ) {<a name="line.2725"></a>
<span class="sourceLineNo">2726</span>                                                        inRange = true;<a name="line.2726"></a>
<span class="sourceLineNo">2727</span>                                                }<a name="line.2727"></a>
<span class="sourceLineNo">2728</span>                                        }<a name="line.2728"></a>
<span class="sourceLineNo">2729</span>                                        if ( inRange){<a name="line.2729"></a>
<span class="sourceLineNo">2730</span>                                                if ( g instanceof AminoAcid) {<a name="line.2730"></a>
<span class="sourceLineNo">2731</span>                                                        AminoAcid aa = (AminoAcid)g;<a name="line.2731"></a>
<span class="sourceLineNo">2732</span><a name="line.2732"></a>
<span class="sourceLineNo">2733</span>                                                        Map&lt;String,String&gt; assignmentMap = new HashMap&lt;String,String&gt;();<a name="line.2733"></a>
<span class="sourceLineNo">2734</span>                                                        assignmentMap.put(assignment,type);<a name="line.2734"></a>
<span class="sourceLineNo">2735</span>                                                        aa.setSecStruc(assignmentMap);<a name="line.2735"></a>
<span class="sourceLineNo">2736</span>                                                }<a name="line.2736"></a>
<span class="sourceLineNo">2737</span><a name="line.2737"></a>
<span class="sourceLineNo">2738</span>                                        }<a name="line.2738"></a>
<span class="sourceLineNo">2739</span>                                        if ( c.getChainID().equals(endChainId)){<a name="line.2739"></a>
<span class="sourceLineNo">2740</span>                                                String pdbCode = endSeqNum + endICode;<a name="line.2740"></a>
<span class="sourceLineNo">2741</span>                                                if (pdbCode.equals(g.getResidueNumber().toString())){<a name="line.2741"></a>
<span class="sourceLineNo">2742</span>                                                        inRange = false;<a name="line.2742"></a>
<span class="sourceLineNo">2743</span>                                                        continue nextElement;<a name="line.2743"></a>
<span class="sourceLineNo">2744</span>                                                }<a name="line.2744"></a>
<span class="sourceLineNo">2745</span>                                        }<a name="line.2745"></a>
<span class="sourceLineNo">2746</span><a name="line.2746"></a>
<span class="sourceLineNo">2747</span>                                }<a name="line.2747"></a>
<span class="sourceLineNo">2748</span><a name="line.2748"></a>
<span class="sourceLineNo">2749</span>                        }<a name="line.2749"></a>
<span class="sourceLineNo">2750</span>        }<a name="line.2750"></a>
<span class="sourceLineNo">2751</span><a name="line.2751"></a>
<span class="sourceLineNo">2752</span><a name="line.2752"></a>
<span class="sourceLineNo">2753</span>        /** After the parsing of a PDB file the {@link Chain} and  {@link Compound}<a name="line.2753"></a>
<span class="sourceLineNo">2754</span>         * objects need to be linked to each other.<a name="line.2754"></a>
<span class="sourceLineNo">2755</span>         *<a name="line.2755"></a>
<span class="sourceLineNo">2756</span>         * @param s the structure<a name="line.2756"></a>
<span class="sourceLineNo">2757</span>         */<a name="line.2757"></a>
<span class="sourceLineNo">2758</span>        public void linkChains2Compound(Structure s){<a name="line.2758"></a>
<span class="sourceLineNo">2759</span>                List&lt;Compound&gt; compounds = s.getCompounds();<a name="line.2759"></a>
<span class="sourceLineNo">2760</span><a name="line.2760"></a>
<span class="sourceLineNo">2761</span>                for(Compound comp : compounds){<a name="line.2761"></a>
<span class="sourceLineNo">2762</span>                        List&lt;Chain&gt; chains = new ArrayList&lt;Chain&gt;();<a name="line.2762"></a>
<span class="sourceLineNo">2763</span>                        List&lt;String&gt; chainIds = comp.getChainId();<a name="line.2763"></a>
<span class="sourceLineNo">2764</span>                        if ( chainIds == null)<a name="line.2764"></a>
<span class="sourceLineNo">2765</span>                                continue;<a name="line.2765"></a>
<span class="sourceLineNo">2766</span>                        for ( String chainId : chainIds) {<a name="line.2766"></a>
<span class="sourceLineNo">2767</span>                                if ( chainId.equals("NULL"))<a name="line.2767"></a>
<span class="sourceLineNo">2768</span>                                        chainId = " ";<a name="line.2768"></a>
<span class="sourceLineNo">2769</span>                                try {<a name="line.2769"></a>
<span class="sourceLineNo">2770</span><a name="line.2770"></a>
<span class="sourceLineNo">2771</span>                                        Chain c = s.findChain(chainId);<a name="line.2771"></a>
<span class="sourceLineNo">2772</span>                                        chains.add(c);<a name="line.2772"></a>
<span class="sourceLineNo">2773</span><a name="line.2773"></a>
<span class="sourceLineNo">2774</span>                                } catch (StructureException e){<a name="line.2774"></a>
<span class="sourceLineNo">2775</span>                                        // usually if this happens something is wrong with the PDB header<a name="line.2775"></a>
<span class="sourceLineNo">2776</span>                                        // e.g. 2brd - there is no Chain A, although it is specified in the header<a name="line.2776"></a>
<span class="sourceLineNo">2777</span>                                        e.printStackTrace();<a name="line.2777"></a>
<span class="sourceLineNo">2778</span>                                }<a name="line.2778"></a>
<span class="sourceLineNo">2779</span>                        }<a name="line.2779"></a>
<span class="sourceLineNo">2780</span>                        comp.setChains(chains);<a name="line.2780"></a>
<span class="sourceLineNo">2781</span>                }<a name="line.2781"></a>
<span class="sourceLineNo">2782</span><a name="line.2782"></a>
<span class="sourceLineNo">2783</span>                if ( compounds.size() == 1) {<a name="line.2783"></a>
<span class="sourceLineNo">2784</span>                        Compound comp = compounds.get(0);<a name="line.2784"></a>
<span class="sourceLineNo">2785</span>                        if ( comp.getChainId() == null){<a name="line.2785"></a>
<span class="sourceLineNo">2786</span>                                List&lt;Chain&gt; chains = s.getChains(0);<a name="line.2786"></a>
<span class="sourceLineNo">2787</span>                                if ( chains.size() == 1) {<a name="line.2787"></a>
<span class="sourceLineNo">2788</span>                                        // this is an old style PDB file - add the ChainI<a name="line.2788"></a>
<span class="sourceLineNo">2789</span>                                        Chain ch = chains.get(0);<a name="line.2789"></a>
<span class="sourceLineNo">2790</span>                                        List &lt;String&gt; chainIds = new ArrayList&lt;String&gt;();<a name="line.2790"></a>
<span class="sourceLineNo">2791</span>                                        chainIds.add(ch.getChainID());<a name="line.2791"></a>
<span class="sourceLineNo">2792</span>                                        comp.setChainId(chainIds);<a name="line.2792"></a>
<span class="sourceLineNo">2793</span>                                        comp.addChain(ch);<a name="line.2793"></a>
<span class="sourceLineNo">2794</span>                                }<a name="line.2794"></a>
<span class="sourceLineNo">2795</span>                        }<a name="line.2795"></a>
<span class="sourceLineNo">2796</span>                }<a name="line.2796"></a>
<span class="sourceLineNo">2797</span><a name="line.2797"></a>
<span class="sourceLineNo">2798</span>                for (Compound comp: compounds){<a name="line.2798"></a>
<span class="sourceLineNo">2799</span>                        if ( comp.getChainId() == null) {<a name="line.2799"></a>
<span class="sourceLineNo">2800</span>                                // could not link to chain<a name="line.2800"></a>
<span class="sourceLineNo">2801</span>                                // TODO: should this be allowed to happen?<a name="line.2801"></a>
<span class="sourceLineNo">2802</span>                                continue;<a name="line.2802"></a>
<span class="sourceLineNo">2803</span>                        }<a name="line.2803"></a>
<span class="sourceLineNo">2804</span>                        for ( String chainId : comp.getChainId()){<a name="line.2804"></a>
<span class="sourceLineNo">2805</span>                                if ( chainId.equals("NULL"))<a name="line.2805"></a>
<span class="sourceLineNo">2806</span>                                        continue;<a name="line.2806"></a>
<span class="sourceLineNo">2807</span>                                try {<a name="line.2807"></a>
<span class="sourceLineNo">2808</span>                                        Chain c = s.getChainByPDB(chainId);<a name="line.2808"></a>
<span class="sourceLineNo">2809</span>                                        c.setHeader(comp);<a name="line.2809"></a>
<span class="sourceLineNo">2810</span>                                } catch (StructureException e){<a name="line.2810"></a>
<span class="sourceLineNo">2811</span>                                        e.printStackTrace();<a name="line.2811"></a>
<span class="sourceLineNo">2812</span>                                }<a name="line.2812"></a>
<span class="sourceLineNo">2813</span>                        }<a name="line.2813"></a>
<span class="sourceLineNo">2814</span>                }<a name="line.2814"></a>
<span class="sourceLineNo">2815</span><a name="line.2815"></a>
<span class="sourceLineNo">2816</span>        }<a name="line.2816"></a>
<span class="sourceLineNo">2817</span><a name="line.2817"></a>
<span class="sourceLineNo">2818</span>        /**<a name="line.2818"></a>
<span class="sourceLineNo">2819</span>         * Links the Sites in the siteMap to the Groups in the Structure via the<a name="line.2819"></a>
<span class="sourceLineNo">2820</span>         * siteToResidueMap ResidueNumber.<a name="line.2820"></a>
<span class="sourceLineNo">2821</span>         * @author Jules Jacobsen<a name="line.2821"></a>
<span class="sourceLineNo">2822</span>         * @return<a name="line.2822"></a>
<span class="sourceLineNo">2823</span>         */<a name="line.2823"></a>
<span class="sourceLineNo">2824</span>        private void linkSitesToGroups() {<a name="line.2824"></a>
<span class="sourceLineNo">2825</span><a name="line.2825"></a>
<span class="sourceLineNo">2826</span>                //System.out.println("LINK SITES TO GROUPS:" + siteToResidueMap.keySet().size());<a name="line.2826"></a>
<span class="sourceLineNo">2827</span><a name="line.2827"></a>
<span class="sourceLineNo">2828</span>                //link the map of siteIds : &lt;ResidueNumber&gt; with the sites by using ResidueNumber to get the correct group back.<a name="line.2828"></a>
<span class="sourceLineNo">2829</span>                //the return list<a name="line.2829"></a>
<span class="sourceLineNo">2830</span><a name="line.2830"></a>
<span class="sourceLineNo">2831</span>                if ( siteMap == null || siteToResidueMap == null){<a name="line.2831"></a>
<span class="sourceLineNo">2832</span>                        logger.fine("Sites can not be linked to residues!");<a name="line.2832"></a>
<span class="sourceLineNo">2833</span><a name="line.2833"></a>
<span class="sourceLineNo">2834</span>                        return;<a name="line.2834"></a>
<span class="sourceLineNo">2835</span>                }<a name="line.2835"></a>
<span class="sourceLineNo">2836</span><a name="line.2836"></a>
<span class="sourceLineNo">2837</span>                List&lt;Site&gt; sites = null;<a name="line.2837"></a>
<span class="sourceLineNo">2838</span>                //check that there are chains with which to associate the groups<a name="line.2838"></a>
<span class="sourceLineNo">2839</span>                if (structure.getChains().isEmpty()) {<a name="line.2839"></a>
<span class="sourceLineNo">2840</span>                        sites = new ArrayList&lt;Site&gt;(siteMap.values());<a name="line.2840"></a>
<span class="sourceLineNo">2841</span>                        logger.fine("No chains to link Site Groups with - Sites will not be present in the Structure");<a name="line.2841"></a>
<span class="sourceLineNo">2842</span>                        return;<a name="line.2842"></a>
<span class="sourceLineNo">2843</span>                }<a name="line.2843"></a>
<span class="sourceLineNo">2844</span><a name="line.2844"></a>
<span class="sourceLineNo">2845</span>                //check that the keys in the siteMap and SiteToResidueMap are equal <a name="line.2845"></a>
<span class="sourceLineNo">2846</span>                if (! siteMap.keySet().equals(siteToResidueMap.keySet())) {<a name="line.2846"></a>
<span class="sourceLineNo">2847</span>                        logger.fine("Not all sites have been properly described in the PDB " + pdbId + " header - some Sites will not be present in the Structure");<a name="line.2847"></a>
<span class="sourceLineNo">2848</span>                        logger.fine(siteMap.keySet() + " | " + siteToResidueMap.keySet());<a name="line.2848"></a>
<span class="sourceLineNo">2849</span>                        //return;<a name="line.2849"></a>
<span class="sourceLineNo">2850</span>                }<a name="line.2850"></a>
<span class="sourceLineNo">2851</span><a name="line.2851"></a>
<span class="sourceLineNo">2852</span>                //so we have chains - associate the siteResidues-related groups with the ones<a name="line.2852"></a>
<span class="sourceLineNo">2853</span>                //already in in the chains<a name="line.2853"></a>
<span class="sourceLineNo">2854</span>                for (String key : siteMap.keySet()) {<a name="line.2854"></a>
<span class="sourceLineNo">2855</span>                        Site currentSite = siteMap.get(key);<a name="line.2855"></a>
<span class="sourceLineNo">2856</span>                        List&lt;ResidueNumber&gt; linkedGroups = siteToResidueMap.get(key);<a name="line.2856"></a>
<span class="sourceLineNo">2857</span>                        if ( linkedGroups == null)<a name="line.2857"></a>
<span class="sourceLineNo">2858</span>                                continue;<a name="line.2858"></a>
<span class="sourceLineNo">2859</span>                        for (ResidueNumber residueNumber : linkedGroups) {<a name="line.2859"></a>
<span class="sourceLineNo">2860</span><a name="line.2860"></a>
<span class="sourceLineNo">2861</span>                                String pdbCode = residueNumber.toString();<a name="line.2861"></a>
<span class="sourceLineNo">2862</span>                                String chain = residueNumber.getChainId();<a name="line.2862"></a>
<span class="sourceLineNo">2863</span>                                //                    System.out.println("chain: '" + chain + "'");<a name="line.2863"></a>
<span class="sourceLineNo">2864</span>                                //                    String resNum = resNum.getSeqNum().toString();<a name="line.2864"></a>
<span class="sourceLineNo">2865</span>                                //                    System.out.println("resNum: '" + resNum + "'");<a name="line.2865"></a>
<span class="sourceLineNo">2866</span><a name="line.2866"></a>
<span class="sourceLineNo">2867</span>                                Group linkedGroup = null;<a name="line.2867"></a>
<span class="sourceLineNo">2868</span>                                try {<a name="line.2868"></a>
<span class="sourceLineNo">2869</span>                                        //TODO: implement findGroup(ResidueNumber resNum)<a name="line.2869"></a>
<span class="sourceLineNo">2870</span>                                        linkedGroup = structure.findGroup(chain, pdbCode);<a name="line.2870"></a>
<span class="sourceLineNo">2871</span>                                } catch (StructureException ex) {<a name="line.2871"></a>
<span class="sourceLineNo">2872</span>                                        Logger.getLogger(PDBFileParser.class.getName()).log(Level.FINE, "Can't find group " + pdbCode + " in chain " + chain + " in order to link up SITE records (PDB ID " + pdbId +")");<a name="line.2872"></a>
<span class="sourceLineNo">2873</span>                                        //Logger.getLogger(PDBFileParser.class.getName()).log(Level.SEVERE, ex.getMessage(), ex);<a name="line.2873"></a>
<span class="sourceLineNo">2874</span>                                        continue;<a name="line.2874"></a>
<span class="sourceLineNo">2875</span>                                }<a name="line.2875"></a>
<span class="sourceLineNo">2876</span><a name="line.2876"></a>
<span class="sourceLineNo">2877</span>                                //                    System.out.println("Adding group: " + linkedGroup.getSeqNum() + " to site " + site.getSiteID());<a name="line.2877"></a>
<span class="sourceLineNo">2878</span>                                currentSite.getGroups().add(linkedGroup);<a name="line.2878"></a>
<span class="sourceLineNo">2879</span>                        }<a name="line.2879"></a>
<span class="sourceLineNo">2880</span>                }<a name="line.2880"></a>
<span class="sourceLineNo">2881</span><a name="line.2881"></a>
<span class="sourceLineNo">2882</span>                //System.out.println("SITEMAP: " + siteMap);<a name="line.2882"></a>
<span class="sourceLineNo">2883</span><a name="line.2883"></a>
<span class="sourceLineNo">2884</span>                sites = new ArrayList&lt;Site&gt;(siteMap.values());<a name="line.2884"></a>
<span class="sourceLineNo">2885</span>                structure.setSites(sites);<a name="line.2885"></a>
<span class="sourceLineNo">2886</span>                //System.out.println("STRUCTURE SITES: " + structure.getSites().size());<a name="line.2886"></a>
<span class="sourceLineNo">2887</span>                //            for (Site site : structure.getSites()) {<a name="line.2887"></a>
<span class="sourceLineNo">2888</span>                //                System.out.println(site);<a name="line.2888"></a>
<span class="sourceLineNo">2889</span>                //            }<a name="line.2889"></a>
<span class="sourceLineNo">2890</span>                //            System.out.println("Linked Site Groups with Chains");<a name="line.2890"></a>
<span class="sourceLineNo">2891</span><a name="line.2891"></a>
<span class="sourceLineNo">2892</span>        }<a name="line.2892"></a>
<span class="sourceLineNo">2893</span><a name="line.2893"></a>
<span class="sourceLineNo">2894</span>        private void buildjournalArticle() {<a name="line.2894"></a>
<span class="sourceLineNo">2895</span>                if (DEBUG) {<a name="line.2895"></a>
<span class="sourceLineNo">2896</span>                        System.out.println("building new JournalArticle");<a name="line.2896"></a>
<span class="sourceLineNo">2897</span>                        //            for (String line : journalLines) {<a name="line.2897"></a>
<span class="sourceLineNo">2898</span>                        //                System.out.println(line);<a name="line.2898"></a>
<span class="sourceLineNo">2899</span>                        //            }<a name="line.2899"></a>
<span class="sourceLineNo">2900</span>                }<a name="line.2900"></a>
<span class="sourceLineNo">2901</span>                this.journalArticle = new JournalArticle();<a name="line.2901"></a>
<span class="sourceLineNo">2902</span>                //        JRNL        AUTH   M.HAMMEL,G.SFYROERA,D.RICKLIN,P.MAGOTTI,<a name="line.2902"></a>
<span class="sourceLineNo">2903</span>                //        JRNL        AUTH 2 J.D.LAMBRIS,B.V.GEISBRECHT<a name="line.2903"></a>
<span class="sourceLineNo">2904</span>                //        JRNL        TITL   A STRUCTURAL BASIS FOR COMPLEMENT INHIBITION BY<a name="line.2904"></a>
<span class="sourceLineNo">2905</span>                //        JRNL        TITL 2 STAPHYLOCOCCUS AUREUS.<a name="line.2905"></a>
<span class="sourceLineNo">2906</span>                //        JRNL        REF    NAT.IMMUNOL.                  V.   8   430 2007<a name="line.2906"></a>
<span class="sourceLineNo">2907</span>                //        JRNL        REFN                   ISSN 1529-2908<a name="line.2907"></a>
<span class="sourceLineNo">2908</span>                //        JRNL        PMID   17351618<a name="line.2908"></a>
<span class="sourceLineNo">2909</span>                //        JRNL        DOI    10.1038/NI1450<a name="line.2909"></a>
<span class="sourceLineNo">2910</span>                StringBuffer auth = new StringBuffer();<a name="line.2910"></a>
<span class="sourceLineNo">2911</span>                StringBuffer titl = new StringBuffer();<a name="line.2911"></a>
<span class="sourceLineNo">2912</span>                StringBuffer edit = new StringBuffer();<a name="line.2912"></a>
<span class="sourceLineNo">2913</span>                StringBuffer ref = new StringBuffer();<a name="line.2913"></a>
<span class="sourceLineNo">2914</span>                StringBuffer publ = new StringBuffer();<a name="line.2914"></a>
<span class="sourceLineNo">2915</span>                StringBuffer refn = new StringBuffer();<a name="line.2915"></a>
<span class="sourceLineNo">2916</span>                StringBuffer pmid = new StringBuffer();<a name="line.2916"></a>
<span class="sourceLineNo">2917</span>                StringBuffer doi = new StringBuffer();<a name="line.2917"></a>
<span class="sourceLineNo">2918</span><a name="line.2918"></a>
<span class="sourceLineNo">2919</span>                for (String line : journalLines) {<a name="line.2919"></a>
<span class="sourceLineNo">2920</span>                        if ( line.length() &lt; 19 ) {<a name="line.2920"></a>
<span class="sourceLineNo">2921</span>                                logger.fine("can not process Journal line: " + line);<a name="line.2921"></a>
<span class="sourceLineNo">2922</span>                                continue;<a name="line.2922"></a>
<span class="sourceLineNo">2923</span>                        }<a name="line.2923"></a>
<span class="sourceLineNo">2924</span>                        //            System.out.println("'" + line + "'");<a name="line.2924"></a>
<span class="sourceLineNo">2925</span>                        String subField = line.substring(12, 16);<a name="line.2925"></a>
<span class="sourceLineNo">2926</span>                        //            System.out.println("'" + subField + "'");<a name="line.2926"></a>
<span class="sourceLineNo">2927</span>                        if (subField.equals("AUTH")) {<a name="line.2927"></a>
<span class="sourceLineNo">2928</span>                                auth.append(line.substring(19, line.length()).trim());<a name="line.2928"></a>
<span class="sourceLineNo">2929</span>                                if (DEBUG) {<a name="line.2929"></a>
<span class="sourceLineNo">2930</span>                                        System.out.println("AUTH '" + auth.toString() + "'");<a name="line.2930"></a>
<span class="sourceLineNo">2931</span>                                }<a name="line.2931"></a>
<span class="sourceLineNo">2932</span>                        }<a name="line.2932"></a>
<span class="sourceLineNo">2933</span>                        if (subField.equals("TITL")) {<a name="line.2933"></a>
<span class="sourceLineNo">2934</span>                                //add a space to the end of a line so that when wrapped the<a name="line.2934"></a>
<span class="sourceLineNo">2935</span>                                //words on the join won't be concatenated<a name="line.2935"></a>
<span class="sourceLineNo">2936</span>                                titl.append(line.substring(19, line.length()).trim() + " ");<a name="line.2936"></a>
<span class="sourceLineNo">2937</span>                                if (DEBUG) {<a name="line.2937"></a>
<span class="sourceLineNo">2938</span>                                        System.out.println("TITL '" + titl.toString() + "'");<a name="line.2938"></a>
<span class="sourceLineNo">2939</span>                                }<a name="line.2939"></a>
<span class="sourceLineNo">2940</span>                        }<a name="line.2940"></a>
<span class="sourceLineNo">2941</span>                        if (subField.equals("EDIT")) {<a name="line.2941"></a>
<span class="sourceLineNo">2942</span>                                edit.append(line.substring(19, line.length()).trim());<a name="line.2942"></a>
<span class="sourceLineNo">2943</span>                                if (DEBUG) {<a name="line.2943"></a>
<span class="sourceLineNo">2944</span>                                        System.out.println("EDIT '" + edit.toString() + "'");<a name="line.2944"></a>
<span class="sourceLineNo">2945</span>                                }<a name="line.2945"></a>
<span class="sourceLineNo">2946</span>                        }<a name="line.2946"></a>
<span class="sourceLineNo">2947</span>                        //        JRNL        REF    NAT.IMMUNOL.                  V.   8   430 2007<a name="line.2947"></a>
<span class="sourceLineNo">2948</span>                        if (subField.equals("REF ")) {<a name="line.2948"></a>
<span class="sourceLineNo">2949</span>                                ref.append(line.substring(19, line.length()).trim() + " ");<a name="line.2949"></a>
<span class="sourceLineNo">2950</span>                                if (DEBUG) {<a name="line.2950"></a>
<span class="sourceLineNo">2951</span>                                        System.out.println("REF '" + ref.toString() + "'");<a name="line.2951"></a>
<span class="sourceLineNo">2952</span>                                }<a name="line.2952"></a>
<span class="sourceLineNo">2953</span>                        }<a name="line.2953"></a>
<span class="sourceLineNo">2954</span>                        if (subField.equals("PUBL")) {<a name="line.2954"></a>
<span class="sourceLineNo">2955</span>                                publ.append(line.substring(19, line.length()).trim() + " ");<a name="line.2955"></a>
<span class="sourceLineNo">2956</span>                                if (DEBUG) {<a name="line.2956"></a>
<span class="sourceLineNo">2957</span>                                        System.out.println("PUBL '" + publ.toString() + "'");<a name="line.2957"></a>
<span class="sourceLineNo">2958</span>                                }<a name="line.2958"></a>
<span class="sourceLineNo">2959</span>                        }<a name="line.2959"></a>
<span class="sourceLineNo">2960</span>                        //        JRNL        REFN                   ISSN 1529-2908<a name="line.2960"></a>
<span class="sourceLineNo">2961</span>                        if (subField.equals("REFN")) {<a name="line.2961"></a>
<span class="sourceLineNo">2962</span>                                if ( line.length() &lt; 35 ) {<a name="line.2962"></a>
<span class="sourceLineNo">2963</span>                                        logger.fine("can not process Journal REFN line: " + line);<a name="line.2963"></a>
<span class="sourceLineNo">2964</span>                                        continue;<a name="line.2964"></a>
<span class="sourceLineNo">2965</span>                                }<a name="line.2965"></a>
<span class="sourceLineNo">2966</span>                                refn.append(line.substring(35, line.length()).trim());<a name="line.2966"></a>
<span class="sourceLineNo">2967</span>                                if (DEBUG) {<a name="line.2967"></a>
<span class="sourceLineNo">2968</span>                                        System.out.println("REFN '" + refn.toString() + "'");<a name="line.2968"></a>
<span class="sourceLineNo">2969</span>                                }<a name="line.2969"></a>
<span class="sourceLineNo">2970</span>                        }<a name="line.2970"></a>
<span class="sourceLineNo">2971</span>                        //        JRNL        PMID   17351618<a name="line.2971"></a>
<span class="sourceLineNo">2972</span>                        if (subField.equals("PMID")) {<a name="line.2972"></a>
<span class="sourceLineNo">2973</span>                                pmid.append(line.substring(19, line.length()).trim());<a name="line.2973"></a>
<span class="sourceLineNo">2974</span>                                if (DEBUG) {<a name="line.2974"></a>
<span class="sourceLineNo">2975</span>                                        System.out.println("PMID '" + pmid.toString() + "'");<a name="line.2975"></a>
<span class="sourceLineNo">2976</span>                                }<a name="line.2976"></a>
<span class="sourceLineNo">2977</span>                        }<a name="line.2977"></a>
<span class="sourceLineNo">2978</span>                        //        JRNL        DOI    10.1038/NI1450<a name="line.2978"></a>
<span class="sourceLineNo">2979</span>                        if (subField.equals("DOI ")) {<a name="line.2979"></a>
<span class="sourceLineNo">2980</span>                                doi.append(line.substring(19, line.length()).trim());<a name="line.2980"></a>
<span class="sourceLineNo">2981</span>                                if (DEBUG) {<a name="line.2981"></a>
<span class="sourceLineNo">2982</span>                                        System.out.println("DOI '" + doi.toString() + "'");<a name="line.2982"></a>
<span class="sourceLineNo">2983</span>                                }<a name="line.2983"></a>
<span class="sourceLineNo">2984</span>                        }<a name="line.2984"></a>
<span class="sourceLineNo">2985</span>                }<a name="line.2985"></a>
<span class="sourceLineNo">2986</span><a name="line.2986"></a>
<span class="sourceLineNo">2987</span>                //now set the parts of the JournalArticle<a name="line.2987"></a>
<span class="sourceLineNo">2988</span>                journalArticle.setAuthorList(authorBuilder(auth.toString()));<a name="line.2988"></a>
<span class="sourceLineNo">2989</span>                journalArticle.setEditorList(authorBuilder(edit.toString()));<a name="line.2989"></a>
<span class="sourceLineNo">2990</span>                journalArticle.setRef(ref.toString());<a name="line.2990"></a>
<span class="sourceLineNo">2991</span>                JournalParser journalParser = new JournalParser(ref.toString());<a name="line.2991"></a>
<span class="sourceLineNo">2992</span>                journalArticle.setJournalName(journalParser.getJournalName());<a name="line.2992"></a>
<span class="sourceLineNo">2993</span>                if (!journalArticle.getJournalName().equals("TO BE PUBLISHED")) {<a name="line.2993"></a>
<span class="sourceLineNo">2994</span>                        journalArticle.setIsPublished(true);<a name="line.2994"></a>
<span class="sourceLineNo">2995</span>                }<a name="line.2995"></a>
<span class="sourceLineNo">2996</span>                journalArticle.setVolume(journalParser.getVolume());<a name="line.2996"></a>
<span class="sourceLineNo">2997</span>                journalArticle.setStartPage(journalParser.getStartPage());<a name="line.2997"></a>
<span class="sourceLineNo">2998</span>                journalArticle.setPublicationDate(journalParser.getPublicationDate());<a name="line.2998"></a>
<span class="sourceLineNo">2999</span>                journalArticle.setPublisher(publ.toString().trim());<a name="line.2999"></a>
<span class="sourceLineNo">3000</span>                journalArticle.setTitle(titl.toString().trim());<a name="line.3000"></a>
<span class="sourceLineNo">3001</span>                journalArticle.setRefn(refn.toString().trim());<a name="line.3001"></a>
<span class="sourceLineNo">3002</span>                journalArticle.setPmid(pmid.toString().trim());<a name="line.3002"></a>
<span class="sourceLineNo">3003</span>                journalArticle.setDoi(doi.toString().trim());<a name="line.3003"></a>
<span class="sourceLineNo">3004</span><a name="line.3004"></a>
<span class="sourceLineNo">3005</span>                if (DEBUG) {<a name="line.3005"></a>
<span class="sourceLineNo">3006</span>                        System.out.println("Made JournalArticle:");<a name="line.3006"></a>
<span class="sourceLineNo">3007</span>                        System.out.println(journalArticle);<a name="line.3007"></a>
<span class="sourceLineNo">3008</span>                }<a name="line.3008"></a>
<span class="sourceLineNo">3009</span>        }<a name="line.3009"></a>
<span class="sourceLineNo">3010</span><a name="line.3010"></a>
<span class="sourceLineNo">3011</span>        //inner class to deal with all the journal info<a name="line.3011"></a>
<span class="sourceLineNo">3012</span>        private class JournalParser {<a name="line.3012"></a>
<span class="sourceLineNo">3013</span><a name="line.3013"></a>
<span class="sourceLineNo">3014</span>                private String journalName;<a name="line.3014"></a>
<span class="sourceLineNo">3015</span>                private String volume;<a name="line.3015"></a>
<span class="sourceLineNo">3016</span>                private String startPage;<a name="line.3016"></a>
<span class="sourceLineNo">3017</span>                private int publicationDate;<a name="line.3017"></a>
<span class="sourceLineNo">3018</span><a name="line.3018"></a>
<span class="sourceLineNo">3019</span><a name="line.3019"></a>
<span class="sourceLineNo">3020</span>                public JournalParser(String ref) {<a name="line.3020"></a>
<span class="sourceLineNo">3021</span>                        if (DEBUG) {<a name="line.3021"></a>
<span class="sourceLineNo">3022</span>                                System.out.println("JournalParser init '" + ref + "'");<a name="line.3022"></a>
<span class="sourceLineNo">3023</span>                        }<a name="line.3023"></a>
<span class="sourceLineNo">3024</span><a name="line.3024"></a>
<span class="sourceLineNo">3025</span>                        if (ref.equals("TO BE PUBLISHED ")) {<a name="line.3025"></a>
<span class="sourceLineNo">3026</span>                                journalName = ref.trim();<a name="line.3026"></a>
<span class="sourceLineNo">3027</span>                                if (DEBUG) {<a name="line.3027"></a>
<span class="sourceLineNo">3028</span>                                        System.out.println(String.format("JournalParser found journalString '%s'", journalName));<a name="line.3028"></a>
<span class="sourceLineNo">3029</span>                                }<a name="line.3029"></a>
<span class="sourceLineNo">3030</span>                                return;<a name="line.3030"></a>
<span class="sourceLineNo">3031</span>                        }<a name="line.3031"></a>
<span class="sourceLineNo">3032</span><a name="line.3032"></a>
<span class="sourceLineNo">3033</span>                        if (ref.length() &lt; 48) {<a name="line.3033"></a>
<span class="sourceLineNo">3034</span>                                logger.fine("REF line too short - must be at least 48 characters to be valid for parsing.");<a name="line.3034"></a>
<span class="sourceLineNo">3035</span>                                journalName = "";<a name="line.3035"></a>
<span class="sourceLineNo">3036</span>                                volume = "";<a name="line.3036"></a>
<span class="sourceLineNo">3037</span>                                startPage = "";<a name="line.3037"></a>
<span class="sourceLineNo">3038</span>                                publicationDate = 0;<a name="line.3038"></a>
<span class="sourceLineNo">3039</span>                                return;<a name="line.3039"></a>
<span class="sourceLineNo">3040</span>                        }<a name="line.3040"></a>
<span class="sourceLineNo">3041</span>                        //can be multi line:<a name="line.3041"></a>
<span class="sourceLineNo">3042</span>                        //REF    PHILOS.TRANS.R.SOC.LONDON,    V. 293    53 1981<a name="line.3042"></a>
<span class="sourceLineNo">3043</span>                        //REF  2 SER.B<a name="line.3043"></a>
<span class="sourceLineNo">3044</span><a name="line.3044"></a>
<span class="sourceLineNo">3045</span>                        //or<a name="line.3045"></a>
<span class="sourceLineNo">3046</span><a name="line.3046"></a>
<span class="sourceLineNo">3047</span>                        //REF    GLYCOGEN PHOSPHORYLASE B:                1 1991<a name="line.3047"></a>
<span class="sourceLineNo">3048</span>                        //REF  2 DESCRIPTION OF THE PROTEIN<a name="line.3048"></a>
<span class="sourceLineNo">3049</span>                        //REF  3 STRUCTURE<a name="line.3049"></a>
<span class="sourceLineNo">3050</span><a name="line.3050"></a>
<span class="sourceLineNo">3051</span>                        //but usually single line<a name="line.3051"></a>
<span class="sourceLineNo">3052</span>                        //REF    NUCLEIC ACIDS RES.                         2009<a name="line.3052"></a>
<span class="sourceLineNo">3053</span>                        //REF    MOL.CELL                                   2009<a name="line.3053"></a>
<span class="sourceLineNo">3054</span>                        //REF    NAT.STRUCT.MOL.BIOL.          V.  16   238 2009<a name="line.3054"></a>
<span class="sourceLineNo">3055</span>                        //REF    ACTA CRYSTALLOGR.,SECT.F      V.  65   199 2009<a name="line.3055"></a>
<span class="sourceLineNo">3056</span>                        //check if the date is present at the end of the line.<a name="line.3056"></a>
<span class="sourceLineNo">3057</span>                        //                             09876543210987654321<a name="line.3057"></a>
<span class="sourceLineNo">3058</span>                        //'J.BIOL.CHEM.                  V. 280 23000 2005 '<a name="line.3058"></a>
<span class="sourceLineNo">3059</span>                        //'J.AM.CHEM.SOC.                V. 130 16011 2008 '<a name="line.3059"></a>
<span class="sourceLineNo">3060</span>                        //'NAT.STRUCT.MOL.BIOL.          V.  16   238 2009'<a name="line.3060"></a>
<span class="sourceLineNo">3061</span>                        String volumeInformation = ref.substring(30, 48);<a name="line.3061"></a>
<span class="sourceLineNo">3062</span>                        if (DEBUG) {<a name="line.3062"></a>
<span class="sourceLineNo">3063</span>                                System.out.println(String.format("Parsing volumeInformation: '%s'", volumeInformation));<a name="line.3063"></a>
<span class="sourceLineNo">3064</span>                        }<a name="line.3064"></a>
<span class="sourceLineNo">3065</span>                        //volumeInformation: 'V. 293    53 1981 '<a name="line.3065"></a>
<span class="sourceLineNo">3066</span>                        //                      String dateString = ref.substring(ref.length() - 5 , ref.length() - 1).trim();<a name="line.3066"></a>
<span class="sourceLineNo">3067</span>                        //                      String startPageString = ref.substring(ref.length() - 11 , ref.length() - 6).trim();<a name="line.3067"></a>
<span class="sourceLineNo">3068</span>                        //                      String volumeString = ref.substring(ref.length() - 16 , ref.length() - 12).trim();<a name="line.3068"></a>
<span class="sourceLineNo">3069</span>                        //                      String journalString = ref.substring(0 , ref.length() - 18).trim();<a name="line.3069"></a>
<span class="sourceLineNo">3070</span>                        String dateString = volumeInformation.substring(volumeInformation.length() - 5 , volumeInformation.length() - 1).trim();<a name="line.3070"></a>
<span class="sourceLineNo">3071</span>                        String startPageString = volumeInformation.substring(volumeInformation.length() - 11 , volumeInformation.length() - 6).trim();<a name="line.3071"></a>
<span class="sourceLineNo">3072</span>                        String volumeString = volumeInformation.substring(volumeInformation.length() - 16 , volumeInformation.length() - 12).trim();<a name="line.3072"></a>
<span class="sourceLineNo">3073</span>                        //for the journal string we need to remove the volume information which might be in the middle of the string (e.g. 1gpb, 3pfk)<a name="line.3073"></a>
<span class="sourceLineNo">3074</span>                        String journalString = ref.substring(0 , 29).trim() + " " + ref.substring(30, ref.length() - 1).replace(volumeInformation.trim(), "").trim();<a name="line.3074"></a>
<span class="sourceLineNo">3075</span>                        journalString = journalString.trim();<a name="line.3075"></a>
<span class="sourceLineNo">3076</span>                        //                        System.out.println("journalString: " + journalString);<a name="line.3076"></a>
<span class="sourceLineNo">3077</span>                        if (DEBUG) {<a name="line.3077"></a>
<span class="sourceLineNo">3078</span>                                System.out.println(String.format("JournalParser found volumeString '%s'", volumeString));<a name="line.3078"></a>
<span class="sourceLineNo">3079</span>                                System.out.println(String.format("JournalParser found startPageString '%s'", startPageString));<a name="line.3079"></a>
<span class="sourceLineNo">3080</span>                                System.out.println(String.format("JournalParser found dateString '%s'", dateString));<a name="line.3080"></a>
<span class="sourceLineNo">3081</span>                                System.out.println(String.format("JournalParser found journalString '%s'", journalString));<a name="line.3081"></a>
<span class="sourceLineNo">3082</span>                        }<a name="line.3082"></a>
<span class="sourceLineNo">3083</span><a name="line.3083"></a>
<span class="sourceLineNo">3084</span>                        if (!dateString.equals("    ")) {<a name="line.3084"></a>
<span class="sourceLineNo">3085</span>                                try {<a name="line.3085"></a>
<span class="sourceLineNo">3086</span>                                        publicationDate = Integer.valueOf(dateString);<a name="line.3086"></a>
<span class="sourceLineNo">3087</span>                                } catch (NumberFormatException nfe) {<a name="line.3087"></a>
<span class="sourceLineNo">3088</span>                                        logger.fine(dateString + " is not a valid integer for a date in JRNL sub-section REF line 1");<a name="line.3088"></a>
<span class="sourceLineNo">3089</span>                                }<a name="line.3089"></a>
<span class="sourceLineNo">3090</span>                                //                              if (DEBUG) {<a name="line.3090"></a>
<span class="sourceLineNo">3091</span>                                //                                      System.out.println("JournalParser set date " + publicationDate);<a name="line.3091"></a>
<span class="sourceLineNo">3092</span>                                //                              }<a name="line.3092"></a>
<span class="sourceLineNo">3093</span>                        }<a name="line.3093"></a>
<span class="sourceLineNo">3094</span><a name="line.3094"></a>
<span class="sourceLineNo">3095</span>                        if (!startPageString.equals("    ")) {<a name="line.3095"></a>
<span class="sourceLineNo">3096</span>                                startPage = startPageString;<a name="line.3096"></a>
<span class="sourceLineNo">3097</span>                                //                              if (DEBUG) {<a name="line.3097"></a>
<span class="sourceLineNo">3098</span>                                //                                      System.out.println("JournalParser set startPage " + startPage);<a name="line.3098"></a>
<span class="sourceLineNo">3099</span>                                //                              }<a name="line.3099"></a>
<span class="sourceLineNo">3100</span>                        }<a name="line.3100"></a>
<span class="sourceLineNo">3101</span><a name="line.3101"></a>
<span class="sourceLineNo">3102</span>                        if (!volumeString.equals("    ")) {<a name="line.3102"></a>
<span class="sourceLineNo">3103</span>                                volume = volumeString;<a name="line.3103"></a>
<span class="sourceLineNo">3104</span>                                //                              if (DEBUG) {<a name="line.3104"></a>
<span class="sourceLineNo">3105</span>                                //                                      System.out.println("JournalParser set volume " + volume);<a name="line.3105"></a>
<span class="sourceLineNo">3106</span>                                //                              }<a name="line.3106"></a>
<span class="sourceLineNo">3107</span>                        }<a name="line.3107"></a>
<span class="sourceLineNo">3108</span><a name="line.3108"></a>
<span class="sourceLineNo">3109</span>                        if (!journalString.equals("    ")) {<a name="line.3109"></a>
<span class="sourceLineNo">3110</span>                                journalName = journalString;<a name="line.3110"></a>
<span class="sourceLineNo">3111</span>                                if (DEBUG) {<a name="line.3111"></a>
<span class="sourceLineNo">3112</span>                                        System.out.println("JournalParser set journalName " + journalName);<a name="line.3112"></a>
<span class="sourceLineNo">3113</span>                                }<a name="line.3113"></a>
<span class="sourceLineNo">3114</span>                        }<a name="line.3114"></a>
<span class="sourceLineNo">3115</span>                }<a name="line.3115"></a>
<span class="sourceLineNo">3116</span><a name="line.3116"></a>
<span class="sourceLineNo">3117</span>                private String getJournalName() {<a name="line.3117"></a>
<span class="sourceLineNo">3118</span>                        return journalName;<a name="line.3118"></a>
<span class="sourceLineNo">3119</span>                }<a name="line.3119"></a>
<span class="sourceLineNo">3120</span><a name="line.3120"></a>
<span class="sourceLineNo">3121</span>                private int getPublicationDate() {<a name="line.3121"></a>
<span class="sourceLineNo">3122</span>                        return publicationDate;<a name="line.3122"></a>
<span class="sourceLineNo">3123</span>                }<a name="line.3123"></a>
<span class="sourceLineNo">3124</span><a name="line.3124"></a>
<span class="sourceLineNo">3125</span>                private String getStartPage() {<a name="line.3125"></a>
<span class="sourceLineNo">3126</span>                        return startPage;<a name="line.3126"></a>
<span class="sourceLineNo">3127</span>                }<a name="line.3127"></a>
<span class="sourceLineNo">3128</span><a name="line.3128"></a>
<span class="sourceLineNo">3129</span>                private String getVolume() {<a name="line.3129"></a>
<span class="sourceLineNo">3130</span>                        return volume;<a name="line.3130"></a>
<span class="sourceLineNo">3131</span>                }<a name="line.3131"></a>
<span class="sourceLineNo">3132</span>        }<a name="line.3132"></a>
<span class="sourceLineNo">3133</span><a name="line.3133"></a>
<span class="sourceLineNo">3134</span>        private List&lt;Author&gt; authorBuilder(String authorString) {<a name="line.3134"></a>
<span class="sourceLineNo">3135</span>                ArrayList&lt;Author&gt; authorList = new ArrayList&lt;Author&gt;();<a name="line.3135"></a>
<span class="sourceLineNo">3136</span><a name="line.3136"></a>
<span class="sourceLineNo">3137</span>                if (authorString.equals("")) {<a name="line.3137"></a>
<span class="sourceLineNo">3138</span>                        return authorList;<a name="line.3138"></a>
<span class="sourceLineNo">3139</span>                }<a name="line.3139"></a>
<span class="sourceLineNo">3140</span><a name="line.3140"></a>
<span class="sourceLineNo">3141</span>                String[] authors = authorString.split(",");<a name="line.3141"></a>
<span class="sourceLineNo">3142</span>                //        if (DEBUG) {<a name="line.3142"></a>
<span class="sourceLineNo">3143</span>                //            for (int i = 0; i &lt; authors.length; i++) {<a name="line.3143"></a>
<span class="sourceLineNo">3144</span>                //                String string = authors[i];<a name="line.3144"></a>
<span class="sourceLineNo">3145</span>                //                System.out.println("authorBuilder author: '" + string + "'");<a name="line.3145"></a>
<span class="sourceLineNo">3146</span>                //            }<a name="line.3146"></a>
<span class="sourceLineNo">3147</span>                //        }<a name="line.3147"></a>
<span class="sourceLineNo">3148</span>                //        AUTH   SEATTLE STRUCTURAL GENOMICS CENTER FOR INFECTIOUS<a name="line.3148"></a>
<span class="sourceLineNo">3149</span>                //        AUTH 2 DISEASE (SSGCID)<a name="line.3149"></a>
<span class="sourceLineNo">3150</span>                //        or<a name="line.3150"></a>
<span class="sourceLineNo">3151</span>                //        AUTH   E.DOBROVETSKY,A.DONG,A.SEITOVA,B.DUNCAN,L.CROMBET,<a name="line.3151"></a>
<span class="sourceLineNo">3152</span>                //        AUTH 2 M.SUNDSTROM,C.H.ARROWSMITH,A.M.EDWARDS,C.BOUNTRA,<a name="line.3152"></a>
<span class="sourceLineNo">3153</span>                //        AUTH 3 A.BOCHKAREV,D.COSSAR,<a name="line.3153"></a>
<span class="sourceLineNo">3154</span>                //        AUTH 4 STRUCTURAL GENOMICS CONSORTIUM (SGC)<a name="line.3154"></a>
<span class="sourceLineNo">3155</span>                //        or<a name="line.3155"></a>
<span class="sourceLineNo">3156</span>                //        AUTH   T.-C.MOU,S.R.SPRANG,N.MASADA,D.M.F.COOPER<a name="line.3156"></a>
<span class="sourceLineNo">3157</span>                if (authors.length == 1) {<a name="line.3157"></a>
<span class="sourceLineNo">3158</span>                        //only one element means it's a consortium only<a name="line.3158"></a>
<span class="sourceLineNo">3159</span>                        Author author = new Author();<a name="line.3159"></a>
<span class="sourceLineNo">3160</span>                        author.setSurname(authors[0]);<a name="line.3160"></a>
<span class="sourceLineNo">3161</span>                        if (DEBUG) {<a name="line.3161"></a>
<span class="sourceLineNo">3162</span>                                System.out.println("Set consortium author name " + author.getSurname());<a name="line.3162"></a>
<span class="sourceLineNo">3163</span>                        }<a name="line.3163"></a>
<span class="sourceLineNo">3164</span>                        authorList.add(author);<a name="line.3164"></a>
<span class="sourceLineNo">3165</span>                } else {<a name="line.3165"></a>
<span class="sourceLineNo">3166</span>                        for (int i = 0; i &lt; authors.length; i++) {<a name="line.3166"></a>
<span class="sourceLineNo">3167</span>                                String authorFullName = authors[i];<a name="line.3167"></a>
<span class="sourceLineNo">3168</span>                                if (DEBUG) {<a name="line.3168"></a>
<span class="sourceLineNo">3169</span>                                        System.out.println("Building author " + authorFullName);<a name="line.3169"></a>
<span class="sourceLineNo">3170</span>                                }<a name="line.3170"></a>
<span class="sourceLineNo">3171</span>                                Author author = new Author();<a name="line.3171"></a>
<span class="sourceLineNo">3172</span>                                String regex = "\\.";<a name="line.3172"></a>
<span class="sourceLineNo">3173</span>                                String[] authorNames = authorFullName.split(regex);<a name="line.3173"></a>
<span class="sourceLineNo">3174</span>                                //                if (DEBUG) {<a name="line.3174"></a>
<span class="sourceLineNo">3175</span>                                //                    System.out.println("authorNames size " + authorNames.length);<a name="line.3175"></a>
<span class="sourceLineNo">3176</span>                                //                    for (int j = 0; j &lt; authorNames.length; j++) {<a name="line.3176"></a>
<span class="sourceLineNo">3177</span>                                //                        String name = authorNames[j];<a name="line.3177"></a>
<span class="sourceLineNo">3178</span>                                //                        System.out.println("split authName '" + name + "'");<a name="line.3178"></a>
<span class="sourceLineNo">3179</span>                                //<a name="line.3179"></a>
<span class="sourceLineNo">3180</span>                                //                    }<a name="line.3180"></a>
<span class="sourceLineNo">3181</span>                                //                }<a name="line.3181"></a>
<span class="sourceLineNo">3182</span>                                if (authorNames.length == 0) {<a name="line.3182"></a>
<span class="sourceLineNo">3183</span>                                        author.setSurname(authorFullName);<a name="line.3183"></a>
<span class="sourceLineNo">3184</span>                                        if (DEBUG) {<a name="line.3184"></a>
<span class="sourceLineNo">3185</span>                                                System.out.println("Unable to split using '" + regex + "' Setting whole name " + author.getSurname());<a name="line.3185"></a>
<span class="sourceLineNo">3186</span>                                        }<a name="line.3186"></a>
<span class="sourceLineNo">3187</span>                                }<a name="line.3187"></a>
<span class="sourceLineNo">3188</span>                                //again there might be a consortium name so there may be no elements<a name="line.3188"></a>
<span class="sourceLineNo">3189</span>                                else if (authorNames.length == 1) {<a name="line.3189"></a>
<span class="sourceLineNo">3190</span>                                        author.setSurname(authorNames[0]);<a name="line.3190"></a>
<span class="sourceLineNo">3191</span>                                        if (DEBUG) {<a name="line.3191"></a>
<span class="sourceLineNo">3192</span>                                                System.out.println("Set consortium author name in multiple author block " + author.getSurname<a name="line.3192"></a>
<span class="sourceLineNo">3193</span>                                                                ());<a name="line.3193"></a>
<span class="sourceLineNo">3194</span>                                        }<a name="line.3194"></a>
<span class="sourceLineNo">3195</span>                                } else {<a name="line.3195"></a>
<span class="sourceLineNo">3196</span>                                        String initials = "";<a name="line.3196"></a>
<span class="sourceLineNo">3197</span>                                        for (int j = 0; j &lt; authorNames.length - 1; j++) {<a name="line.3197"></a>
<span class="sourceLineNo">3198</span>                                                String initial = authorNames[j];<a name="line.3198"></a>
<span class="sourceLineNo">3199</span>                                                //                        if (DEBUG) {<a name="line.3199"></a>
<span class="sourceLineNo">3200</span>                                                //                            System.out.println("adding initial '" + initial + "'");<a name="line.3200"></a>
<span class="sourceLineNo">3201</span>                                                //                        }<a name="line.3201"></a>
<span class="sourceLineNo">3202</span>                                                //build the initials back up again<a name="line.3202"></a>
<span class="sourceLineNo">3203</span>                                                initials += initial + ".";<a name="line.3203"></a>
<span class="sourceLineNo">3204</span>                                        }<a name="line.3204"></a>
<span class="sourceLineNo">3205</span>                                        if (DEBUG) {<a name="line.3205"></a>
<span class="sourceLineNo">3206</span>                                                System.out.println("built initials '" + initials + "'");<a name="line.3206"></a>
<span class="sourceLineNo">3207</span>                                        }<a name="line.3207"></a>
<span class="sourceLineNo">3208</span>                                        author.setInitials(initials);<a name="line.3208"></a>
<span class="sourceLineNo">3209</span>                                        //surname is always last<a name="line.3209"></a>
<span class="sourceLineNo">3210</span>                                        int lastName = authorNames.length - 1;<a name="line.3210"></a>
<span class="sourceLineNo">3211</span>                                        String surname = authorNames[lastName];<a name="line.3211"></a>
<span class="sourceLineNo">3212</span>                                        if (DEBUG) {<a name="line.3212"></a>
<span class="sourceLineNo">3213</span>                                                System.out.println("built author surname " + surname);<a name="line.3213"></a>
<span class="sourceLineNo">3214</span>                                        }<a name="line.3214"></a>
<span class="sourceLineNo">3215</span>                                        author.setSurname(surname);<a name="line.3215"></a>
<span class="sourceLineNo">3216</span><a name="line.3216"></a>
<span class="sourceLineNo">3217</span>                                }<a name="line.3217"></a>
<span class="sourceLineNo">3218</span>                                authorList.add(author);<a name="line.3218"></a>
<span class="sourceLineNo">3219</span>                        }<a name="line.3219"></a>
<span class="sourceLineNo">3220</span>                }<a name="line.3220"></a>
<span class="sourceLineNo">3221</span>                return authorList;<a name="line.3221"></a>
<span class="sourceLineNo">3222</span>        }<a name="line.3222"></a>
<span class="sourceLineNo">3223</span><a name="line.3223"></a>
<span class="sourceLineNo">3224</span>        public void setFileParsingParameters(FileParsingParameters params)<a name="line.3224"></a>
<span class="sourceLineNo">3225</span>        {<a name="line.3225"></a>
<span class="sourceLineNo">3226</span>                this.params= params;<a name="line.3226"></a>
<span class="sourceLineNo">3227</span>                if ( !params.isLoadChemCompInfo()) {<a name="line.3227"></a>
<span class="sourceLineNo">3228</span>                        ChemCompGroupFactory.setChemCompProvider(new ReducedChemCompProvider());<a name="line.3228"></a>
<span class="sourceLineNo">3229</span>                }<a name="line.3229"></a>
<span class="sourceLineNo">3230</span><a name="line.3230"></a>
<span class="sourceLineNo">3231</span>        }<a name="line.3231"></a>
<span class="sourceLineNo">3232</span><a name="line.3232"></a>
<span class="sourceLineNo">3233</span>        public FileParsingParameters getFileParsingParameters(){<a name="line.3233"></a>
<span class="sourceLineNo">3234</span>                return params;<a name="line.3234"></a>
<span class="sourceLineNo">3235</span>        }<a name="line.3235"></a>
<span class="sourceLineNo">3236</span><a name="line.3236"></a>
<span class="sourceLineNo">3237</span><a name="line.3237"></a>
<span class="sourceLineNo">3238</span>}<a name="line.3238"></a>




























































</pre>
</div>
</body>
</html>
